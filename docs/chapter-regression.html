<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 회귀모형 | R에 의한 시계열분석</title>
  <meta name="description" content="5 회귀모형 | R에 의한 시계열분석" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="5 회귀모형 | R에 의한 시계열분석" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="yjyjpark/TS-with-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 회귀모형 | R에 의한 시계열분석" />
  
  
  

<meta name="author" content="박동련" />


<meta name="date" content="2022-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-arima.html"/>
<link rel="next" href="참고-문헌.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#소개하기">소개하기<span></span></a></li>
<li class="chapter" data-level="1" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html"><i class="fa fa-check"></i><b>1</b> 시계열 그래프<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#시계열-자료"><i class="fa fa-check"></i><b>1.1</b> 시계열 자료<span></span></a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#종단-자료cross-sectional-data와의-비교"><i class="fa fa-check"></i><b>1.1.1</b> 종단 자료(cross-sectional data)와의 비교<span></span></a></li>
<li class="chapter" data-level="1.1.2" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#시계열-예측"><i class="fa fa-check"></i><b>1.1.2</b> 시계열 예측<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#시계열-그래프-작성"><i class="fa fa-check"></i><b>1.2</b> 시계열 그래프 작성<span></span></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#ts-객체-생성"><i class="fa fa-check"></i><b>1.2.1</b> <code>ts</code> 객체 생성<span></span></a></li>
<li class="chapter" data-level="1.2.2" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#section-ts-plot"><i class="fa fa-check"></i><b>1.2.2</b> 시계열 그래프 작성<span></span></a></li>
<li class="chapter" data-level="1.2.3" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#section-seasonal-plot"><i class="fa fa-check"></i><b>1.2.3</b> Seasonal 그래프<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html"><i class="fa fa-check"></i><b>2</b> 시계열 분해<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#시계열-분해-모형"><i class="fa fa-check"></i><b>2.1</b> 시계열 분해 모형<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#전통적-시계열-분해-기법"><i class="fa fa-check"></i><b>2.2</b> 전통적 시계열 분해 기법<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#이동-평균법"><i class="fa fa-check"></i><b>2.2.1</b> 이동 평균법<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#전통적-분해-기법"><i class="fa fa-check"></i><b>2.2.2</b> 전통적 분해 기법<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#stl-분해-기법"><i class="fa fa-check"></i><b>2.3</b> STL 분해 기법<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-ets.html"><a href="chapter-ets.html"><i class="fa fa-check"></i><b>3</b> ETS 모형<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-ets.html"><a href="chapter-ets.html#section-accuracy"><i class="fa fa-check"></i><b>3.1</b> 예측 모형의 평가<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="chapter-ets.html"><a href="chapter-ets.html#section-exponential"><i class="fa fa-check"></i><b>3.2</b> 전통적 지수평활법<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-ets.html"><a href="chapter-ets.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.2.1</b> Simple exponential smoothing<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-ets.html"><a href="chapter-ets.html#trend-method"><i class="fa fa-check"></i><b>3.2.2</b> Trend method<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-ets.html"><a href="chapter-ets.html#holt-winters-seasonal-method"><i class="fa fa-check"></i><b>3.2.3</b> Holt-Winters’ seasonal method<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-ets.html"><a href="chapter-ets.html#section-ets"><i class="fa fa-check"></i><b>3.3</b> ETS 모형<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-ets.html"><a href="chapter-ets.html#전통적-지수평활법의-확장"><i class="fa fa-check"></i><b>3.3.1</b> 전통적 지수평활법의 확장<span></span></a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-ets.html"><a href="chapter-ets.html#모형-적합-및-최적-모형-선택"><i class="fa fa-check"></i><b>3.3.2</b> 모형 적합 및 최적 모형 선택<span></span></a></li>
<li class="chapter" data-level="3.3.3" data-path="chapter-ets.html"><a href="chapter-ets.html#예측"><i class="fa fa-check"></i><b>3.3.3</b> 예측<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-ets.html"><a href="chapter-ets.html#모형의-가정-만족-여부-확인"><i class="fa fa-check"></i><b>3.4</b> 모형의 가정 만족 여부 확인<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-ets.html"><a href="chapter-ets.html#자기상관과-부분자기상관"><i class="fa fa-check"></i><b>3.4.1</b> 자기상관과 부분자기상관<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-ets.html"><a href="chapter-ets.html#독립성-검정"><i class="fa fa-check"></i><b>3.4.2</b> 독립성 검정<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="chapter-ets.html"><a href="chapter-ets.html#예제"><i class="fa fa-check"></i><b>3.5</b> 예제<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-arima.html"><a href="chapter-arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA 모형<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-arima.html"><a href="chapter-arima.html#시계열자료의-정상성"><i class="fa fa-check"></i><b>4.1</b> 시계열자료의 정상성<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="chapter-arima.html"><a href="chapter-arima.html#정상-시계열자료"><i class="fa fa-check"></i><b>4.1.1</b> 정상 시계열자료<span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="chapter-arima.html"><a href="chapter-arima.html#section-make-stationary"><i class="fa fa-check"></i><b>4.1.2</b> 비정상 시계열 자료의 정상화<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="chapter-arima.html"><a href="chapter-arima.html#정상-시계열-모형"><i class="fa fa-check"></i><b>4.2</b> 정상 시계열 모형<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter-arima.html"><a href="chapter-arima.html#자기회귀모형-autoregressive-model-ar-model"><i class="fa fa-check"></i><b>4.2.1</b> 자기회귀모형 (Autoregressive model; AR model)<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter-arima.html"><a href="chapter-arima.html#이동평균모형-moving-average-model-ma-model"><i class="fa fa-check"></i><b>4.2.2</b> 이동평균모형 (Moving average model; MA model)<span></span></a></li>
<li class="chapter" data-level="4.2.3" data-path="chapter-arima.html"><a href="chapter-arima.html#자기회귀이동평균모형-autoregressive-moving-average-model-arma-model"><i class="fa fa-check"></i><b>4.2.3</b> 자기회귀이동평균모형 (Autoregressive moving average model; ARMA model)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chapter-arima.html"><a href="chapter-arima.html#section-nonseasonal-arima"><i class="fa fa-check"></i><b>4.3</b> 비계절형 ARIMA 모형<span></span></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chapter-arima.html"><a href="chapter-arima.html#모형-식별"><i class="fa fa-check"></i><b>4.3.1</b> 모형 식별<span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="chapter-arima.html"><a href="chapter-arima.html#모형-추정-및-진단"><i class="fa fa-check"></i><b>4.3.2</b> 모형 추정 및 진단<span></span></a></li>
<li class="chapter" data-level="4.3.3" data-path="chapter-arima.html"><a href="chapter-arima.html#예측-1"><i class="fa fa-check"></i><b>4.3.3</b> 예측<span></span></a></li>
<li class="chapter" data-level="4.3.4" data-path="chapter-arima.html"><a href="chapter-arima.html#실습-예제"><i class="fa fa-check"></i><b>4.3.4</b> 실습 예제<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chapter-arima.html"><a href="chapter-arima.html#section-seasonal-arima"><i class="fa fa-check"></i><b>4.4</b> 계절형 ARIMA 모형<span></span></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="chapter-arima.html"><a href="chapter-arima.html#계절형-arima-모형-적합-절차"><i class="fa fa-check"></i><b>4.4.1</b> 계절형 ARIMA 모형 적합 절차<span></span></a></li>
<li class="chapter" data-level="4.4.2" data-path="chapter-arima.html"><a href="chapter-arima.html#실습-예제-1"><i class="fa fa-check"></i><b>4.4.2</b> 실습 예제<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-regression.html"><a href="chapter-regression.html"><i class="fa fa-check"></i><b>5</b> 회귀모형<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-regression.html"><a href="chapter-regression.html#section-arma-reg"><i class="fa fa-check"></i><b>5.1</b> ARMA 오차 회귀모형<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-regression.html"><a href="chapter-regression.html#section-ts-reg"><i class="fa fa-check"></i><b>5.1.1</b> 시계열 회귀모형<span></span></a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-regression.html"><a href="chapter-regression.html#section-arma-ts-reg"><i class="fa fa-check"></i><b>5.1.2</b> ARMA 오차 시계열 회귀모형<span></span></a></li>
<li class="chapter" data-level="5.1.3" data-path="chapter-regression.html"><a href="chapter-regression.html#실습-예제-2"><i class="fa fa-check"></i><b>5.1.3</b> 실습 예제<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-regression.html"><a href="chapter-regression.html#section-arma-dynamic"><i class="fa fa-check"></i><b>5.2</b> Dynamic 회귀모형<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-regression.html"><a href="chapter-regression.html#arma-오차-dynamic-회귀모형"><i class="fa fa-check"></i><b>5.2.1</b> ARMA 오차 Dynamic 회귀모형<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="chapter-regression.html"><a href="chapter-regression.html#실습-예제-3"><i class="fa fa-check"></i><b>5.2.2</b> 실습 예제<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="참고-문헌.html#참고-문헌">참고 문헌<span></span></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R에 의한 시계열분석</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-regression" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> 회귀모형<a href="chapter-regression.html#chapter-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="chapter-ets.html#chapter-ets">3</a>장과 <a href="chapter-arima.html#chapter-arima">4</a>장에서 살펴본 ETS 모형과 ARIMA 모형은 자료들 사이에 존재하는 자기상관 구조에 의하여 형성되는 추세 성분과 계절 성분을 설명하는데 적합한 모형이다.
추세와 계절 성분이 자료의 자기상관에 의해 형성되는 경우를 확률적 추세 성분과 확률적 계절 성분이라고 부르는데, 시간의 흐름에 따라 변할 수 있다는 특징이 있다.</p>
<p>반면에 추세 성분의 기울기가 일정하고 계절 성분이 고정된 형태인 경우가 있는데, 이런 경우를 결정적 추세 성분과 결정적 계절 성분이라고 부른다.
결정적 성분에 대해서도 ETS 모형 및 ARIMA 모형을 사용할 수 있지만, 회귀모형을 사용하는 것이 더 효과적일 수 있다.</p>
<p>반응변수 <span class="math inline">\(y\)</span> 와 설명변수 <span class="math inline">\(x_{1}, \ldots, x_{k}\)</span> 의 선형회귀모형은 다음과 같이 표현된다.</p>
<p><span class="math display" id="eq:reg-1">\[\begin{equation}
y_{i} = \beta_{0} + \beta_{1}x_{1i} + \cdots + \beta_{k}x_{ki} + \epsilon_{i}, ~~~i=1, \ldots,n
\tag{5.1}
\end{equation}\]</span></p>
<p>단, <span class="math inline">\(\epsilon_{i}\)</span> 는 서로 독립이며, 모두 <span class="math inline">\(N(0,\sigma^{2})\)</span> 분포를 하는 확률변수이다.</p>
<p>식 <a href="chapter-regression.html#eq:reg-1">(5.1)</a>의 선형회귀모형으로 시계열자료를 적합할 때 문제가 되는 가정은 오차항의 독립성이다.
시계열자료 사이에는 일반적으로 유의한 자기상관이 존재하기 때문에 독립 오차항을 가정한 회귀모형은 적합한 모형이 아닌 것이다.
따라서 백색잡음 오차항이 아닌 ARMA 오차항을 가정한 회귀모형을 사용해야 한다.</p>
<p>회귀모형의 반응변수는 우리가 예측하고자 하는 시계열자료 <span class="math inline">\(y_{t}\)</span> 가 되는데, 설명변수로는 관측 시점 <span class="math inline">\(t\)</span> 만을 사용하는 경우와 다른 시계열자료를 사용하는 경우로 구분된다.
<a href="chapter-regression.html#section-arma-reg">5.1</a>절에서는 관측 시점만을 설명변수로 사용하는 회귀모형에 대해 살펴볼 것이고, <a href="chapter-regression.html#section-arma-dynamic">5.2</a>절에서는 다른 시계열자료를 설명변수로 사용하는 Dynamic 회귀모형에 대해 살펴볼 것이다.</p>
<div id="section-arma-reg" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> ARMA 오차 회귀모형<a href="chapter-regression.html#section-arma-reg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>추세와 계절 성분이 있는 시계열자료는 분해법을 근거로 다음과 같이 표현된다.</p>
<p><span class="math display">\[
y_{t} = T_{t} + S_{t} + \epsilon_{t}
\]</span></p>
<p>시계열 회귀모형에서는 추세와 계절 성분인 <span class="math inline">\(T_{t}+S_{t}\)</span> 를 회귀모형으로 설명하는데, 추세인 <span class="math inline">\(T_{t}\)</span> 는 시점 <span class="math inline">\(t\)</span> 의 다항회귀모형으로 표현하고, 계절 성분인 <span class="math inline">\(S_{t}\)</span> 는 dummy 변수나 Fourier series 변수로 표현을 한다.
오차항 <span class="math inline">\(\epsilon_{t} = y_{t}-T_{t}-S_{t}\)</span> 는 자료에서 비정상 요소가 제거된 상태로 표현되기 때문에 정상성을 만족하게 된다.
다만, 시계열자료의 특성으로 인하여 독립성이 만족되지 않기 때문에 오차의 상관관계를 ARMA 모형으로 설명해야 한다.</p>
<div id="section-ts-reg" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> 시계열 회귀모형<a href="chapter-regression.html#section-ts-reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>추세 성분은 설명변수인 시점 <span class="math inline">\(t\)</span> 의 다항회귀모형으로 표현하게 된다.
선형 추세의 경우에는 다음과 같이 표현하고</p>
<p><span class="math display">\[
y_{t}=\beta_{0}+\beta_{1}~t+\epsilon_{t}
\]</span> 2차 추세의 경우에는 다음과 같이 표현한다.</p>
<p><span class="math display">\[
y_{t}=\beta_{0}+\beta_{1}~t+\beta_{2}~t^{2}+\epsilon_{t}
\]</span></p>
<p>계절성분은 dummy 변수 또는 Fourier series 변수로 표현하게 된다.
계절 성분을 dummy 변수로 표현하는 것은 각 계절 요소를 범주로 간주하는 것을 의미한다.
범주형 변수를 회귀모형에 설명변수로 포함시키는 방법은 자료가 해당 범주에 속하면 1, 아니면 0을 값으로 갖는 dummy 변수를 도입하는 것이다.
이 때 도입되는 dummy 변수의 개수는 범주의 개수보다 하나 작은 수가 되어야 절편 <span class="math inline">\(\beta_{0}\)</span> 를 유지시킬 수 있다.
따라서 주기가 <span class="math inline">\(m\)</span> 인 계절 성분을 설명하기 위해 <span class="math inline">\((m-1)\)</span> 개의 dummy 변수를 도입한다면, 절편 <span class="math inline">\(\beta_{0}\)</span> 가 포함된 회귀모형을 사용하게 된다.
예를 들어, 분기별 시계열자료의 경우에는 <span class="math inline">\(m=4\)</span> 이므로, 계절 회귀모형은 다음과 같이 3개의 dummy 변수로 표현할 수 있다.</p>
<p><span class="math display">\[
y_{t} = \beta_{0} + \beta_{1}D_{1,t}+\beta_{2}D_{2,t}+\beta_{3}D_{3,t}+\epsilon_{t}
\]</span></p>
<p>단, dummy 변수 <span class="math inline">\(D_{i,t}\)</span> 는 시점 <span class="math inline">\(t\)</span> 가 <span class="math inline">\(i\)</span> 분기이면 1, 아니면 0이 된다.
예를 들어, 2012년 1분기부터 관측된 자료에 대한 dummy 변수들의 값은 다음과 같이 주어진다.</p>
<table>
<thead>
<tr class="header">
<th align="center">t</th>
<th align="center">연도</th>
<th align="center">분기</th>
<th align="center"><span class="math inline">\(D_{1,t}\)</span></th>
<th align="center"><span class="math inline">\(D_{2,t}\)</span></th>
<th align="center"><span class="math inline">\(D_{3,t}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2012</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2012</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2012</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2012</td>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2013</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2013</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
<p>4분기에 대한 dummy 변수가 생략되었는데, 이와 같이 생략된 범주를 ’기준 범주’라고 하며, 회귀계수 <span class="math inline">\(\beta_{0}\)</span> 가 기준 범주의 효과를 나타내는 모수가 된다.
또한 dummy 변수의 계수 <span class="math inline">\(\beta_{i}\)</span> 는 기준 범주와 해당 범주의 효과 차이를 나타내는 모수가 된다.
따라서 <span class="math inline">\(\beta_{1}\)</span> 은 4분기와 1분기의 효과 차이를, <span class="math inline">\(\beta_{2}\)</span> 는 4분기와 2분기의 효과 차이를, <span class="math inline">\(\beta_{3}\)</span> 는 4분기와 3분기의 효과 차이를 각각 나타낸다.</p>
<p>계절 성분을 Fourier series 변수로 표현하는 것은 sine 변수와 cosine 변수의 선형 결합으로 계절 성분을 설명하겠다는 의미가 된다.
주기가 <span class="math inline">\(m\)</span> 인 시계열자료의 계절 성분은 다음과 같이 표현할 수 있다.</p>
<p><span class="math display">\[
y_{t}=\beta_{0} + \sum_{k=1}^{[m/2]} \left \{ \beta_{1k} \sin \left( \frac{2\pi kt}{m} \right) + \beta_{2k} \cos \left( \frac{2\pi kt}{m} \right)  \right \} + \epsilon_{t}
\]</span></p>
<p>단, <span class="math inline">\([m/2]\)</span> 는 <span class="math inline">\(m/2\)</span> 의 정수 부분이다.</p>
<p><span class="math inline">\(k=[m/2]\)</span> 일 때, <span class="math inline">\(\sin(2 \pi kt/m)=0\)</span> 이 되기 때문에, 주기가 <span class="math inline">\(m\)</span> 인 계절 성분에 대해서 <span class="math inline">\((m-1)\)</span> 개의 Fourier series 변수를 사용할 수 있다.
월별 자료의 경우에는 <span class="math inline">\(m=12\)</span> 이므로, 다음과 같은 11개의 변수를 사용할 수 있다.</p>
<table>
<thead>
<tr class="header">
<th align="center">주기</th>
<th align="center">변수</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">첫 번째 (<span class="math inline">\(k=1\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi t /12)\)</span>, <span class="math inline">\(\cos(2\pi t/12)\)</span></td>
</tr>
<tr class="even">
<td align="center">두 번째 (<span class="math inline">\(k=2\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi 2t /12)\)</span>, <span class="math inline">\(\cos(2\pi 2t/12)\)</span></td>
</tr>
<tr class="odd">
<td align="center">세 번째 (<span class="math inline">\(k=3\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi 3t /12)\)</span>, <span class="math inline">\(\cos(2\pi 3t/12)\)</span></td>
</tr>
<tr class="even">
<td align="center">네 번째 (<span class="math inline">\(k=4\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi 4t /12)\)</span>, <span class="math inline">\(\cos(2\pi 4t/12)\)</span></td>
</tr>
<tr class="odd">
<td align="center">다섯 번째 (<span class="math inline">\(k=5\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi 5t /12)\)</span>, <span class="math inline">\(\cos(2\pi 5t/12)\)</span></td>
</tr>
<tr class="even">
<td align="center">여섯 번째 (<span class="math inline">\(k=6\)</span>)</td>
<td align="center"><span class="math inline">\(\sin(2\pi 6t /12)\)</span></td>
</tr>
</tbody>
</table>
<p>계절 성분을 dummy 변수로 표현하는 경우에는 <span class="math inline">\((m-1)\)</span> 개의 dummy 변수를 모두 모형에 포함시켜야 <span class="math inline">\(m\)</span> 개의 계절 요소를 온전히 나타낼 수 있다.
그러나 Fourier series 변수의 경우에는 계절 성분의 파동 형태를 sine과 cosine 변수의 선형 결합으로 직접 설명하는 것이기 때문에, <span class="math inline">\((m-1)\)</span> 개 중 일부분만 선택해서 모형에 포함시키는 것이 가능한 방식이 된다.
Fourier series 변수 중에서 동일 주기의 sine과 cosine 변수는 함께 움직이는 변수가 된다.
즉, 함께 모형에 포함되거나 함께 제거되어야 한다.
또한 특정 주기가 선택되면, 그 이하 주기의 변수들은 모두 모형에 포함되어야 한다.
최적 주기는 AICc의 최소화를 기준으로 선택할 수 있다.</p>
<p>Fourier series 변수들의 선형 결합으로 나타낼 수 있는 파동 그래프를 살펴보자.
Figure <a href="chapter-regression.html#fig:fourier-1">5.1</a>의 첫 번째 그래프는 Fourier series 변수 중 첫 번째 주기 항의 단순 합인 <span class="math inline">\(\sin(2\pi t)/12) + \cos(2\pi t/12)\)</span> 의 그래프이다.
두 번째 그래프는 두 번째 주기 항의 단순 합인 <span class="math inline">\(\sin(2\pi 2t /12) + \cos(2\pi 2t/12)\)</span> 의 그래프이고,
세 번쨰 그래프는 세 번째 주기 항의 단순 합인 <span class="math inline">\(\sin(2\pi 3t /12) + \cos(2\pi 3t/12)\)</span> 의 그래프이다.</p>
<div class="figure"><span style="display:block;" id="fig:fourier-1"></span>
<img src="_main_files/figure-html/fourier-1-1.png" alt="Fourier series 변수 그래프" width="768" />
<p class="caption">
Figure 5.1: Fourier series 변수 그래프
</p>
</div>
<p>Figure <a href="chapter-regression.html#fig:fourier-2">5.2</a>는 각 주기의 이하 주기 변수들을 모두 합한 결과를 그래프로 나타낸 것이다.
두 번째 그래프는 <span class="math inline">\(\sum_{k=1}^{2} \{ \sin(2\pi kt/12) + \cos(2\pi kt/12) \}\)</span> 를 나타낸 것이고,
세 번째 그래프는 <span class="math inline">\(\sum_{k=1}^{3} \{ \sin(2\pi kt/12) + \cos(2\pi kt/12) \}\)</span> 를 나타낸 것이다.
다양한 파동 형태를 나타낼 수 있음을 알 수 있다.</p>
<div class="figure"><span style="display:block;" id="fig:fourier-2"></span>
<img src="_main_files/figure-html/fourier-2-1.png" alt="Fourier series 변수 그래프" width="768" />
<p class="caption">
Figure 5.2: Fourier series 변수 그래프
</p>
</div>
<ul>
<li>예제 : 분기별 호주 맥주 생산량 자료 (<code>fpp2::ausbeer</code>)</li>
</ul>
<p><code>ausbeer</code>는 1956년 1분기부터 2010년 2분기까지 호주의 분기별 맥주 생산량이다.
전체 기간 중 1975년 1분기 이후 자료에 대한 회귀모형을 적합시켜보자.
마지막 2년 자료는 test data로 남겨두자.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="chapter-regression.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_b <span class="ot">&lt;-</span> <span class="fu">window</span>(ausbeer, <span class="at">start =</span> <span class="dv">1975</span>, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2008</span>, <span class="dv">2</span>))</span>
<span id="cb117-2"><a href="chapter-regression.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> test_b <span class="ot">&lt;-</span> <span class="fu">window</span>(ausbeer, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2008</span>, <span class="dv">3</span>))</span></code></pre></div>
<p>Figure <a href="chapter-regression.html#fig:ausbeer-1">5.3</a>은 전체 자료의 시계열 그래프이다.
Test data는 빨간 색으로 구분했다.</p>
<div class="figure"><span style="display:block;" id="fig:ausbeer-1"></span>
<img src="_main_files/figure-html/ausbeer-1-1.png" alt="자료 `ausbeer`의 시계열 그래프" width="576" />
<p class="caption">
Figure 5.3: 자료 <code>ausbeer</code>의 시계열 그래프
</p>
</div>
<p>시계열자료에 대한 회귀모형의 적합은 함수 <code>tslm()</code>으로 할 수 있다.
함수 <code>tslm()</code>은 <code>lm()</code>과 실질적으로 동일한 함수지만,
ts 객체에 대한 회귀모형 적합을 위한 함수이다.
즉, 잔차 및 적합값이 ts 객체로 생성되고, 결측값 처리 방식이 시계열자료에 적합하도록 설정되었다.</p>
<p>추세 변수와 계절 변수를 시점 <span class="math inline">\(t\)</span> 를 이용하여 생성하는 방법을 살펴보자.
먼저 추세 변수는 함수 <code>time()</code>으로 자료가 관측된 시점을 생성할 수 있다.
자료 <code>train_b</code>에 대해 함수 <code>time()</code>을 적용한 결과를 살펴보자.
1975년 1분기 값을 1975.00으로 두고, 1/4 간격으로 다음 분기의 관측 시점을 생성하고 있다.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="chapter-regression.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">time</span>(train_b)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb118-2"><a href="chapter-regression.html#cb118-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1975.00</span> <span class="fl">1975.25</span> <span class="fl">1975.50</span> <span class="fl">1975.75</span> <span class="fl">1976.00</span> <span class="fl">1976.25</span> <span class="fl">1976.50</span> <span class="fl">1976.75</span> <span class="fl">1977.00</span></span></code></pre></div>
<p>관측 시점을 <span class="math inline">\(t = 1, 2, 3, \ldots\)</span> 로 하고, 그 값을 그대로 사용하고자 한다면,
<code>1:length(train_b)</code>를 추세 변수로 사용하거나,
함수 <code>tslm()</code>에서 <code>trend</code>를 변수로 사용하면 된다.</p>
<p>계절 변수로 dummy 변수를 사용한다면 함수 <code>forecast::seasonaldummy()</code>를 사용하거나,
함수 <code>tslm()</code>에서 <code>season</code>을 변수로 사용하면 된다.
계절 주기에 맞추어 필요한 dummy 변수를 생성한다.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="chapter-regression.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">seasonaldummy</span>(train_b)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb119-2"><a href="chapter-regression.html#cb119-2" aria-hidden="true" tabindex="-1"></a>     Q1 Q2 Q3</span>
<span id="cb119-3"><a href="chapter-regression.html#cb119-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]  <span class="dv">1</span>  <span class="dv">0</span>  <span class="dv">0</span></span>
<span id="cb119-4"><a href="chapter-regression.html#cb119-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,]  <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">0</span></span>
<span id="cb119-5"><a href="chapter-regression.html#cb119-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>,]  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">1</span></span>
<span id="cb119-6"><a href="chapter-regression.html#cb119-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>,]  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span></span>
<span id="cb119-7"><a href="chapter-regression.html#cb119-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">5</span>,]  <span class="dv">1</span>  <span class="dv">0</span>  <span class="dv">0</span></span></code></pre></div>
<p>Fourier series 변수를 사용한다면 함수 <code>forecast::fourier()</code>를 사용하면 된다.
모형에 포함되는 fourier series 변수들의 최대 주기는 <code>K</code>에 지정하면 된다.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="chapter-regression.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fourier</span>(train_b, <span class="at">K =</span> <span class="dv">2</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb120-2"><a href="chapter-regression.html#cb120-2" aria-hidden="true" tabindex="-1"></a>     S1<span class="dv">-4</span> C1<span class="dv">-4</span> C2<span class="dv">-4</span></span>
<span id="cb120-3"><a href="chapter-regression.html#cb120-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">1</span>    <span class="dv">0</span>   <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb120-4"><a href="chapter-regression.html#cb120-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,]    <span class="dv">0</span>   <span class="sc">-</span><span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb120-5"><a href="chapter-regression.html#cb120-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>,]   <span class="sc">-</span><span class="dv">1</span>    <span class="dv">0</span>   <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb120-6"><a href="chapter-regression.html#cb120-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>,]    <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb120-7"><a href="chapter-regression.html#cb120-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">5</span>,]    <span class="dv">1</span>    <span class="dv">0</span>   <span class="sc">-</span><span class="dv">1</span></span></code></pre></div>
<p>S1-4와 C1-4는 <span class="math inline">\(K=1\)</span> 에 해당하는 <span class="math inline">\(\sin(2\pi t/4)\)</span> 와 <span class="math inline">\(\cos(2\pi t/4)\)</span> 를 의미하고,
C2-4는 <span class="math inline">\(K=2\)</span> 에 해당하는 <span class="math inline">\(\cos(2\pi 2t/4)\)</span> 를 나타내고 있다.</p>
<p>함수 <code>time()</code>에 의한 추세 변수와 <code>seasonaldummy()</code>에 의한 계절 변수를 사용하여 회귀모형을 적합해 보고,
그 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="chapter-regression.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit1 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train_b <span class="sc">~</span> <span class="fu">time</span>(train_b) <span class="sc">+</span> <span class="fu">seasonaldummy</span>(train_b))</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="chapter-regression.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit1)</span>
<span id="cb122-2"><a href="chapter-regression.html#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="chapter-regression.html#cb122-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb122-4"><a href="chapter-regression.html#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tslm</span>(<span class="at">formula =</span> train_b <span class="sc">~</span> <span class="fu">time</span>(train_b) <span class="sc">+</span> <span class="fu">seasonaldummy</span>(train_b))</span>
<span id="cb122-5"><a href="chapter-regression.html#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="chapter-regression.html#cb122-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb122-7"><a href="chapter-regression.html#cb122-7" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb122-8"><a href="chapter-regression.html#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">47.776</span> <span class="sc">-</span><span class="fl">11.771</span>  <span class="sc">-</span><span class="fl">0.738</span>  <span class="fl">10.842</span>  <span class="fl">63.468</span> </span>
<span id="cb122-9"><a href="chapter-regression.html#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="chapter-regression.html#cb122-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb122-11"><a href="chapter-regression.html#cb122-11" aria-hidden="true" tabindex="-1"></a>                          Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb122-12"><a href="chapter-regression.html#cb122-12" aria-hidden="true" tabindex="-1"></a>(Intercept)              <span class="fl">5335.5613</span>   <span class="fl">325.0641</span>   <span class="fl">16.41</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb122-13"><a href="chapter-regression.html#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>(train_b)              <span class="sc">-</span><span class="fl">2.4112</span>     <span class="fl">0.1632</span>  <span class="sc">-</span><span class="fl">14.78</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb122-14"><a href="chapter-regression.html#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="fu">seasonaldummy</span>(train_b)Q1  <span class="sc">-</span><span class="fl">74.4299</span>     <span class="fl">4.4641</span>  <span class="sc">-</span><span class="fl">16.67</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb122-15"><a href="chapter-regression.html#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="fu">seasonaldummy</span>(train_b)Q2 <span class="sc">-</span><span class="fl">118.3271</span>     <span class="fl">4.4639</span>  <span class="sc">-</span><span class="fl">26.51</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb122-16"><a href="chapter-regression.html#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="fu">seasonaldummy</span>(train_b)Q3 <span class="sc">-</span><span class="fl">105.7240</span>     <span class="fl">4.4973</span>  <span class="sc">-</span><span class="fl">23.51</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb122-17"><a href="chapter-regression.html#cb122-17" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb122-18"><a href="chapter-regression.html#cb122-18" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb122-19"><a href="chapter-regression.html#cb122-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-20"><a href="chapter-regression.html#cb122-20" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">18.27</span> on <span class="dv">129</span> degrees of freedom</span>
<span id="cb122-21"><a href="chapter-regression.html#cb122-21" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8911</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8877</span> </span>
<span id="cb122-22"><a href="chapter-regression.html#cb122-22" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">263.9</span> on <span class="dv">4</span> and <span class="dv">129</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>이번에는 변수 <code>trend</code>와 <code>season</code>을 사용해서 적합해 보고, 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="chapter-regression.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit2 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train_b <span class="sc">~</span> trend <span class="sc">+</span> season)</span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="chapter-regression.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit2)</span>
<span id="cb124-2"><a href="chapter-regression.html#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="chapter-regression.html#cb124-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb124-4"><a href="chapter-regression.html#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tslm</span>(<span class="at">formula =</span> train_b <span class="sc">~</span> trend <span class="sc">+</span> season)</span>
<span id="cb124-5"><a href="chapter-regression.html#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="chapter-regression.html#cb124-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb124-7"><a href="chapter-regression.html#cb124-7" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb124-8"><a href="chapter-regression.html#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">47.776</span> <span class="sc">-</span><span class="fl">11.771</span>  <span class="sc">-</span><span class="fl">0.738</span>  <span class="fl">10.842</span>  <span class="fl">63.468</span> </span>
<span id="cb124-9"><a href="chapter-regression.html#cb124-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-10"><a href="chapter-regression.html#cb124-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb124-11"><a href="chapter-regression.html#cb124-11" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb124-12"><a href="chapter-regression.html#cb124-12" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">499.6812</span>     <span class="fl">4.1577</span> <span class="fl">120.181</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb124-13"><a href="chapter-regression.html#cb124-13" aria-hidden="true" tabindex="-1"></a>trend        <span class="sc">-</span><span class="fl">0.6028</span>     <span class="fl">0.0408</span> <span class="sc">-</span><span class="fl">14.775</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb124-14"><a href="chapter-regression.html#cb124-14" aria-hidden="true" tabindex="-1"></a>season2     <span class="sc">-</span><span class="fl">43.8972</span>     <span class="fl">4.4306</span>  <span class="sc">-</span><span class="fl">9.908</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb124-15"><a href="chapter-regression.html#cb124-15" aria-hidden="true" tabindex="-1"></a>season3     <span class="sc">-</span><span class="fl">31.2941</span>     <span class="fl">4.4639</span>  <span class="sc">-</span><span class="fl">7.011</span> <span class="fl">1.19e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb124-16"><a href="chapter-regression.html#cb124-16" aria-hidden="true" tabindex="-1"></a>season4      <span class="fl">74.4299</span>     <span class="fl">4.4641</span>  <span class="fl">16.673</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb124-17"><a href="chapter-regression.html#cb124-17" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb124-18"><a href="chapter-regression.html#cb124-18" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb124-19"><a href="chapter-regression.html#cb124-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-20"><a href="chapter-regression.html#cb124-20" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">18.27</span> on <span class="dv">129</span> degrees of freedom</span>
<span id="cb124-21"><a href="chapter-regression.html#cb124-21" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8911</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8877</span> </span>
<span id="cb124-22"><a href="chapter-regression.html#cb124-22" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">263.9</span> on <span class="dv">4</span> and <span class="dv">129</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p><code>fit1</code>과 <code>fit2</code>의 적합 결과가 서로 다른 것처럼 보인다.
그러나 추세의 기울기가 다른 것은 모형에서 사용된 X 변수의 간격이 다르기 때문이다.
즉, 두 모형의 추세 기울기가 4배 차이 나는 이유는
모형 <code>fit1</code>에서 사용된 X 변수의 간격이 1/4인 반면에
모형 <code>fit2</code>에서 사용된 X 변수의 간격은 1이기 때문이다.</p>
<p>또한 절편이 다른 것은 두 모형의 기준 범주가 다르며,
사용된 X 변수의 범위가 다르기 때문이다.
즉, <code>fit1</code>에서 사용된 X 변수는 1975.00부터 값을 갖고 있지만,
<code>fit2</code>에서는 X 변수가 1부터 값을 갖고 있으며,
함수 <code>seasonaldummy()</code>는 마지막 범주를 기준 범주로 설정하는데,
변수 <code>season</code>은 첫 번째 범주를 기준 범주로 설정하고 있어서,
dummy 변수의 구성도 다르게 된다.</p>
<p>두 모형의 적합값을 비교해 보면 실질적으로 같은 모형임을 알 수 있다.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="chapter-regression.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">fit1 =</span> fit1<span class="sc">$</span>fitted, <span class="at">fit2 =</span> fit2<span class="sc">$</span>fitted)</span>
<span id="cb125-2"><a href="chapter-regression.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 134 x 2</span></span>
<span id="cb125-3"><a href="chapter-regression.html#cb125-3" aria-hidden="true" tabindex="-1"></a>    fit1  fit2</span>
<span id="cb125-4"><a href="chapter-regression.html#cb125-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb125-5"><a href="chapter-regression.html#cb125-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>  <span class="fl">499.</span>  <span class="fl">499.</span></span>
<span id="cb125-6"><a href="chapter-regression.html#cb125-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>  <span class="fl">455.</span>  <span class="fl">455.</span></span>
<span id="cb125-7"><a href="chapter-regression.html#cb125-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>  <span class="fl">467.</span>  <span class="fl">467.</span></span>
<span id="cb125-8"><a href="chapter-regression.html#cb125-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>  <span class="fl">572.</span>  <span class="fl">572.</span></span>
<span id="cb125-9"><a href="chapter-regression.html#cb125-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>  <span class="fl">497.</span>  <span class="fl">497.</span></span>
<span id="cb125-10"><a href="chapter-regression.html#cb125-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>  <span class="fl">452.</span>  <span class="fl">452.</span></span>
<span id="cb125-11"><a href="chapter-regression.html#cb125-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>  <span class="fl">464.</span>  <span class="fl">464.</span></span>
<span id="cb125-12"><a href="chapter-regression.html#cb125-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>  <span class="fl">569.</span>  <span class="fl">569.</span></span>
<span id="cb125-13"><a href="chapter-regression.html#cb125-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>  <span class="fl">494.</span>  <span class="fl">494.</span></span>
<span id="cb125-14"><a href="chapter-regression.html#cb125-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  <span class="fl">450.</span>  <span class="fl">450.</span></span>
<span id="cb125-15"><a href="chapter-regression.html#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ... with 124 more rows</span></span></code></pre></div>
<p>이번에는 함수 <code>time()</code>에 의한 추세 변수와 <code>fourier()</code>에 의한 Fourier series 변수를 사용하여 회귀모형을 적합해 보고,
그 결과를 확인해 보자.
분기별 자료의 최대 주기인 <code>K=2</code>를 지정해서 확인해 보자.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="chapter-regression.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit3 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train_b <span class="sc">~</span> <span class="fu">time</span>(train_b) <span class="sc">+</span> <span class="fu">fourier</span>(train_b, <span class="at">K=</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="chapter-regression.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit3)</span>
<span id="cb127-2"><a href="chapter-regression.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="chapter-regression.html#cb127-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb127-4"><a href="chapter-regression.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tslm</span>(<span class="at">formula =</span> train_b <span class="sc">~</span> <span class="fu">time</span>(train_b) <span class="sc">+</span> <span class="fu">fourier</span>(train_b, <span class="at">K =</span> <span class="dv">2</span>))</span>
<span id="cb127-5"><a href="chapter-regression.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="chapter-regression.html#cb127-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb127-7"><a href="chapter-regression.html#cb127-7" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb127-8"><a href="chapter-regression.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">47.776</span> <span class="sc">-</span><span class="fl">11.771</span>  <span class="sc">-</span><span class="fl">0.738</span>  <span class="fl">10.842</span>  <span class="fl">63.468</span> </span>
<span id="cb127-9"><a href="chapter-regression.html#cb127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-10"><a href="chapter-regression.html#cb127-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb127-11"><a href="chapter-regression.html#cb127-11" aria-hidden="true" tabindex="-1"></a>                             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb127-12"><a href="chapter-regression.html#cb127-12" aria-hidden="true" tabindex="-1"></a>(Intercept)                 <span class="fl">5260.9410</span>   <span class="fl">325.0320</span>  <span class="fl">16.186</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb127-13"><a href="chapter-regression.html#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>(train_b)                 <span class="sc">-</span><span class="fl">2.4112</span>     <span class="fl">0.1632</span> <span class="sc">-</span><span class="fl">14.775</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb127-14"><a href="chapter-regression.html#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fourier</span>(train_b, <span class="at">K =</span> <span class="dv">2</span>)S1<span class="dv">-4</span>   <span class="fl">15.6471</span>     <span class="fl">2.2319</span>   <span class="fl">7.011</span> <span class="fl">1.19e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb127-15"><a href="chapter-regression.html#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="fu">fourier</span>(train_b, <span class="at">K =</span> <span class="dv">2</span>)C1<span class="dv">-4</span>   <span class="fl">59.1635</span>     <span class="fl">2.2319</span>  <span class="fl">26.508</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb127-16"><a href="chapter-regression.html#cb127-16" aria-hidden="true" tabindex="-1"></a><span class="fu">fourier</span>(train_b, <span class="at">K =</span> <span class="dv">2</span>)C2<span class="dv">-4</span>   <span class="fl">15.4567</span>     <span class="fl">1.5784</span>   <span class="fl">9.793</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb127-17"><a href="chapter-regression.html#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb127-18"><a href="chapter-regression.html#cb127-18" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb127-19"><a href="chapter-regression.html#cb127-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-20"><a href="chapter-regression.html#cb127-20" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">18.27</span> on <span class="dv">129</span> degrees of freedom</span>
<span id="cb127-21"><a href="chapter-regression.html#cb127-21" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8911</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8877</span> </span>
<span id="cb127-22"><a href="chapter-regression.html#cb127-22" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">263.9</span> on <span class="dv">4</span> and <span class="dv">129</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>Fourier series의 모든 변수를 사용한 모형은 dummy 변수를 사용한 모형과 실질적으로 동일한 모형이 된다.
<code>fit1</code>과 <code>fit3</code>의 적합값을 비교해 보자.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="chapter-regression.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">fit1 =</span> fit1<span class="sc">$</span>fitted, <span class="at">fit3 =</span> fit3<span class="sc">$</span>fitted)</span>
<span id="cb128-2"><a href="chapter-regression.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 134 x 2</span></span>
<span id="cb128-3"><a href="chapter-regression.html#cb128-3" aria-hidden="true" tabindex="-1"></a>    fit1  fit3</span>
<span id="cb128-4"><a href="chapter-regression.html#cb128-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb128-5"><a href="chapter-regression.html#cb128-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>  <span class="fl">499.</span>  <span class="fl">499.</span></span>
<span id="cb128-6"><a href="chapter-regression.html#cb128-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>  <span class="fl">455.</span>  <span class="fl">455.</span></span>
<span id="cb128-7"><a href="chapter-regression.html#cb128-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>  <span class="fl">467.</span>  <span class="fl">467.</span></span>
<span id="cb128-8"><a href="chapter-regression.html#cb128-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>  <span class="fl">572.</span>  <span class="fl">572.</span></span>
<span id="cb128-9"><a href="chapter-regression.html#cb128-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>  <span class="fl">497.</span>  <span class="fl">497.</span></span>
<span id="cb128-10"><a href="chapter-regression.html#cb128-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>  <span class="fl">452.</span>  <span class="fl">452.</span></span>
<span id="cb128-11"><a href="chapter-regression.html#cb128-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>  <span class="fl">464.</span>  <span class="fl">464.</span></span>
<span id="cb128-12"><a href="chapter-regression.html#cb128-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>  <span class="fl">569.</span>  <span class="fl">569.</span></span>
<span id="cb128-13"><a href="chapter-regression.html#cb128-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>  <span class="fl">494.</span>  <span class="fl">494.</span></span>
<span id="cb128-14"><a href="chapter-regression.html#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  <span class="fl">450.</span>  <span class="fl">450.</span></span>
<span id="cb128-15"><a href="chapter-regression.html#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ... with 124 more rows</span></span></code></pre></div>
<p>시계열자료 회귀모형의 모형 진단을 실시해서, 가정 만족에 문제가 있는지 확인해 보자.
함수 <code>checkresiduals()</code>는 <code>lm()</code> 또는 <code>tslm()</code>으로 생성된 객체에 대해서 Breusch-Godfrey 검정으로 독립성을 확인한다.
검정 결과는 오차가 독립이 아니라는 결론이며,
잔차의 시계열 그래프와 ACF에서도 같은 모습을 확인할 수 있다.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="chapter-regression.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="576" /></p>
<pre><code>
    Breusch-Godfrey test for serial correlation of order up to 8

data:  Residuals from Linear regression model
LM test = 30.158, df = 8, p-value = 0.0001982</code></pre>
<p>시계열자료에 회귀모형을 적합해 생성된 잔차 사이에는 강한 상관 관계가 존재하고 있음을 확인할 수 있었다.
이것은 설명이 안 된 패턴이 남아 있음을 의미하는 것이며,
따라서 추가적인 작업이 필요한 것이다.</p>
</div>
<div id="section-arma-ts-reg" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> ARMA 오차 시계열 회귀모형<a href="chapter-regression.html#section-arma-ts-reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>시계열자료 <span class="math inline">\(y_{t}\)</span> 에 대한 ARMA 오차 회귀모형은 다음과 같이 표현된다.</p>
<p><span class="math display">\[
y_{t} = \beta_{0} + \beta_{1}x_{1t} + \cdots + \beta_{k}x_{kt} + \eta_{t}
\]</span>
단, <span class="math inline">\(\eta_{t}\)</span> 는 ARMA(p,q) 모형을 따르는 회귀모형의 오차항이고,</p>
<p><span class="math display">\[
\left( 1-\phi_{1}B-\cdots-\phi_{p}B^{p} \right)\eta_{t} = (1+\theta_{1}B+\cdots+\theta_{q}B^{q})\epsilon_{t},
\]</span></p>
<p><span class="math inline">\(\epsilon_{t}\)</span> 는 ARMA 모형의 오차항으로써 백색잡음을 따르는 확률변수이다.</p>
<p><span class="math display">\[
\epsilon_{t} \sim WN(0,\sigma^{2})
\]</span></p>
<p>ARMA 오차 회귀모형을 적합하는 방법은 함수 <code>Arima()</code> 또는 <code>auto.arima()</code>를 사용하는 것이다.
회귀모형의 설명변수는 <code>xreg</code>에 벡터 혹은 행렬의 형태로 지정하면 된다.
설명변수가 하나인 경우에는 벡터 형태로 지정하면 되고,
두 개 이상의 설명변수를 포함시키는 경우에는 함수 <code>cbind()</code>를 사용하여 각 설명변수의 행렬을 형성해서 지정하면 된다.</p>
<ul>
<li>예제 : 자료 <code>ausbeer</code></li>
</ul>
<p><a href="chapter-regression.html#section-ts-reg">5.1.1</a>절의 예제에서 자료 <code>ausbeer</code>에 대해 백색잡음 회귀모형을 적합시켰으나.
잔차가 독립성을 만족하지 못하는 문제가 발견되었다.
잔차에 남아 있는 패턴을 ARMA 모형으로 설명하기 위해 ARMA 오차 회귀모형을 적합시켜보자.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="chapter-regression.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit4 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_b,</span>
<span id="cb131-2"><a href="chapter-regression.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(train_b), <span class="at">Qtr =</span> <span class="fu">seasonaldummy</span>(train_b)),</span>
<span id="cb131-3"><a href="chapter-regression.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="chapter-regression.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit4)</span>
<span id="cb132-2"><a href="chapter-regression.html#cb132-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_b </span>
<span id="cb132-3"><a href="chapter-regression.html#cb132-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)[<span class="dv">4</span>] errors </span>
<span id="cb132-4"><a href="chapter-regression.html#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="chapter-regression.html#cb132-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb132-6"><a href="chapter-regression.html#cb132-6" aria-hidden="true" tabindex="-1"></a>          ar1     ar2     ar3    sar1  intercept     Time    Qtr.Q1     Qtr.Q2</span>
<span id="cb132-7"><a href="chapter-regression.html#cb132-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">0.1233</span>  <span class="fl">0.1645</span>  <span class="fl">0.2440</span>  <span class="fl">0.4155</span>  <span class="fl">5227.3160</span>  <span class="sc">-</span><span class="fl">2.3573</span>  <span class="sc">-</span><span class="fl">73.4170</span>  <span class="sc">-</span><span class="fl">117.2944</span></span>
<span id="cb132-8"><a href="chapter-regression.html#cb132-8" aria-hidden="true" tabindex="-1"></a>s.e.   <span class="fl">0.0852</span>  <span class="fl">0.0831</span>  <span class="fl">0.0849</span>  <span class="fl">0.0817</span>   <span class="fl">611.6432</span>   <span class="fl">0.3071</span>    <span class="fl">6.0565</span>     <span class="fl">5.2917</span></span>
<span id="cb132-9"><a href="chapter-regression.html#cb132-9" aria-hidden="true" tabindex="-1"></a>         Qtr.Q3</span>
<span id="cb132-10"><a href="chapter-regression.html#cb132-10" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">105.5713</span></span>
<span id="cb132-11"><a href="chapter-regression.html#cb132-11" aria-hidden="true" tabindex="-1"></a>s.e.     <span class="fl">6.0999</span></span>
<span id="cb132-12"><a href="chapter-regression.html#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="chapter-regression.html#cb132-13" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">264.2</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="sc">-</span><span class="fl">559.59</span></span>
<span id="cb132-14"><a href="chapter-regression.html#cb132-14" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="fl">1139.19</span>   AICc<span class="ot">=</span><span class="fl">1140.97</span>   BIC<span class="ot">=</span><span class="fl">1168.16</span></span>
<span id="cb132-15"><a href="chapter-regression.html#cb132-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-16"><a href="chapter-regression.html#cb132-16" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb132-17"><a href="chapter-regression.html#cb132-17" aria-hidden="true" tabindex="-1"></a>                    ME     RMSE      MAE         MPE     MAPE      MASE</span>
<span id="cb132-18"><a href="chapter-regression.html#cb132-18" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.1677325</span> <span class="fl">15.69822</span> <span class="fl">12.11679</span> <span class="sc">-</span><span class="fl">0.07293605</span> <span class="fl">2.618274</span> <span class="fl">0.7416116</span></span>
<span id="cb132-19"><a href="chapter-regression.html#cb132-19" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb132-20"><a href="chapter-regression.html#cb132-20" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.004529308</span></span></code></pre></div>
<p>잔차에 가장 적합한 모형은 ARIMA(3,0,0)(1,0,0)<sub>4</sub>가 선택되었다.
즉, 잔차에 비계절형 요소 뿐 아니라 계절형 요소도 남아 있다는 것이다.</p>
<p>ARMA 오차 회귀모형 <code>fit4</code>에 대한 모형 진단을 실시해 보자.
모든 가정이 만족되고 있음을 알 수 있다.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="chapter-regression.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit4)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-88-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(3,0,0)(1,0,0)[4] errors
Q* = 6.4041, df = 3, p-value = 0.09352

Model df: 9.   Total lags used: 12</code></pre>
<p>ARMA 오차 회귀모형의 예측은 함수 <code>forecast()</code>로 할 수 있다.
사용법은 <code>forecast(object, xreg, ...)</code>가 되는데,
<code>object</code>에는 함수 <code>Arima()</code> 혹은 <code>auto.arima()</code>로 생성된 객체를 지정하고,
<code>xreg</code>에는 예측 시점에 대한 설명변수의 자료를 벡터 또는 행렬의 형태로 지정하면 된다.</p>
<p>Test data인 <code>test_b</code>에 대한 예측을 실시해 보자.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="chapter-regression.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc4 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit4, </span>
<span id="cb135-2"><a href="chapter-regression.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(test_b), <span class="at">Qtr =</span> <span class="fu">seasonaldummy</span>(test_b)))</span></code></pre></div>
<p>ARMA 오차 회귀모형의 예측 결과와 백색잡음 회귀모형의 예측 결과를 비교해 보자.
함수 <code>tslm()</code>에 변수 <code>trend</code>와 <code>season</code>을 사용한 <code>fit2</code>에 대한 예측은 다음과 같이 실시할 수 있다.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="chapter-regression.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit2 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(train_b <span class="sc">~</span> trend <span class="sc">+</span> season)</span>
<span id="cb136-2"><a href="chapter-regression.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit2, <span class="at">h =</span> <span class="fu">length</span>(test_b))</span></code></pre></div>
<p>점 예측 결과는 <code>fc2$mean</code>과 <code>fc4$mean</code>에 할당되어 있다.
두 결과를 비교해 보자.
큰 차이는 없는 것으로 보인다.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="chapter-regression.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">fc2 =</span> fc2<span class="sc">$</span>mean, <span class="at">fc4 =</span> fc4<span class="sc">$</span>mean)</span>
<span id="cb137-2"><a href="chapter-regression.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 8 x 2</span></span>
<span id="cb137-3"><a href="chapter-regression.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    fc2   fc4</span>
<span id="cb137-4"><a href="chapter-regression.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb137-5"><a href="chapter-regression.html#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">387.</span>  <span class="fl">383.</span></span>
<span id="cb137-6"><a href="chapter-regression.html#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">492.</span>  <span class="fl">485.</span></span>
<span id="cb137-7"><a href="chapter-regression.html#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">417.</span>  <span class="fl">420.</span></span>
<span id="cb137-8"><a href="chapter-regression.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">373.</span>  <span class="fl">378.</span></span>
<span id="cb137-9"><a href="chapter-regression.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">385.</span>  <span class="fl">384.</span></span>
<span id="cb137-10"><a href="chapter-regression.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">490.</span>  <span class="fl">487.</span></span>
<span id="cb137-11"><a href="chapter-regression.html#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  <span class="fl">415.</span>  <span class="fl">416.</span></span>
<span id="cb137-12"><a href="chapter-regression.html#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="fl">370.</span>  <span class="fl">373.</span></span></code></pre></div>
<p>95% 예측 구간의 폭을 비교해 보자.
예측 구간의 상한은 <code>fc2$upper</code>과 <code>fc4$upper</code>에 할당되었고,
하한은 <code>fc2$lower</code>과 <code>fc4$lower</code>에 각각 할당되어 있다.
예측 구간의 신뢰수준으로 80%와 95%가 사용되는 것이 디폴트이며,
따라서 다음과 같이 95% 예측 구간의 폭을 계산할 수 있다.
ARMA 오차 회귀모형의 예측 구간인 <code>fc4</code>의 폭이 더 좁은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="chapter-regression.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">fc2 =</span> fc2<span class="sc">$</span>upper[,<span class="dv">2</span>] <span class="sc">-</span> fc2<span class="sc">$</span>lower[,<span class="dv">2</span>], </span>
<span id="cb138-2"><a href="chapter-regression.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                <span class="at">fc4 =</span> fc4<span class="sc">$</span>upper[,<span class="dv">2</span>] <span class="sc">-</span> fc4<span class="sc">$</span>lower[,<span class="dv">2</span>])</span>
<span id="cb138-3"><a href="chapter-regression.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 8 x 2</span></span>
<span id="cb138-4"><a href="chapter-regression.html#cb138-4" aria-hidden="true" tabindex="-1"></a>    fc2   fc4</span>
<span id="cb138-5"><a href="chapter-regression.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb138-6"><a href="chapter-regression.html#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">74.2</span>  <span class="fl">63.7</span></span>
<span id="cb138-7"><a href="chapter-regression.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">74.2</span>  <span class="fl">64.2</span></span>
<span id="cb138-8"><a href="chapter-regression.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">74.2</span>  <span class="fl">65.2</span></span>
<span id="cb138-9"><a href="chapter-regression.html#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">74.2</span>  <span class="fl">66.5</span></span>
<span id="cb138-10"><a href="chapter-regression.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">74.3</span>  <span class="fl">71.0</span></span>
<span id="cb138-11"><a href="chapter-regression.html#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">74.3</span>  <span class="fl">71.0</span></span>
<span id="cb138-12"><a href="chapter-regression.html#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  <span class="fl">74.3</span>  <span class="fl">71.3</span></span>
<span id="cb138-13"><a href="chapter-regression.html#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="fl">74.3</span>  <span class="fl">71.5</span></span></code></pre></div>
<p>예측 오차의 크기를 비교해 보자.
예측 오차의 크기에는 큰 차이가 없음을 알 수 있다.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="chapter-regression.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc2, test_b)</span>
<span id="cb139-2"><a href="chapter-regression.html#cb139-2" aria-hidden="true" tabindex="-1"></a>                       ME     RMSE      MAE        MPE     MAPE      MASE</span>
<span id="cb139-3"><a href="chapter-regression.html#cb139-3" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">8.491860e-16</span> <span class="fl">17.92314</span> <span class="fl">13.57971</span> <span class="sc">-</span><span class="fl">0.1317235</span> <span class="fl">2.924979</span> <span class="fl">0.8311500</span></span>
<span id="cb139-4"><a href="chapter-regression.html#cb139-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="fl">9.745836e+00</span> <span class="fl">17.30833</span> <span class="fl">11.90530</span>  <span class="fl">2.4185316</span> <span class="fl">2.886254</span> <span class="fl">0.7286673</span></span>
<span id="cb139-5"><a href="chapter-regression.html#cb139-5" aria-hidden="true" tabindex="-1"></a>                    ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb139-6"><a href="chapter-regression.html#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set 0.007149994        NA</span></span>
<span id="cb139-7"><a href="chapter-regression.html#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     0.048860146 0.3056324</span></span>
<span id="cb139-8"><a href="chapter-regression.html#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; accuracy(fc4, test_b)</span></span>
<span id="cb139-9"><a href="chapter-regression.html#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="st">                     ME     RMSE      MAE         MPE     MAPE      MASE</span></span>
<span id="cb139-10"><a href="chapter-regression.html#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="st">Training set  0.1677325 15.69822 12.11679 -0.07293605 2.618274 0.7416116</span></span>
<span id="cb139-11"><a href="chapter-regression.html#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     10.0161277 17.40591 11.67960  2.42511984 2.826267 0.7148528</span></span>
<span id="cb139-12"><a href="chapter-regression.html#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="st">                    ACF1 Theil&#39;</span>s U</span>
<span id="cb139-13"><a href="chapter-regression.html#cb139-13" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.004529308</span>        <span class="cn">NA</span></span>
<span id="cb139-14"><a href="chapter-regression.html#cb139-14" aria-hidden="true" tabindex="-1"></a>Test set     <span class="fl">0.049644862</span> <span class="fl">0.2895782</span></span></code></pre></div>
<p>예측 결과를 그래프로 나타내서 비교해 보자.</p>
<div class="figure"><span style="display:block;" id="fig:ausbeer-2"></span>
<img src="_main_files/figure-html/ausbeer-2-1.png" alt="`ausbeer` 자료에 대한 예측 결과" width="768" />
<p class="caption">
Figure 5.4: <code>ausbeer</code> 자료에 대한 예측 결과
</p>
</div>
</div>
<div id="실습-예제-2" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> 실습 예제<a href="chapter-regression.html#실습-예제-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>예제 1 : 1970년 1월부터 2005년 12월까지 지구 기온 자료 (<code>global.txt</code>)</li>
</ul>
<p><code>global.txt</code>는 <a href="chapter-ts-plot.html#section-ts-plot">1.2.2</a>절에서 다루었던 지구 기온 자료이다.
1856년 1월부터 2005년 12월까지의 자료인데,
그 중 1970년 이후 자료만을 대상으로 예측 모형을 추정해 보자.
ARMA 오차 회귀모형과 ARIMA 모형, 그리고 ETS 모형으로 예측 모형을 각각 적합시키고,
예측 결과를 비교해 보자.</p>
<p>자료를 불러 들이고 training data와 test data로 분리시키자.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="chapter-regression.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> global <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;https://raw.githubusercontent.com/yjyjpark/TS-with-R/main/Data/global.txt&quot;</span>)</span>
<span id="cb140-2"><a href="chapter-regression.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> global.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(global, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1856</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb140-3"><a href="chapter-regression.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_g <span class="ot">&lt;-</span> <span class="fu">window</span>(global.ts, <span class="at">start =</span> <span class="dv">1970</span>, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">12</span>))</span>
<span id="cb140-4"><a href="chapter-regression.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> test_g <span class="ot">&lt;-</span> <span class="fu">window</span>(global.ts, <span class="at">start =</span> <span class="dv">2004</span>)</span></code></pre></div>
<p>Figure <a href="chapter-regression.html#fig:global-1">5.5</a>은 1970년부터 자료의 시계열 그래프이다.
Test data는 빨간 색으로 구분했다.</p>
<div class="figure"><span style="display:block;" id="fig:global-1"></span>
<img src="_main_files/figure-html/global-1-1.png" alt="자료 `global.txt`의 training data와 test data의 시계열 그래프" width="576" />
<p class="caption">
Figure 5.5: 자료 <code>global.txt</code>의 training data와 test data의 시계열 그래프
</p>
</div>
<ol style="list-style-type: decimal">
<li>ARMA 오차 회귀모형 적합</li>
</ol>
<p>계절 성분이 있는 시계열자료에 회귀모형을 적용할 때에는 계절 성분을 dummy 변수로 나타낼 것이지,
Fourier series 변수로 나타낼 것인지 선택해야 한다.<br />
먼저 선형 추세와 dummy 변수를 사용한 회귀모형을 적합시켜 보자.
추세 변수는 함수 <code>time()</code>으로 생성하고, 계절 변수는 함수 <code>seasonaldummy()</code>로 생성한다.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="chapter-regression.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Time <span class="ot">&lt;-</span> <span class="fu">time</span>(train_g)</span>
<span id="cb141-2"><a href="chapter-regression.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Month <span class="ot">&lt;-</span> <span class="fu">seasonaldummy</span>(train_g)</span></code></pre></div>
<p>모형 <code>fit1</code>의 적합 과정에서 <code>stepwise = FASLE</code>와 <code>approximation = FALSE</code>를 제외했는데,
두 옵션을 추가해도 같은 결과를 얻게 된다.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="chapter-regression.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_g, <span class="at">xreg =</span> <span class="fu">cbind</span>(Time, Month))</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="chapter-regression.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit1)</span>
<span id="cb143-2"><a href="chapter-regression.html#cb143-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_g </span>
<span id="cb143-3"><a href="chapter-regression.html#cb143-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>) errors </span>
<span id="cb143-4"><a href="chapter-regression.html#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="chapter-regression.html#cb143-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb143-6"><a href="chapter-regression.html#cb143-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2  intercept    Time  Month.Jan  Month.Feb  Month.Mar</span>
<span id="cb143-7"><a href="chapter-regression.html#cb143-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.4932</span>  <span class="fl">0.3204</span>   <span class="sc">-</span><span class="fl">34.5510</span>  <span class="fl">0.0175</span>     <span class="fl">0.0409</span>     <span class="fl">0.0522</span>     <span class="fl">0.0268</span></span>
<span id="cb143-8"><a href="chapter-regression.html#cb143-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0469</span>  <span class="fl">0.0472</span>     <span class="fl">4.2613</span>  <span class="fl">0.0021</span>     <span class="fl">0.0161</span>     <span class="fl">0.0171</span>     <span class="fl">0.0195</span></span>
<span id="cb143-9"><a href="chapter-regression.html#cb143-9" aria-hidden="true" tabindex="-1"></a>      Month.Apr  Month.May  Month.Jun  Month.Jul  Month.Aug  Month.Sep</span>
<span id="cb143-10"><a href="chapter-regression.html#cb143-10" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.0250</span>     <span class="fl">0.0093</span>     <span class="fl">0.0162</span>     <span class="fl">0.0137</span>     <span class="fl">0.0151</span>     <span class="fl">0.0002</span></span>
<span id="cb143-11"><a href="chapter-regression.html#cb143-11" aria-hidden="true" tabindex="-1"></a>s.e.     <span class="fl">0.0204</span>     <span class="fl">0.0211</span>     <span class="fl">0.0213</span>     <span class="fl">0.0211</span>     <span class="fl">0.0204</span>     <span class="fl">0.0194</span></span>
<span id="cb143-12"><a href="chapter-regression.html#cb143-12" aria-hidden="true" tabindex="-1"></a>      Month.Oct  Month.Nov</span>
<span id="cb143-13"><a href="chapter-regression.html#cb143-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">0.015</span>    <span class="sc">-</span><span class="fl">0.0304</span></span>
<span id="cb143-14"><a href="chapter-regression.html#cb143-14" aria-hidden="true" tabindex="-1"></a>s.e.      <span class="fl">0.017</span>     <span class="fl">0.0160</span></span>
<span id="cb143-15"><a href="chapter-regression.html#cb143-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-16"><a href="chapter-regression.html#cb143-16" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.007112</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">437.21</span></span>
<span id="cb143-17"><a href="chapter-regression.html#cb143-17" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">842.41</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">841.02</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">778.23</span></span>
<span id="cb143-18"><a href="chapter-regression.html#cb143-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-19"><a href="chapter-regression.html#cb143-19" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb143-20"><a href="chapter-regression.html#cb143-20" aria-hidden="true" tabindex="-1"></a>                        ME       RMSE        MAE      MPE     MAPE      MASE</span>
<span id="cb143-21"><a href="chapter-regression.html#cb143-21" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.0007778394</span> <span class="fl">0.08276884</span> <span class="fl">0.06379682</span> <span class="fl">22.62755</span> <span class="fl">81.57672</span> <span class="fl">0.4285951</span></span>
<span id="cb143-22"><a href="chapter-regression.html#cb143-22" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb143-23"><a href="chapter-regression.html#cb143-23" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.006984407</span></span></code></pre></div>
<p>잔차는 AR(2) 모형으로 적합되었다.</p>
<p>이번에는 선형 추세와 Fourier series 변수를 사용한 회귀모형을 적합시켜 보자.
Fourier series 변수를 사용하기 위해서는 최적 주기를 결정해야 한다.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="chapter-regression.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Time <span class="ot">&lt;-</span> <span class="fu">time</span>(train_g)</span>
<span id="cb144-2"><a href="chapter-regression.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">6</span>)</span>
<span id="cb144-3"><a href="chapter-regression.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(res)){</span>
<span id="cb144-4"><a href="chapter-regression.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Time, <span class="fu">fourier</span>(train_g, <span class="at">K =</span> i))</span>
<span id="cb144-5"><a href="chapter-regression.html#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_g, <span class="at">xreg =</span> xreg)</span>
<span id="cb144-6"><a href="chapter-regression.html#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   res[i] <span class="ot">&lt;-</span> fit<span class="sc">$</span>aicc</span>
<span id="cb144-7"><a href="chapter-regression.html#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p>객체 <code>res</code>에는 6개 모형의 AICc가 입력되어 있다.
그 중 두 번째 모형의 AICc가 가장 작은 값임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="chapter-regression.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> res</span>
<span id="cb145-2"><a href="chapter-regression.html#cb145-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">840.8765</span> <span class="sc">-</span><span class="fl">851.6310</span> <span class="sc">-</span><span class="fl">850.3429</span> <span class="sc">-</span><span class="fl">846.7538</span> <span class="sc">-</span><span class="fl">842.5771</span> <span class="sc">-</span><span class="fl">841.0206</span></span>
<span id="cb145-3"><a href="chapter-regression.html#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> (k_min <span class="ot">&lt;-</span> <span class="fu">which.min</span>(res))</span>
<span id="cb145-4"><a href="chapter-regression.html#cb145-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span></code></pre></div>
<p>이제 <span class="math inline">\(K=2\)</span> 를 최적 주기로 하는 Fourier series 변수를 사용한 회귀모형을 적합시켜 보자.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="chapter-regression.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Fourier <span class="ot">&lt;-</span> <span class="fu">fourier</span>(train_g, <span class="at">K =</span> k_min)</span>
<span id="cb146-2"><a href="chapter-regression.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit2 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_g, <span class="at">xreg =</span> <span class="fu">cbind</span>(Time, Fourier))</span></code></pre></div>
<p><code>fit1</code>의 경우와 동일하게 <code>fit2</code>에서도 잔차는 AR(2) 모형으로 적합되었다.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="chapter-regression.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit2)</span>
<span id="cb147-2"><a href="chapter-regression.html#cb147-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_g </span>
<span id="cb147-3"><a href="chapter-regression.html#cb147-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>) errors </span>
<span id="cb147-4"><a href="chapter-regression.html#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="chapter-regression.html#cb147-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb147-6"><a href="chapter-regression.html#cb147-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2  intercept    Time  Fourier.S1<span class="dv">-12</span>  Fourier.C1<span class="dv">-12</span></span>
<span id="cb147-7"><a href="chapter-regression.html#cb147-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.4919</span>  <span class="fl">0.3200</span>   <span class="sc">-</span><span class="fl">34.4729</span>  <span class="fl">0.0174</span>         <span class="fl">0.0210</span>        <span class="sc">-</span><span class="fl">0.0047</span></span>
<span id="cb147-8"><a href="chapter-regression.html#cb147-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0469</span>  <span class="fl">0.0472</span>     <span class="fl">4.2484</span>  <span class="fl">0.0021</span>         <span class="fl">0.0088</span>         <span class="fl">0.0087</span></span>
<span id="cb147-9"><a href="chapter-regression.html#cb147-9" aria-hidden="true" tabindex="-1"></a>      Fourier.S2<span class="dv">-12</span>  Fourier.C2<span class="dv">-12</span></span>
<span id="cb147-10"><a href="chapter-regression.html#cb147-10" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.0192</span>        <span class="sc">-</span><span class="fl">0.0054</span></span>
<span id="cb147-11"><a href="chapter-regression.html#cb147-11" aria-hidden="true" tabindex="-1"></a>s.e.         <span class="fl">0.0051</span>         <span class="fl">0.0051</span></span>
<span id="cb147-12"><a href="chapter-regression.html#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="chapter-regression.html#cb147-13" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.007062</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">435.04</span></span>
<span id="cb147-14"><a href="chapter-regression.html#cb147-14" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">852.08</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">851.63</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">815.98</span></span>
<span id="cb147-15"><a href="chapter-regression.html#cb147-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-16"><a href="chapter-regression.html#cb147-16" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb147-17"><a href="chapter-regression.html#cb147-17" aria-hidden="true" tabindex="-1"></a>                        ME       RMSE       MAE      MPE     MAPE      MASE</span>
<span id="cb147-18"><a href="chapter-regression.html#cb147-18" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.0007984029</span> <span class="fl">0.08320983</span> <span class="fl">0.0640202</span> <span class="fl">22.23643</span> <span class="fl">80.56552</span> <span class="fl">0.4300958</span></span>
<span id="cb147-19"><a href="chapter-regression.html#cb147-19" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb147-20"><a href="chapter-regression.html#cb147-20" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.004973903</span></span></code></pre></div>
<p>두 모형의 검진을 실시해 보자.
모형 <code>fit1</code>의 경우에는 독립성에 문제가 있는 것으로 보인다.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="chapter-regression.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-102-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(2,0,0) errors
Q* = 27.817, df = 9, p-value = 0.001024

Model df: 15.   Total lags used: 24</code></pre>
<p>독립성의 문제는 모형 <code>fit2</code>에도 있음을 알 수 있다.
다른 가정은 두 모형 모두 만족하는 것으로 보인다.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="chapter-regression.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-103-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(2,0,0) errors
Q* = 27.53, df = 16, p-value = 0.03595

Model df: 8.   Total lags used: 24</code></pre>
<p>독립성 가정을 만족시키지 못하는 모형의 경우에는 예측의 신빙성에 문제가 있을 수 있는데,
점 예측 (point forecast) 결과보다 예측 구간에 더 큰 문제가 있을 수 있다.
간혹 모든 가정을 만족시키는 모형을 찾지 못하는 경우도 있는데,
이런 경우에는 예측 결과를 적용할 때 조심할 필요가 있다.</p>
<p>이제 두 회귀모형 중 한 모형을 선택해 보자.
선택 기준으로는 AICc를 사용해 보자.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="chapter-regression.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit1<span class="sc">$</span>aicc</span>
<span id="cb152-2"><a href="chapter-regression.html#cb152-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">841.0206</span></span>
<span id="cb152-3"><a href="chapter-regression.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit2<span class="sc">$</span>aicc</span>
<span id="cb152-4"><a href="chapter-regression.html#cb152-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">851.631</span></span></code></pre></div>
<p>모형 <code>fit2</code>의 AICc가 더 작게 계산되었고,
따라서 최종 예측 모형으로 선택해 보자.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="chapter-regression.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_reg <span class="ot">&lt;-</span> fit2</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>ARIMA 모형의 적합</li>
</ol>
<p>차분 및 계절 차분이 필요한지 여부를 확인해 보자.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="chapter-regression.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ggtsdisplay</span>(train_g)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-106-1.png" width="576" /></p>
<p>뚜렷한 추세가 시계열 그래프에서 보이며,
표본 ACF 그래프에서 매우 큰 값의 <span class="math inline">\(r_{1}\)</span> 과 천천히 감소하는 모습에서 1차 차분이 필요한 것을 알 수 있다.
그러나 계절 차분이 필요한지 여부는 명확하게 보이지 않는다.
단위근 검정 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="chapter-regression.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ndiffs</span>(train_g)</span>
<span id="cb155-2"><a href="chapter-regression.html#cb155-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb155-3"><a href="chapter-regression.html#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nsdiffs</span>(train_g)</span>
<span id="cb155-4"><a href="chapter-regression.html#cb155-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span></code></pre></div>
<p>1차 차분은 필요하지만, 계절 차분은 필요 없는 것로 나타났다.
이제 1차 차분을 실시한 자료를 대상으로 시계열 그래프와 ACF, PACF를 작성해 보자.
정상성이 만족된 것으로 보인다.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="chapter-regression.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_g <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="chapter-regression.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">diff</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="chapter-regression.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">ggtsdisplay</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="576" /></p>
<p>이제 잔차의 표본 ACF와 PACF를 이용해서 모형 식별을 시도해 보자.
비계절 요소는 1시차에서 6시차까지의 패턴으로 인식하게 되는데,
ACF는 3시차까지 모두 유의하고, PACF는 1시차와 3시차가 유의한 것으로 나타났다.
이러한 경우에는 ACF를 감소, PACF는 감소 또는 3시차에서 절단으로 볼 수 있으며,
따라서 ARMA 모형이나 AR 모형이 가능할 것으로 보인다.
계절형 요소는 12, 24, 36시차에서 ACF와 PACF가 모두 매우 작은 값을 갖고 있기 때문에,
계절형 요소가 없는 것으로 볼 수도 있고, AR(1)<sub>12</sub> 또는 MA(1)<sub>12</sub>로 볼 수도 있는 상황이다.</p>
<p>함수 <code>auto.arima()</code>를 사용해서 AICc가 가장 작은 모형을 찾아 보자.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="chapter-regression.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_arima <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_g,</span>
<span id="cb157-2"><a href="chapter-regression.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                         <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb157-3"><a href="chapter-regression.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                         <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>적합 결과는 비계절형 요소만 있는 ARIMA(2,1,1)이 선택되었다.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="chapter-regression.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_arima)</span>
<span id="cb158-2"><a href="chapter-regression.html#cb158-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_g </span>
<span id="cb158-3"><a href="chapter-regression.html#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb158-4"><a href="chapter-regression.html#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="chapter-regression.html#cb158-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb158-6"><a href="chapter-regression.html#cb158-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2      ma1</span>
<span id="cb158-7"><a href="chapter-regression.html#cb158-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.5198</span>  <span class="fl">0.3008</span>  <span class="sc">-</span><span class="fl">0.9703</span></span>
<span id="cb158-8"><a href="chapter-regression.html#cb158-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0498</span>  <span class="fl">0.0492</span>   <span class="fl">0.0132</span></span>
<span id="cb158-9"><a href="chapter-regression.html#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="chapter-regression.html#cb158-10" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.007576</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">417.27</span></span>
<span id="cb158-11"><a href="chapter-regression.html#cb158-11" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">826.55</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">826.45</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">810.51</span></span>
<span id="cb158-12"><a href="chapter-regression.html#cb158-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-13"><a href="chapter-regression.html#cb158-13" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb158-14"><a href="chapter-regression.html#cb158-14" aria-hidden="true" tabindex="-1"></a>                      ME       RMSE        MAE      MPE     MAPE      MASE</span>
<span id="cb158-15"><a href="chapter-regression.html#cb158-15" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.006369769</span> <span class="fl">0.08661271</span> <span class="fl">0.06601014</span> <span class="fl">24.33015</span> <span class="fl">79.34066</span> <span class="fl">0.4434645</span></span>
<span id="cb158-16"><a href="chapter-regression.html#cb158-16" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb158-17"><a href="chapter-regression.html#cb158-17" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.003457635</span></span></code></pre></div>
<p>모형 <code>fit_arima</code>에 대한 검진을 실시해 보자.
모든 가정이 만족되고 있음을 볼 수 있다.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="chapter-regression.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_arima)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-111-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,1,1)
Q* = 30.228, df = 21, p-value = 0.08751

Model df: 3.   Total lags used: 24</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>ETS 모형의 적합</li>
</ol>
<p>함수 <code>ets()</code>로 AICc가 최소인 모형을 선택해 보자.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="chapter-regression.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_g)</span></code></pre></div>
<p>최적 모형은 ETS(A,N,N)이 선택되었다.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="chapter-regression.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_ets)</span>
<span id="cb162-2"><a href="chapter-regression.html#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ETS</span>(A,N,N) </span>
<span id="cb162-3"><a href="chapter-regression.html#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="chapter-regression.html#cb162-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb162-5"><a href="chapter-regression.html#cb162-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">ets</span>(<span class="at">y =</span> train_g) </span>
<span id="cb162-6"><a href="chapter-regression.html#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="chapter-regression.html#cb162-7" aria-hidden="true" tabindex="-1"></a>  Smoothing parameters<span class="sc">:</span></span>
<span id="cb162-8"><a href="chapter-regression.html#cb162-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">=</span> <span class="fl">0.5868</span> </span>
<span id="cb162-9"><a href="chapter-regression.html#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="chapter-regression.html#cb162-10" aria-hidden="true" tabindex="-1"></a>  Initial states<span class="sc">:</span></span>
<span id="cb162-11"><a href="chapter-regression.html#cb162-11" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">=</span> <span class="fl">0.0782</span> </span>
<span id="cb162-12"><a href="chapter-regression.html#cb162-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-13"><a href="chapter-regression.html#cb162-13" aria-hidden="true" tabindex="-1"></a>  sigma<span class="sc">:</span>  <span class="fl">0.0885</span></span>
<span id="cb162-14"><a href="chapter-regression.html#cb162-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-15"><a href="chapter-regression.html#cb162-15" aria-hidden="true" tabindex="-1"></a>     AIC     AICc      BIC </span>
<span id="cb162-16"><a href="chapter-regression.html#cb162-16" aria-hidden="true" tabindex="-1"></a><span class="fl">478.0785</span> <span class="fl">478.1379</span> <span class="fl">490.1123</span> </span>
<span id="cb162-17"><a href="chapter-regression.html#cb162-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-18"><a href="chapter-regression.html#cb162-18" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb162-19"><a href="chapter-regression.html#cb162-19" aria-hidden="true" tabindex="-1"></a>                      ME       RMSE        MAE      MPE     MAPE     MASE</span>
<span id="cb162-20"><a href="chapter-regression.html#cb162-20" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.001901676</span> <span class="fl">0.08829198</span> <span class="fl">0.06862716</span> <span class="fl">20.00303</span> <span class="fl">84.32056</span> <span class="fl">0.461046</span></span>
<span id="cb162-21"><a href="chapter-regression.html#cb162-21" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb162-22"><a href="chapter-regression.html#cb162-22" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.01131321</span></span></code></pre></div>
<p>모형 <code>fit_ets</code>에 대한 검진을 실시해 보자.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="chapter-regression.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_ets)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-114-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ETS(A,N,N)
Q* = 39.376, df = 22, p-value = 0.01277

Model df: 2.   Total lags used: 24</code></pre>
<p>독립성 가정에 문제가 있는 것으로 나타났다.</p>
<p>이제 세 가지 모형인 <code>fit_reg</code>, <code>fit_arima</code>, <code>fit_ets</code>에 의한 예측을 실시하고, 결과를 비교해 보자.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="chapter-regression.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> new_reg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(test_g), </span>
<span id="cb165-2"><a href="chapter-regression.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">Fourier =</span> <span class="fu">fourier</span>(test_g, <span class="at">K =</span> k_min)) </span>
<span id="cb165-3"><a href="chapter-regression.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_reg <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_reg, <span class="at">xreg =</span> new_reg)</span>
<span id="cb165-4"><a href="chapter-regression.html#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_arima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_arima, <span class="at">h =</span> <span class="fu">length</span>(test_g))</span>
<span id="cb165-5"><a href="chapter-regression.html#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_ets, <span class="at">h =</span> <span class="fu">length</span>(test_g))</span></code></pre></div>
<p>예측 오차를 비교해 보자.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="chapter-regression.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_reg, test_g)</span>
<span id="cb166-2"><a href="chapter-regression.html#cb166-2" aria-hidden="true" tabindex="-1"></a>                        ME       RMSE        MAE       MPE     MAPE      MASE</span>
<span id="cb166-3"><a href="chapter-regression.html#cb166-3" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.0007984029</span> <span class="fl">0.08320983</span> <span class="fl">0.06402020</span> <span class="fl">22.236428</span> <span class="fl">80.56552</span> <span class="fl">0.4300958</span></span>
<span id="cb166-4"><a href="chapter-regression.html#cb166-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">0.0266870191</span> <span class="fl">0.09047869</span> <span class="fl">0.06864433</span> <span class="sc">-</span><span class="fl">9.691571</span> <span class="fl">17.39724</span> <span class="fl">0.4611613</span></span>
<span id="cb166-5"><a href="chapter-regression.html#cb166-5" aria-hidden="true" tabindex="-1"></a>                    ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb166-6"><a href="chapter-regression.html#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set 0.004973903        NA</span></span>
<span id="cb166-7"><a href="chapter-regression.html#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     0.300995351  1.015694</span></span>
<span id="cb166-8"><a href="chapter-regression.html#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; accuracy(fc_arima, test_g)</span></span>
<span id="cb166-9"><a href="chapter-regression.html#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="st">                      ME       RMSE        MAE       MPE     MAPE      MASE</span></span>
<span id="cb166-10"><a href="chapter-regression.html#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="st">Training set 0.006369769 0.08661271 0.06601014 24.330149 79.34066 0.4434645</span></span>
<span id="cb166-11"><a href="chapter-regression.html#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     0.004650257 0.08557693 0.07319499 -2.829173 17.33066 0.4917332</span></span>
<span id="cb166-12"><a href="chapter-regression.html#cb166-12" aria-hidden="true" tabindex="-1"></a><span class="st">                    ACF1 Theil&#39;</span>s U</span>
<span id="cb166-13"><a href="chapter-regression.html#cb166-13" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.003457635</span>        <span class="cn">NA</span></span>
<span id="cb166-14"><a href="chapter-regression.html#cb166-14" aria-hidden="true" tabindex="-1"></a>Test set     <span class="fl">0.335253668</span> <span class="fl">0.9396727</span></span>
<span id="cb166-15"><a href="chapter-regression.html#cb166-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_ets, test_g)</span>
<span id="cb166-16"><a href="chapter-regression.html#cb166-16" aria-hidden="true" tabindex="-1"></a>                       ME       RMSE        MAE       MPE     MAPE      MASE</span>
<span id="cb166-17"><a href="chapter-regression.html#cb166-17" aria-hidden="true" tabindex="-1"></a>Training set  <span class="fl">0.001901676</span> <span class="fl">0.08829198</span> <span class="fl">0.06862716</span>  <span class="fl">20.00303</span> <span class="fl">84.32056</span> <span class="fl">0.4610460</span></span>
<span id="cb166-18"><a href="chapter-regression.html#cb166-18" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">0.062218811</span> <span class="fl">0.10436651</span> <span class="fl">0.07564587</span> <span class="sc">-</span><span class="fl">17.55797</span> <span class="fl">19.80559</span> <span class="fl">0.5081986</span></span>
<span id="cb166-19"><a href="chapter-regression.html#cb166-19" aria-hidden="true" tabindex="-1"></a>                    ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb166-20"><a href="chapter-regression.html#cb166-20" aria-hidden="true" tabindex="-1"></a><span class="st">Training set -0.01131321        NA</span></span>
<span id="cb166-21"><a href="chapter-regression.html#cb166-21" aria-hidden="true" tabindex="-1"></a><span class="st">Test set      0.26877094  1.191604</span></span></code></pre></div>
<p>Test data에 대한 예측 결과를 비교해 보면, 전체적으로 큰 차이는 없는 것으로 보인다.
MASE로는 ARMA 오차 회귀모형이 ARIMA 모형 보다 조금 작은 값을 보이고 있으나,
RMSE와 MAPE로는 ARIMA 모형이 조금 작은 값을 보이고 있다.</p>
<p>예측 결과를 그래프로 나타내 보자.</p>
<div class="figure"><span style="display:block;" id="fig:global-2"></span>
<img src="_main_files/figure-html/global-2-1.png" alt="자료 `global.txt`에 대한 세 모형의 예측 결과" width="768" />
<p class="caption">
Figure 5.6: 자료 <code>global.txt</code>에 대한 세 모형의 예측 결과
</p>
</div>
<ul>
<li>예제 2 : 1949년부터 1960년 월별 국제선 탑승자 수 자료 (<code>AirPassengers</code>)</li>
</ul>
<p><code>AirPassengers</code>는 1949년 1월부터 1960년 12월까지 월별 국제선 탑승자 수 자료이다.
ETS 모형과 ARIMA 모형, 그리고 ARMA 오차 회귀모형에 의한 예측 모형을 적합시키고, 예측 결과를 비교해 보자.
예측 결과의 평가를 위해 마지막 2년 자료는 test data로 남겨두자.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="chapter-regression.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_AP <span class="ot">&lt;-</span> <span class="fu">window</span>(AirPassengers, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1958</span>, <span class="dv">12</span>))</span>
<span id="cb167-2"><a href="chapter-regression.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> test_AP <span class="ot">&lt;-</span> <span class="fu">window</span>(AirPassengers, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>전체 기간에 대한 시계열 그래프를 작성해 보자.
Test data는 빨간 색으로 구분하였다.</p>
<div class="figure"><span style="display:block;" id="fig:AP-1"></span>
<img src="_main_files/figure-html/AP-1-1.png" alt="자료 `AirPassengers`의 시계열 그래프" width="576" />
<p class="caption">
Figure 5.7: 자료 <code>AirPassengers</code>의 시계열 그래프
</p>
</div>
<p>증가 추세가 있고, 명확한 계절 성분이 있는 자료이다.
또한 계절 변동 폭이 추세가 증가함에 따라 점점 커지고 있음도 알 수 있다.
따라서 분산 안정화가 필요한 자료이다.</p>
<p>분산 안정화를 위해 Box-Cox 변환 모수를 추정해 보자.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="chapter-regression.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> (lam <span class="ot">&lt;-</span> <span class="fu">BoxCox.lambda</span>(train_AP))</span>
<span id="cb168-2"><a href="chapter-regression.html#cb168-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">0.3096628</span></span></code></pre></div>
<p>변환 모수가 <span class="math inline">\(\lambda=-0.31\)</span> 로 추정되었다.
추정된 변환 모수에 의한 변환 결과와 로그 변환에 의한 결과를 비교해 보자.
Figure <a href="chapter-regression.html#fig:AP-2">5.8</a>에서 볼 수 있듯이 두 변환 결과는 크게 차이가 나지 않는 것으로 보인다.
이런 경우에는 변환 결과에 대한 해석이 가능한 로그 변환을 선택하는 것이 일반적이라고 하겠다.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="chapter-regression.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(patchwork)</span>
<span id="cb169-2"><a href="chapter-regression.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p1 <span class="ot">&lt;-</span> <span class="fu">BoxCox</span>(train_AP, <span class="at">lambda =</span> lam) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="chapter-regression.html#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb169-4"><a href="chapter-regression.html#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Box-Cox&quot;</span>, <span class="st">&quot;lambda = &quot;</span>, <span class="fu">signif</span>(lam, <span class="dv">3</span>)), <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb169-5"><a href="chapter-regression.html#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p2 <span class="ot">&lt;-</span> train_AP <span class="sc">%&gt;%</span> </span>
<span id="cb169-6"><a href="chapter-regression.html#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">log</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-7"><a href="chapter-regression.html#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Log&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb169-8"><a href="chapter-regression.html#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p1<span class="sc">+</span>p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:AP-2"></span>
<img src="_main_files/figure-html/AP-2-1.png" alt="분산 안정화 변환" width="768" />
<p class="caption">
Figure 5.8: 분산 안정화 변환
</p>
</div>
<ol style="list-style-type: decimal">
<li>ETS 모형 적합</li>
</ol>
<p>ETS 모형은 계절 성분을 승법 형태로 설명할 수 있는 모형이기 때문에,
계절 성분의 진폭 안정화가 반드시 필요한 모형은 아니다.
또한 모수에 대한 해석보다 예측이 주된 용도이기 때문에,
분산 안정화 변환 결과에 대한 해석이 그렇게 중요한 요소가 되지 않는다.
따라서 원자료에 대한 ETS 모형과 Box-Cox 변환 자료에 대한 ETS 모형,
그리고 로그 변환 자료에 대한 ETS 모형을 각각 적합하고 예측 결과를 비교해 보자.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="chapter-regression.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ets_1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_AP, <span class="at">lambda =</span> lam) </span>
<span id="cb170-2"><a href="chapter-regression.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ets_fc1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets_1, <span class="at">h =</span> <span class="fu">length</span>(test_AP)) </span>
<span id="cb170-3"><a href="chapter-regression.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb170-4"><a href="chapter-regression.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ets_2 <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_AP, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb170-5"><a href="chapter-regression.html#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ets_fc2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets_2, <span class="at">h =</span> <span class="fu">length</span>(test_AP)) </span>
<span id="cb170-6"><a href="chapter-regression.html#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb170-7"><a href="chapter-regression.html#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ets_3 <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_AP)</span>
<span id="cb170-8"><a href="chapter-regression.html#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ets_fc3 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets_3, <span class="at">h =</span> <span class="fu">length</span>(test_AP)) </span></code></pre></div>
<p>Figure <a href="chapter-regression.html#fig:AP-3">5.9</a>는 세 가지 ETS 모형의 예측 결과를 test data와 함께 나타낸 그래프이다.
Box-Cox 변환 자료에 대한 ETS 모형의 예측 결과가 test data와 가장 근접한 것으로 보인다.
Test data를 이용해서 모형을 선택하는 것이 바람직한 방식은 아니지만,
모형 비교를 위한 다른 마땅한 방법이 없는 상황을 고려하였다.</p>
<div class="figure"><span style="display:block;" id="fig:AP-3"></span>
<img src="_main_files/figure-html/AP-3-1.png" alt="ETS 모형의 예측 결과" width="768" />
<p class="caption">
Figure 5.9: ETS 모형의 예측 결과
</p>
</div>
<p>Box-Cox 변환 자료에 대한 ETS 모형을 최적 ETS 모형으로 선택하고, 모형 진단을 실시해 보자.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="chapter-regression.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_AP, <span class="at">lambda =</span> lam)</span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="chapter-regression.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_ets)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-121-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ETS(A,A,A)
Q* = 39.722, df = 8, p-value = 3.61e-06

Model df: 16.   Total lags used: 24</code></pre>
<p>독립성 가정은 위반하는 것으로 나타났다.</p>
<ol start="2" style="list-style-type: decimal">
<li>ARMA 오차 회귀모형 적합</li>
</ol>
<p>회귀모형은 분산 안정화가 필수적인 모형이며, 변환 결과에 대한 해석도 필요한 모형이다.
따라서 로그 변환된 자료를 대상으로 모형 적합을 진행해 보자.</p>
<p>계절 성분을 dummy 변수로 나타내는 모형을 적합해 보자.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="chapter-regression.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Time <span class="ot">&lt;-</span> <span class="fu">time</span>(train_AP)</span>
<span id="cb174-2"><a href="chapter-regression.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Month <span class="ot">&lt;-</span> <span class="fu">seasonaldummy</span>(train_AP)</span>
<span id="cb174-3"><a href="chapter-regression.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_r1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_AP, <span class="at">xreg =</span> <span class="fu">cbind</span>(Time, Month),</span>
<span id="cb174-4"><a href="chapter-regression.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                      <span class="at">lambda =</span> <span class="dv">0</span>) </span></code></pre></div>
<p><code>stepwise = FALSE</code>를 포함시키면 실행 시간이 지나치게 오래 걸리기 때문에 제외했다.
적합 결과를 살펴보자.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="chapter-regression.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_r1)</span>
<span id="cb175-2"><a href="chapter-regression.html#cb175-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_AP </span>
<span id="cb175-3"><a href="chapter-regression.html#cb175-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)[<span class="dv">12</span>] errors </span>
<span id="cb175-4"><a href="chapter-regression.html#cb175-4" aria-hidden="true" tabindex="-1"></a>Box Cox transformation<span class="sc">:</span> lambda<span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb175-5"><a href="chapter-regression.html#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="chapter-regression.html#cb175-6" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb175-7"><a href="chapter-regression.html#cb175-7" aria-hidden="true" tabindex="-1"></a>         ar1    sma1  intercept   Time  Month.Jan  Month.Feb  Month.Mar</span>
<span id="cb175-8"><a href="chapter-regression.html#cb175-8" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.7766</span>  <span class="fl">0.1651</span>  <span class="sc">-</span><span class="fl">236.9229</span>  <span class="fl">0.124</span>     <span class="fl">0.0127</span>     <span class="fl">0.0017</span>     <span class="fl">0.1369</span></span>
<span id="cb175-9"><a href="chapter-regression.html#cb175-9" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0674</span>  <span class="fl">0.0994</span>     <span class="fl">9.7959</span>  <span class="fl">0.005</span>     <span class="fl">0.0133</span>     <span class="fl">0.0173</span>     <span class="fl">0.0198</span></span>
<span id="cb175-10"><a href="chapter-regression.html#cb175-10" aria-hidden="true" tabindex="-1"></a>      Month.Apr  Month.May  Month.Jun  Month.Jul  Month.Aug  Month.Sep</span>
<span id="cb175-11"><a href="chapter-regression.html#cb175-11" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.0956</span>     <span class="fl">0.0872</span>     <span class="fl">0.2124</span>     <span class="fl">0.3096</span>     <span class="fl">0.3018</span>     <span class="fl">0.1660</span></span>
<span id="cb175-12"><a href="chapter-regression.html#cb175-12" aria-hidden="true" tabindex="-1"></a>s.e.     <span class="fl">0.0212</span>     <span class="fl">0.0220</span>     <span class="fl">0.0223</span>     <span class="fl">0.0219</span>     <span class="fl">0.0211</span>     <span class="fl">0.0195</span></span>
<span id="cb175-13"><a href="chapter-regression.html#cb175-13" aria-hidden="true" tabindex="-1"></a>      Month.Oct  Month.Nov</span>
<span id="cb175-14"><a href="chapter-regression.html#cb175-14" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.0254</span>    <span class="sc">-</span><span class="fl">0.1166</span></span>
<span id="cb175-15"><a href="chapter-regression.html#cb175-15" aria-hidden="true" tabindex="-1"></a>s.e.     <span class="fl">0.0170</span>     <span class="fl">0.0128</span></span>
<span id="cb175-16"><a href="chapter-regression.html#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="chapter-regression.html#cb175-17" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.001265</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">237.46</span></span>
<span id="cb175-18"><a href="chapter-regression.html#cb175-18" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">442.92</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">437.64</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">398.32</span></span>
<span id="cb175-19"><a href="chapter-regression.html#cb175-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-20"><a href="chapter-regression.html#cb175-20" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb175-21"><a href="chapter-regression.html#cb175-21" aria-hidden="true" tabindex="-1"></a>                    ME     RMSE      MAE         MPE    MAPE      MASE</span>
<span id="cb175-22"><a href="chapter-regression.html#cb175-22" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.1162335</span> <span class="fl">8.121727</span> <span class="fl">5.983055</span> <span class="sc">-</span><span class="fl">0.05581557</span> <span class="fl">2.58559</span> <span class="fl">0.2093875</span></span>
<span id="cb175-23"><a href="chapter-regression.html#cb175-23" aria-hidden="true" tabindex="-1"></a>                    ACF1</span>
<span id="cb175-24"><a href="chapter-regression.html#cb175-24" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.01965347</span></span></code></pre></div>
<p>잔차에 계절형과 비계절형 요소가 모두 남아 있는 것을 알 수 있다.
모형 검진을 실시해 보자.
독립성에 문제가 있는 것으로 보인다.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="chapter-regression.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_r1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-124-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(1,0,0)(0,0,1)[12] errors
Q* = 21.798, df = 9, p-value = 0.009543

Model df: 15.   Total lags used: 24</code></pre>
<p>이번에는 Fourier series 변수를 사용한 회귀모형을 적합해 보자.
먼저 최적 차수를 확인하자.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="chapter-regression.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Time <span class="ot">&lt;-</span> <span class="fu">time</span>(train_AP)</span>
<span id="cb178-2"><a href="chapter-regression.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">6</span>)</span>
<span id="cb178-3"><a href="chapter-regression.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(res)){</span>
<span id="cb178-4"><a href="chapter-regression.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Time, <span class="fu">fourier</span>(train_AP, <span class="at">K =</span> i))</span>
<span id="cb178-5"><a href="chapter-regression.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_AP, <span class="at">xreg =</span> xreg, </span>
<span id="cb178-6"><a href="chapter-regression.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                     <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb178-7"><a href="chapter-regression.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   res[i] <span class="ot">&lt;-</span> fit<span class="sc">$</span>aicc</span>
<span id="cb178-8"><a href="chapter-regression.html#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb178-9"><a href="chapter-regression.html#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> (min_k <span class="ot">&lt;-</span> <span class="fu">which.min</span>(res))</span>
<span id="cb178-10"><a href="chapter-regression.html#cb178-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">5</span></span></code></pre></div>
<p><span class="math inline">\(K=5\)</span> 가 최적 차수로 확인되었다.
최적 차수에 의한 Fourier series 변수를 사용한 회귀모형을 적합하고 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="chapter-regression.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Time <span class="ot">&lt;-</span> <span class="fu">time</span>(train_AP)</span>
<span id="cb179-2"><a href="chapter-regression.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Fourier <span class="ot">&lt;-</span> <span class="fu">fourier</span>(train_AP, <span class="at">K =</span> min_k)</span>
<span id="cb179-3"><a href="chapter-regression.html#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_r2 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_AP, <span class="at">xreg =</span> <span class="fu">cbind</span>(Time, Fourier),</span>
<span id="cb179-4"><a href="chapter-regression.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                      <span class="at">lambda =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="chapter-regression.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_r2)</span>
<span id="cb180-2"><a href="chapter-regression.html#cb180-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_AP </span>
<span id="cb180-3"><a href="chapter-regression.html#cb180-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)[<span class="dv">12</span>] errors </span>
<span id="cb180-4"><a href="chapter-regression.html#cb180-4" aria-hidden="true" tabindex="-1"></a>Box Cox transformation<span class="sc">:</span> lambda<span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb180-5"><a href="chapter-regression.html#cb180-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-6"><a href="chapter-regression.html#cb180-6" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb180-7"><a href="chapter-regression.html#cb180-7" aria-hidden="true" tabindex="-1"></a>         ar1     ar2    sar1  intercept    Time  Fourier.S1<span class="dv">-12</span>  Fourier.C1<span class="dv">-12</span></span>
<span id="cb180-8"><a href="chapter-regression.html#cb180-8" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.6384</span>  <span class="fl">0.1782</span>  <span class="fl">0.2060</span>  <span class="sc">-</span><span class="fl">233.8237</span>  <span class="fl">0.1224</span>        <span class="sc">-</span><span class="fl">0.0464</span>        <span class="sc">-</span><span class="fl">0.1379</span></span>
<span id="cb180-9"><a href="chapter-regression.html#cb180-9" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0910</span>  <span class="fl">0.0964</span>  <span class="fl">0.1057</span>    <span class="fl">12.3191</span>  <span class="fl">0.0063</span>         <span class="fl">0.0090</span>         <span class="fl">0.0090</span></span>
<span id="cb180-10"><a href="chapter-regression.html#cb180-10" aria-hidden="true" tabindex="-1"></a>      Fourier.S2<span class="dv">-12</span>  Fourier.C2<span class="dv">-12</span>  Fourier.S3<span class="dv">-12</span>  Fourier.C3<span class="dv">-12</span>  Fourier.S4<span class="dv">-12</span></span>
<span id="cb180-11"><a href="chapter-regression.html#cb180-11" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.0773</span>        <span class="sc">-</span><span class="fl">0.0259</span>        <span class="sc">-</span><span class="fl">0.0107</span>         <span class="fl">0.0264</span>         <span class="fl">0.0245</span></span>
<span id="cb180-12"><a href="chapter-regression.html#cb180-12" aria-hidden="true" tabindex="-1"></a>s.e.         <span class="fl">0.0051</span>         <span class="fl">0.0051</span>         <span class="fl">0.0039</span>         <span class="fl">0.0039</span>         <span class="fl">0.0036</span></span>
<span id="cb180-13"><a href="chapter-regression.html#cb180-13" aria-hidden="true" tabindex="-1"></a>      Fourier.C4<span class="dv">-12</span>  Fourier.S5<span class="dv">-12</span>  Fourier.C5<span class="dv">-12</span></span>
<span id="cb180-14"><a href="chapter-regression.html#cb180-14" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.0261</span>         <span class="fl">0.0206</span>         <span class="fl">0.0060</span></span>
<span id="cb180-15"><a href="chapter-regression.html#cb180-15" aria-hidden="true" tabindex="-1"></a>s.e.         <span class="fl">0.0036</span>         <span class="fl">0.0036</span>         <span class="fl">0.0036</span></span>
<span id="cb180-16"><a href="chapter-regression.html#cb180-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-17"><a href="chapter-regression.html#cb180-17" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.001256</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">237.75</span></span>
<span id="cb180-18"><a href="chapter-regression.html#cb180-18" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">443.49</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">438.21</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">398.89</span></span>
<span id="cb180-19"><a href="chapter-regression.html#cb180-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-20"><a href="chapter-regression.html#cb180-20" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb180-21"><a href="chapter-regression.html#cb180-21" aria-hidden="true" tabindex="-1"></a>                    ME     RMSE      MAE         MPE     MAPE      MASE</span>
<span id="cb180-22"><a href="chapter-regression.html#cb180-22" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.1302685</span> <span class="fl">8.156184</span> <span class="fl">6.052862</span> <span class="sc">-</span><span class="fl">0.05051831</span> <span class="fl">2.597827</span> <span class="fl">0.2118306</span></span>
<span id="cb180-23"><a href="chapter-regression.html#cb180-23" aria-hidden="true" tabindex="-1"></a>                   ACF1</span>
<span id="cb180-24"><a href="chapter-regression.html#cb180-24" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.09399082</span></span></code></pre></div>
<p>잔차에 계절형과 비계절형 요소가 모두 남아 있는 것을 알 수 있다.
모형 검진을 실시해 보자.
독립성에 문제가 있는 것으로 보인다.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="chapter-regression.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_r2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-128-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(2,0,0)(1,0,0)[12] errors
Q* = 17.88, df = 9, p-value = 0.03659

Model df: 15.   Total lags used: 24</code></pre>
<p>이제 두 모형 중 한 모형을 최적 모형으로 선택해야 한다.
사실 두 모형은 거의 동일한 모형이다.
두 번째 모형이 11개의 Fourier series 변수 중 10개 사용한 모형이기 때문인데,
만일 <span class="math inline">\(K=6\)</span> 이 선택되어 11개의 Fourier series 변수를 모두 사용한다면 dummy 변수를 사용한 모형과 사실상 동일한 모형이 된다.
두 모형의 AICc를 근거로 한 모형을 선택해 보자.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="chapter-regression.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_r1<span class="sc">$</span>aicc </span>
<span id="cb183-2"><a href="chapter-regression.html#cb183-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">437.642</span></span>
<span id="cb183-3"><a href="chapter-regression.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_r2<span class="sc">$</span>aicc</span>
<span id="cb183-4"><a href="chapter-regression.html#cb183-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">438.2119</span></span></code></pre></div>
<p>두 번째 모형의 AICc가 조금 더 작은 값으로 계산되었다.
따라서 Fourier series 변수를 사용한 모형을 최적 회귀모형으로 선택하자.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="chapter-regression.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_reg <span class="ot">&lt;-</span> fit_r2</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>ARIMA 모형 적합</li>
</ol>
<p>ARIMA 모형도 회귀모형의 경우처럼 분산 안정화가 필수적인 모형이며,
변환 결과에 대한 해석도 필요한 모형이다.
따라서 로그 변환된 자료를 대상으로 모형 적합을 진행해 보자.
우선 로그 변환된 자료에 대한 시계열 그래프와 표본 ACF를 작성해 보자.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-131-1.png" width="576" /></p>
<p>뚜렷한 추세와 계절 성분이 있는 자료임을 알 수 있다.
계절 차분을 실시하고, 그 결과를 확인해 보자.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-132-1.png" width="576" /></p>
<p>시계열 그래프와 ACF로는 1차 차분이 더 필요한지 여부를 확실하게 결정하기 어려워 보인다.<br />
이런 상황에서는 계절 차분만 실시한 자료에 대한 ARIMA 모형 적합도 시도해 볼 필요가 있는 것으로 보인다.</p>
<p>계절 차분된 자료에 1차 차분을 추가로 실시하고, 그 결과를 확인해 보자.
비정상성 요소가 완전히 제거된 것을 볼 수 있다.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-133-1.png" width="576" /></p>
<p>단위근 검정 결과를 확인해 보자.
계절 차분과 1차 차분이 모두 필요한 것으로 나타난다.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="chapter-regression.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_AP <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="chapter-regression.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">log</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb185-3"><a href="chapter-regression.html#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">ndiffs</span>()</span>
<span id="cb185-4"><a href="chapter-regression.html#cb185-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="chapter-regression.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> train_AP <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="chapter-regression.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">log</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="chapter-regression.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">nsdiffs</span>()</span>
<span id="cb186-4"><a href="chapter-regression.html#cb186-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<p>계절 차분과 1차 차분을 모두 실시한 자료를 대상으로 ARIMA 모형을 적합해 보자.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="chapter-regression.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_a1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_AP, <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb187-2"><a href="chapter-regression.html#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                     <span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>적합 결과는 다음과 같다.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="chapter-regression.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_a1)</span>
<span id="cb188-2"><a href="chapter-regression.html#cb188-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_AP </span>
<span id="cb188-3"><a href="chapter-regression.html#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ARIMA</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)[<span class="dv">12</span>] </span>
<span id="cb188-4"><a href="chapter-regression.html#cb188-4" aria-hidden="true" tabindex="-1"></a>Box Cox transformation<span class="sc">:</span> lambda<span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb188-5"><a href="chapter-regression.html#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="chapter-regression.html#cb188-6" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb188-7"><a href="chapter-regression.html#cb188-7" aria-hidden="true" tabindex="-1"></a>          ma1     sma1</span>
<span id="cb188-8"><a href="chapter-regression.html#cb188-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">0.3424</span>  <span class="sc">-</span><span class="fl">0.5405</span></span>
<span id="cb188-9"><a href="chapter-regression.html#cb188-9" aria-hidden="true" tabindex="-1"></a>s.e.   <span class="fl">0.1009</span>   <span class="fl">0.0877</span></span>
<span id="cb188-10"><a href="chapter-regression.html#cb188-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-11"><a href="chapter-regression.html#cb188-11" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.001432</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">197.51</span></span>
<span id="cb188-12"><a href="chapter-regression.html#cb188-12" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">389.02</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">388.78</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="dv">381</span></span>
<span id="cb188-13"><a href="chapter-regression.html#cb188-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-14"><a href="chapter-regression.html#cb188-14" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb188-15"><a href="chapter-regression.html#cb188-15" aria-hidden="true" tabindex="-1"></a>                     ME     RMSE     MAE         MPE     MAPE      MASE</span>
<span id="cb188-16"><a href="chapter-regression.html#cb188-16" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.2372088</span> <span class="fl">8.835339</span> <span class="fl">6.51704</span> <span class="sc">-</span><span class="fl">0.07508532</span> <span class="fl">2.637955</span> <span class="fl">0.2280753</span></span>
<span id="cb188-17"><a href="chapter-regression.html#cb188-17" aria-hidden="true" tabindex="-1"></a>                   ACF1</span>
<span id="cb188-18"><a href="chapter-regression.html#cb188-18" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.04249699</span></span></code></pre></div>
<p>모형 검진 결과에서는 어떤 문제도 발견되지 않았다.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="chapter-regression.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_a1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-138-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1)(0,1,1)[12]
Q* = 20.34, df = 22, p-value = 0.5618

Model df: 2.   Total lags used: 24</code></pre>
<p>이번에는 계절 차분만을 실시한 자료를 대상으로 ARIMA 모형을 적합해 보자.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="chapter-regression.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_a2 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_AP, <span class="at">d =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb191-2"><a href="chapter-regression.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                      <span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>적합 결과는 다음과 같다.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="chapter-regression.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit_a2)</span>
<span id="cb192-2"><a href="chapter-regression.html#cb192-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> train_AP </span>
<span id="cb192-3"><a href="chapter-regression.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)[<span class="dv">12</span>] with drift </span>
<span id="cb192-4"><a href="chapter-regression.html#cb192-4" aria-hidden="true" tabindex="-1"></a>Box Cox transformation<span class="sc">:</span> lambda<span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb192-5"><a href="chapter-regression.html#cb192-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-6"><a href="chapter-regression.html#cb192-6" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb192-7"><a href="chapter-regression.html#cb192-7" aria-hidden="true" tabindex="-1"></a>         ar1     ar2     sma1   drift</span>
<span id="cb192-8"><a href="chapter-regression.html#cb192-8" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.6159</span>  <span class="fl">0.2356</span>  <span class="sc">-</span><span class="fl">0.5562</span>  <span class="fl">0.0101</span></span>
<span id="cb192-9"><a href="chapter-regression.html#cb192-9" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0944</span>  <span class="fl">0.0965</span>   <span class="fl">0.0898</span>  <span class="fl">0.0010</span></span>
<span id="cb192-10"><a href="chapter-regression.html#cb192-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-11"><a href="chapter-regression.html#cb192-11" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.001382</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="fl">201.77</span></span>
<span id="cb192-12"><a href="chapter-regression.html#cb192-12" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="sc">-</span><span class="fl">393.53</span>   AICc<span class="ot">=</span><span class="sc">-</span><span class="fl">392.95</span>   BIC<span class="ot">=</span><span class="sc">-</span><span class="fl">380.12</span></span>
<span id="cb192-13"><a href="chapter-regression.html#cb192-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-14"><a href="chapter-regression.html#cb192-14" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb192-15"><a href="chapter-regression.html#cb192-15" aria-hidden="true" tabindex="-1"></a>                     ME     RMSE      MAE        MPE    MAPE      MASE</span>
<span id="cb192-16"><a href="chapter-regression.html#cb192-16" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.05350955</span> <span class="fl">8.616827</span> <span class="fl">6.212913</span> <span class="fl">0.05341167</span> <span class="fl">2.56018</span> <span class="fl">0.2174318</span></span>
<span id="cb192-17"><a href="chapter-regression.html#cb192-17" aria-hidden="true" tabindex="-1"></a>                   ACF1</span>
<span id="cb192-18"><a href="chapter-regression.html#cb192-18" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.04419876</span></span></code></pre></div>
<p>모형 검진을 실시해 보면, 모든 가정이 만족되는 것으로 보인다.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="chapter-regression.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_a2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-141-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,0,0)(0,1,1)[12] with drift
Q* = 20.83, df = 20, p-value = 0.4072

Model df: 4.   Total lags used: 24</code></pre>
<p>이제 두 모형 중 하나의 모형을 선택해 보자.
두 모형은 차분을 실시한 횟수가 각기 다른 자료를 사용한 것이기 때문에 AICc 등의 비교는 의미가 없다.
따라서 Test data를 대상으로 더 근접한 예측 결과를 산출하는 모형을 선택하기로 하자.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="chapter-regression.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_a1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_a1, <span class="at">h =</span> <span class="fu">length</span>(test_AP))</span>
<span id="cb195-2"><a href="chapter-regression.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_a2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_a2, <span class="at">h =</span> <span class="fu">length</span>(test_AP))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:AP-4"></span>
<img src="_main_files/figure-html/AP-4-1.png" alt="ARIMA 모형의 예측 결과" width="768" />
<p class="caption">
Figure 5.10: ARIMA 모형의 예측 결과
</p>
</div>
<p>두 번째 모형인 ARIMA(2,0,0)(0,1,1)<sub>12</sub>의 예측 결과가 test data에 더 근접한 것으로 보인다.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chapter-regression.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_arima <span class="ot">&lt;-</span> fit_a2</span></code></pre></div>
<p>이제는 ETS 모형과 ARIMA 모형, 그리고 ARMA 오차 회귀모형의 예측 결과를 비교해 보자.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="chapter-regression.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> new_t <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(test_AP), </span>
<span id="cb197-2"><a href="chapter-regression.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                <span class="at">Fourier =</span> <span class="fu">fourier</span>(test_AP, <span class="at">K =</span> min_k))</span>
<span id="cb197-3"><a href="chapter-regression.html#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_reg <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_r2, <span class="at">xreg =</span> new_t)</span>
<span id="cb197-4"><a href="chapter-regression.html#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb197-5"><a href="chapter-regression.html#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> fc_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_ets, <span class="at">h =</span> <span class="fu">length</span>(test_AP))</span>
<span id="cb197-6"><a href="chapter-regression.html#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_arima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_arima, <span class="at">h =</span> <span class="fu">length</span>(test_AP))</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="chapter-regression.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_reg, test_AP)</span>
<span id="cb198-2"><a href="chapter-regression.html#cb198-2" aria-hidden="true" tabindex="-1"></a>                      ME      RMSE       MAE         MPE     MAPE      MASE</span>
<span id="cb198-3"><a href="chapter-regression.html#cb198-3" aria-hidden="true" tabindex="-1"></a>Training set   <span class="fl">0.1302685</span>  <span class="fl">8.156184</span>  <span class="fl">6.052862</span> <span class="sc">-</span><span class="fl">0.05051831</span> <span class="fl">2.597827</span> <span class="fl">0.2118306</span></span>
<span id="cb198-4"><a href="chapter-regression.html#cb198-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">10.8769172</span> <span class="fl">22.234136</span> <span class="fl">15.437231</span> <span class="sc">-</span><span class="fl">2.58040950</span> <span class="fl">3.488570</span> <span class="fl">0.5402531</span></span>
<span id="cb198-5"><a href="chapter-regression.html#cb198-5" aria-hidden="true" tabindex="-1"></a>                   ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb198-6"><a href="chapter-regression.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set 0.09399082        NA</span></span>
<span id="cb198-7"><a href="chapter-regression.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     0.39683635 0.4785114</span></span>
<span id="cb198-8"><a href="chapter-regression.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; accuracy(fc_ets, test_AP)</span></span>
<span id="cb198-9"><a href="chapter-regression.html#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="st">                     ME      RMSE       MAE        MPE     MAPE      MASE</span></span>
<span id="cb198-10"><a href="chapter-regression.html#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="st">Training set  0.1851383  9.164883  6.647767  0.1873228 2.862835 0.2326503</span></span>
<span id="cb198-11"><a href="chapter-regression.html#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     -6.3756691 19.752432 14.199026 -1.4099460 3.219620 0.4969199</span></span>
<span id="cb198-12"><a href="chapter-regression.html#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="st">                  ACF1 Theil&#39;</span>s U</span>
<span id="cb198-13"><a href="chapter-regression.html#cb198-13" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.3728555</span>        <span class="cn">NA</span></span>
<span id="cb198-14"><a href="chapter-regression.html#cb198-14" aria-hidden="true" tabindex="-1"></a>Test set     <span class="fl">0.1682524</span> <span class="fl">0.4355005</span></span>
<span id="cb198-15"><a href="chapter-regression.html#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_arima, test_AP)</span>
<span id="cb198-16"><a href="chapter-regression.html#cb198-16" aria-hidden="true" tabindex="-1"></a>                      ME      RMSE       MAE         MPE     MAPE      MASE</span>
<span id="cb198-17"><a href="chapter-regression.html#cb198-17" aria-hidden="true" tabindex="-1"></a>Training set  <span class="fl">0.05350955</span>  <span class="fl">8.616827</span>  <span class="fl">6.212913</span>  <span class="fl">0.05341167</span> <span class="fl">2.560180</span> <span class="fl">0.2174318</span></span>
<span id="cb198-18"><a href="chapter-regression.html#cb198-18" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">3.33508240</span> <span class="fl">14.125641</span> <span class="fl">10.626775</span> <span class="sc">-</span><span class="fl">0.66418334</span> <span class="fl">2.356519</span> <span class="fl">0.3719027</span></span>
<span id="cb198-19"><a href="chapter-regression.html#cb198-19" aria-hidden="true" tabindex="-1"></a>                   ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb198-20"><a href="chapter-regression.html#cb198-20" aria-hidden="true" tabindex="-1"></a><span class="st">Training set 0.04419876        NA</span></span>
<span id="cb198-21"><a href="chapter-regression.html#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     0.14856147 0.2945598</span></span></code></pre></div>
<p>ARIMA 모형의 예측 오차가 가장 작은 것으로 나타났다.
예측 결과를 그래프로 비교해 보자.</p>
<div class="figure"><span style="display:block;" id="fig:AP-5"></span>
<img src="_main_files/figure-html/AP-5-1.png" alt="`AirPassengers` 자료에 대한 예측 결과 비교" width="768" />
<p class="caption">
Figure 5.11: <code>AirPassengers</code> 자료에 대한 예측 결과 비교
</p>
</div>
</div>
</div>
<div id="section-arma-dynamic" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Dynamic 회귀모형<a href="chapter-regression.html#section-arma-dynamic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="chapter-regression.html#section-arma-reg">5.1</a>절에서 살펴본 ARMA 오차 회귀모형은 실질적으로 관측 시점만을 설명변수로 사용하는 모형이다.
이런 모형으로는 갑작스런 변동 등을 효과적으로 예측하는데 한계가 있을 수밖에 없다.
만일 반응변수 시계열자료와 직접적 또는 간접적 관련이 있는 다른 시계열자료가 있다면,
시계열자료 사이의 관계를 이용해서 조금 더 효과적인 예측이 가능한 모형을 구성할 수 있을 것이다.</p>
<div id="arma-오차-dynamic-회귀모형" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> ARMA 오차 Dynamic 회귀모형<a href="chapter-regression.html#arma-오차-dynamic-회귀모형" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dynamic 회귀모형은 반응변수와 설명변수가 모두 시계열자료인 회귀모형을 지칭한다.
회귀모형의 오차는 백색잡음으로 설정하는 것도 가능하겠지만,
시계열자료의 특성을 고려한다면 ARMA 모형을 따르는 확률변수로 설정하는 것이 더 현실적이다.</p>
<p>반응변수 시계열자료 <span class="math inline">\(y_{t}\)</span> 와 설명변수로 사용되는 시계열자료 <span class="math inline">\(x_{1t}, \ldots, x_{kt}\)</span> 를 이용한 회귀모형은 다음과 같이 표현할 수 있다.</p>
<p><span class="math display" id="eq:dynamic-1">\[
y_{t} = \beta_{0} + \beta_{1}x_{1t} + \cdots + \beta_{k}x_{kt} + \eta_{t}
\tag{5.2}
\]</span>
단, 회귀모형의 오차항 <span class="math inline">\(\eta_{t}\)</span> 는 ARMA(p,q) 모형을 하며,
<span class="math display">\[
\phi(B)~ \eta_{t} = \theta(B)~\epsilon_{t}
\]</span></p>
<p>ARMA 모형의 오차항 <span class="math inline">\(\epsilon_{t}\)</span> 는 백색잡음 확률변수이다.
<span class="math display">\[
\epsilon_{t} \sim WN(0, \sigma^{2})
\]</span></p>
<p>식 <a href="chapter-regression.html#eq:dynamic-1">(5.2)</a>의 모든 변수는 정상 시계열자료임을 가정하고 있다.
차분이 필요한 변수가 있는 경우에,
해당 변수에 대해서만 차분을 실시한다면 식 <a href="chapter-regression.html#eq:dynamic-1">(5.2)</a>의 회귀모형 구조를 유지할 수 없게 된다.
따라서 차분이 필요한 변수가 하나라도 있으면,
회귀모형을 구성하고 있는 모든 변수에 대하여 차분을 실시해야 하며,
이런 경우에는 다음과 같이 절편이 제거된 모형으로 변형된다.</p>
<p><span class="math display">\[
y_{t}^{\prime} = \beta_{1}x_{1t}^{\prime} + \cdots + \beta_{k}x_{kt}^{\prime} + \eta_{t}^{\prime}
\]</span>
단, <span class="math inline">\(y_{t}^{\prime}=y_{t}-y_{t-1}\)</span>, <span class="math inline">\(x_{jt}^{\prime}=x_{jt}-x_{j,t-1}\)</span>, <span class="math inline">\(\eta_{t}^{\prime}=\eta_{t}-\eta_{t-1}\)</span> 이며,</p>
<p><span class="math inline">\(\eta_{t}^{\prime}\)</span> 은 ARMA(p,q) 분포를 한다.
<span class="math display">\[
\phi(B) \eta_{t}^{\prime}=\theta(B)\epsilon_{t}
\]</span></p>
<p>ARMA 오차 Dynamic 회귀모형의 적합은 함수 <code>Arima()</code> 또는 <code>auto.arima()</code>로 진행할 수 있다.</p>
</div>
<div id="실습-예제-3" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> 실습 예제<a href="chapter-regression.html#실습-예제-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>예제 1 : 2014년 호주 빅토리아주의 일일 전기 수요량 자료 (<code>fpp2::elecdaily</code>)</li>
</ul>
<p><code>elecdaily</code>는 <span class="math inline">\(365 \times 3\)</span> 의 ts 객체 행렬이다.
처음 3개 행을 출력해 보자.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="chapter-regression.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> elecdaily[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span>
<span id="cb199-2"><a href="chapter-regression.html#cb199-2" aria-hidden="true" tabindex="-1"></a>       Demand WorkDay Temperature</span>
<span id="cb199-3"><a href="chapter-regression.html#cb199-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">174.8963</span>       <span class="dv">0</span>        <span class="fl">26.0</span></span>
<span id="cb199-4"><a href="chapter-regression.html#cb199-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">188.5909</span>       <span class="dv">1</span>        <span class="fl">23.0</span></span>
<span id="cb199-5"><a href="chapter-regression.html#cb199-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>,] <span class="fl">188.9169</span>       <span class="dv">1</span>        <span class="fl">22.2</span></span></code></pre></div>
<p>첫 번째 열인 <code>Demand</code>는 일일 전기 수요량이고,
두 번째 열인 <code>WorkDay</code>는 휴일이면 0, 근무일이면 1을 값으로 갖고 있으며,
세 번째 열인 <code>Temperature</code>는 당일 최고 기온이다.
세 변수의 시계열 그래프를 작성해 보자.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="chapter-regression.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">autoplot</span>(elecdaily, <span class="at">facets =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elecd-1"></span>
<img src="_main_files/figure-html/elecd-1-1.png" alt="자료 `elecdaily`를 구성하고 있는 세 변수의 시계열 그래프" width="576" />
<p class="caption">
Figure 5.12: 자료 <code>elecdaily</code>를 구성하고 있는 세 변수의 시계열 그래프
</p>
</div>
<p>시계열자료 행렬 <code>elecdaily</code>의 열을 개별 시계열자료로 분리해 보자.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="chapter-regression.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Demand <span class="ot">&lt;-</span> elecdaily[,<span class="dv">1</span>]</span>
<span id="cb201-2"><a href="chapter-regression.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Work <span class="ot">&lt;-</span> elecdaily[,<span class="dv">2</span>]</span>
<span id="cb201-3"><a href="chapter-regression.html#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Temp <span class="ot">&lt;-</span> elecdaily[,<span class="dv">3</span>]</span></code></pre></div>
<p>세 시계열자료는 동일한 기간과 주기를 갖고 있는데,
변수 <code>Demand</code>로 확인해 보자.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="chapter-regression.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">start</span>(Demand)</span>
<span id="cb202-2"><a href="chapter-regression.html#cb202-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span> <span class="dv">4</span></span>
<span id="cb202-3"><a href="chapter-regression.html#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">end</span>(Demand)</span>
<span id="cb202-4"><a href="chapter-regression.html#cb202-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">53</span>  <span class="dv">4</span></span>
<span id="cb202-5"><a href="chapter-regression.html#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">frequency</span>(Demand)</span>
<span id="cb202-6"><a href="chapter-regression.html#cb202-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">7</span></span></code></pre></div>
<p>시작 시점은 2014년 첫 번째 주 네 번째 날이고, 종료 시점은 2014년 53번째 주 네 번째 날이다.
일일 자료이므로 주기는 7로 설정되어 있다.
주 중 네 번째 날의 요일은 다음과 같이 함수 <code>lubridate::wday()</code>로 할 수 있다.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="chapter-regression.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(lubridate)</span>
<span id="cb203-2"><a href="chapter-regression.html#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">wday</span>(<span class="fu">ymd</span>(<span class="st">&quot;2014-1-1&quot;</span>), <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb203-3"><a href="chapter-regression.html#cb203-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] 수</span>
<span id="cb203-4"><a href="chapter-regression.html#cb203-4" aria-hidden="true" tabindex="-1"></a>Levels<span class="sc">:</span> 일 <span class="sc">&lt;</span> 월 <span class="sc">&lt;</span> 화 <span class="sc">&lt;</span> 수 <span class="sc">&lt;</span> 목 <span class="sc">&lt;</span> 금 <span class="sc">&lt;</span> 토</span></code></pre></div>
<p>반응변수인 <code>Demand</code>와 셜명변수인 <code>Temp</code>의 정상성 만족 여부를 확인해 보자.
두 변수 모두 차분이 필요한 것으로 보인다.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-150-1.png" width="576" /></p>
<p><img src="_main_files/figure-html/unnamed-chunk-151-1.png" width="576" /></p>
<p>단위근 검정 결과도 확인해 보자.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="chapter-regression.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ndiffs</span>(Demand)</span>
<span id="cb204-2"><a href="chapter-regression.html#cb204-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb204-3"><a href="chapter-regression.html#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ndiffs</span>(Temp)</span>
<span id="cb204-4"><a href="chapter-regression.html#cb204-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<p>이제 두 변수의 관계를 산점도를 이용해서 살펴보자.
Figure <a href="chapter-regression.html#fig:elecd-2">5.13</a>에서 두 변수 사이에 2차 함수의 관계가 있음을 볼 수 있다.
회귀모형에 변수 <code>Temp</code>의 제곱항도 포함시켜야 할 것으로 보인다.</p>
<div class="figure"><span style="display:block;" id="fig:elecd-2"></span>
<img src="_main_files/figure-html/elecd-2-1.png" alt="`Demand`와 `Temperature`의 산점도" width="576" />
<p class="caption">
Figure 5.13: <code>Demand</code>와 <code>Temperature</code>의 산점도
</p>
</div>
<p>Dynamic 회귀모형을 적합시켜보자.
함수 <code>auto.arima()</code>에 설명변수 <code>Temp</code>와 <code>Temp^2</code>, <code>Work</code>를 행렬 형태로 <code>xreg</code>에 지정해 보자.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="chapter-regression.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Temp, <span class="at">Temp2 =</span> Temp<span class="sc">^</span><span class="dv">2</span>, Work)</span>
<span id="cb205-2"><a href="chapter-regression.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(Demand, <span class="at">xreg =</span> xreg, <span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>적합 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="chapter-regression.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit)</span>
<span id="cb206-2"><a href="chapter-regression.html#cb206-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> Demand </span>
<span id="cb206-3"><a href="chapter-regression.html#cb206-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)[<span class="dv">7</span>] errors </span>
<span id="cb206-4"><a href="chapter-regression.html#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="chapter-regression.html#cb206-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb206-6"><a href="chapter-regression.html#cb206-6" aria-hidden="true" tabindex="-1"></a>         ar1      ar2      ma1    sar1    sar2     Temp   Temp2     Work</span>
<span id="cb206-7"><a href="chapter-regression.html#cb206-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.8247</span>  <span class="sc">-</span><span class="fl">0.0225</span>  <span class="sc">-</span><span class="fl">0.9806</span>  <span class="fl">0.2216</span>  <span class="fl">0.4008</span>  <span class="sc">-</span><span class="fl">7.8847</span>  <span class="fl">0.1849</span>  <span class="fl">30.3192</span></span>
<span id="cb206-8"><a href="chapter-regression.html#cb206-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0700</span>   <span class="fl">0.0666</span>   <span class="fl">0.0203</span>  <span class="fl">0.0552</span>  <span class="fl">0.0566</span>   <span class="fl">0.4457</span>  <span class="fl">0.0088</span>   <span class="fl">1.3390</span></span>
<span id="cb206-9"><a href="chapter-regression.html#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="chapter-regression.html#cb206-10" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">44.7</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="sc">-</span><span class="fl">1205.77</span></span>
<span id="cb206-11"><a href="chapter-regression.html#cb206-11" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="fl">2429.54</span>   AICc<span class="ot">=</span><span class="fl">2430.04</span>   BIC<span class="ot">=</span><span class="fl">2464.61</span></span>
<span id="cb206-12"><a href="chapter-regression.html#cb206-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-13"><a href="chapter-regression.html#cb206-13" aria-hidden="true" tabindex="-1"></a>Training set error measures<span class="sc">:</span></span>
<span id="cb206-14"><a href="chapter-regression.html#cb206-14" aria-hidden="true" tabindex="-1"></a>                     ME     RMSE      MAE         MPE     MAPE      MASE</span>
<span id="cb206-15"><a href="chapter-regression.html#cb206-15" aria-hidden="true" tabindex="-1"></a>Training set <span class="fl">0.01290229</span> <span class="fl">6.602876</span> <span class="fl">4.767955</span> <span class="sc">-</span><span class="fl">0.09519977</span> <span class="fl">2.159123</span> <span class="fl">0.3273729</span></span>
<span id="cb206-16"><a href="chapter-regression.html#cb206-16" aria-hidden="true" tabindex="-1"></a>                     ACF1</span>
<span id="cb206-17"><a href="chapter-regression.html#cb206-17" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.000989946</span></span></code></pre></div>
<p>적합된 회귀모형에 절편이 없는 것을 볼 수 있는데,
이것은 차분을 실시한 자료를 대상으로 회귀모형을 적합시켰기 때문이다.</p>
<p>적합된 모형의 진단을 실시해 보자.
독립성 가정에는 문제가 있는 것으로 보인다.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="chapter-regression.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-155-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(2,1,1)(2,0,0)[7] errors
Q* = 36.219, df = 6, p-value = 2.499e-06

Model df: 8.   Total lags used: 14</code></pre>
<p>이제 적합된 Dynamic 회귀모형을 이용해서 2015년 1월 1이부터 1월 10일까지의 전력 수요량을 예측해 보자.
이 때 문제가 되는 것은 해당 기간에 대한 변수 <code>Temp</code>의 값도 미리 알 수 없다는 것이다.
이 문제는 변수 <code>Temp</code>의 미래 값을 다른 방법으로 예측해서 사용하거나,
특정한 값으로 가정하고 <code>Demand</code>의 미래 값을 예측해야 한다.</p>
<p>여기에서는 2014년 1월 1일부터 1월 10일까지의 <code>Temp</code> 값을 그대로 사용해서 예측을 실시해 보자.
변수 <code>Work</code>의 값은 2015년 1월 1일 목요일부터 1월 10일 토요일까지 휴일과 근무일을 구분해서 입력할 수 있다.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="chapter-regression.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> old_T <span class="ot">&lt;-</span> Temp[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb209-2"><a href="chapter-regression.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> new_x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Temp =</span> old_T, <span class="at">Temp2 =</span> old_T<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb209-3"><a href="chapter-regression.html#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                <span class="at">Work =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb209-4"><a href="chapter-regression.html#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">xreg =</span> new_x)</span></code></pre></div>
<p>예측 결과에 대한 그래프를 작성해 보자.</p>
<div class="figure"><span style="display:block;" id="fig:elecd-3"></span>
<img src="_main_files/figure-html/elecd-3-1.png" alt="`Demand`의 예측 결과" width="576" />
<p class="caption">
Figure 5.14: <code>Demand</code>의 예측 결과
</p>
</div>
<ul>
<li>예제 2 : 미국 소득, 소비 등의 1970년 1분기부터 2016년 3분기까지 분기별 변화 비율 (<code>fpp2::uschange</code>)</li>
</ul>
<p><code>uschange</code>는 <span class="math inline">\(187 \times 5\)</span> 의 ts 객체 행렬이다.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="chapter-regression.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> uschange[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span>
<span id="cb210-2"><a href="chapter-regression.html#cb210-2" aria-hidden="true" tabindex="-1"></a>     Consumption   Income Production  Savings Unemployment</span>
<span id="cb210-3"><a href="chapter-regression.html#cb210-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]   <span class="fl">0.6159862</span> <span class="fl">0.972261</span> <span class="sc">-</span><span class="fl">2.4527003</span> <span class="fl">4.810312</span>          <span class="fl">0.9</span></span>
<span id="cb210-4"><a href="chapter-regression.html#cb210-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,]   <span class="fl">0.4603757</span> <span class="fl">1.169085</span> <span class="sc">-</span><span class="fl">0.5515251</span> <span class="fl">7.287992</span>          <span class="fl">0.5</span></span>
<span id="cb210-5"><a href="chapter-regression.html#cb210-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>,]   <span class="fl">0.8767914</span> <span class="fl">1.553271</span> <span class="sc">-</span><span class="fl">0.3587079</span> <span class="fl">7.289013</span>          <span class="fl">0.5</span></span></code></pre></div>
<p>다섯 개 시계열자료는 동일한 시작 시점, 종료 시점과 주기를 갖고 있는데,
첫 번째 시계열자료를 이용해서 확인해 보자.
분기별 자료이므로 주기는 4이고,
시작 시점은 1970년 1분기이며, 종료 시점은 2016년 3분기이다.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="chapter-regression.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">start</span>(uschange[,<span class="dv">1</span>])</span>
<span id="cb211-2"><a href="chapter-regression.html#cb211-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1970</span>    <span class="dv">1</span></span>
<span id="cb211-3"><a href="chapter-regression.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">end</span>(uschange[,<span class="dv">1</span>])</span>
<span id="cb211-4"><a href="chapter-regression.html#cb211-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2016</span>    <span class="dv">3</span></span>
<span id="cb211-5"><a href="chapter-regression.html#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">frequency</span>(uschange[,<span class="dv">1</span>])</span>
<span id="cb211-6"><a href="chapter-regression.html#cb211-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
<p>첫 번째 시계열자료인 <code>Consumption</code>에 대한 예측 모형을 적합해 보자.
ARIMA 모형과 ETS 모형에 의한 예측 모형, ARMA 오차 회귀모형, 그리고
행렬 <code>uschange</code>의 다른 시계열자료를 설명변수로 사용하는 dynamic 회귀모형에 의한 예측 모형을 적합해 보자.</p>
<p><code>uschange</code>를 구성하고 있는 다섯 변수의 시계열 그래프를 작성해 보자.</p>
<div class="figure"><span style="display:block;" id="fig:uschange-1"></span>
<img src="_main_files/figure-html/uschange-1-1.png" alt="`uschange`의 다섯 시계열자료의 그래프" width="576" />
<p class="caption">
Figure 5.15: <code>uschange</code>의 다섯 시계열자료의 그래프
</p>
</div>
<p>뚜렷한 추세나 계절 성분이 있는 시계열자료는 없는 것으로 보인다.
다섯 시계열자료의 ACF는 함수 <code>ggAcf()</code>에 개별 시계열자료를 각각 입력해서 작성할 수도 있지만,
조금은 번거로운 작업이 된다.
대신 함수 <code>ggAcf()</code>에 행렬 <code>uschange</code>를 그대로 입력하면 두 변수씩의 모든 조합에 대한 상관 행렬이 작성되는데, 그 중 대각 패널에 각 변수의 ACF가 작성되어 있다.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="chapter-regression.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ggAcf</span>(uschange)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:uschange-2"></span>
<img src="_main_files/figure-html/uschange-2-1.png" alt="`uschange`의 다섯 시계열자료의 표본 ACF" width="768" />
<p class="caption">
Figure 5.16: <code>uschange</code>의 다섯 시계열자료의 표본 ACF
</p>
</div>
<p>Figure <a href="chapter-regression.html#fig:uschange-1">5.15</a>과 Figure <a href="chapter-regression.html#fig:uschange-2">5.16</a>을 근거로 다섯 시계열자료는 모두 정상성을 만족하고 있는 것으로 보인다.</p>
<p>Dynamic 회귀모형에서 설명변수로 사용할 수 있는 시계열자료는 <code>Income</code>, <code>Production</code>, <code>Savings</code>, 그리고 <code>Unemployment</code>이다.
함수 <code>GGally::ggpairs()</code>로 다섯 변수의 산점도 행렬을 작성해 보자.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chapter-regression.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(tidyverse)</span>
<span id="cb213-2"><a href="chapter-regression.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="fu">as_tibble</span>(uschange) <span class="sc">%&gt;%</span> </span>
<span id="cb213-3"><a href="chapter-regression.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                   <span class="fu">relocate</span>(Consumption, <span class="at">.after=</span><span class="fu">last_col</span>()),</span>
<span id="cb213-4"><a href="chapter-regression.html#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">lower=</span><span class="fu">list</span>(<span class="at">continuous=</span><span class="st">&quot;smooth_loess&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:uschange-3"></span>
<img src="_main_files/figure-html/uschange-3-1.png" alt="`uschange`의 다섯 시계열자료의 산점도 행렬" width="576" />
<p class="caption">
Figure 5.17: <code>uschange</code>의 다섯 시계열자료의 산점도 행렬
</p>
</div>
<p>변수 (<code>Income</code>, <code>Savings</code>)과 (<code>Production</code>, <code>Uneployment</code>) 사이에 높은 관련성이 있는 것으로 보여서, 변수 <code>Income</code>과 <code>Production</code>만을 설명변수로 포함시키고자 한다.
엄격하고 타당한 변수 선택 방식은 아니지만 가능하면 간단한 모형을 구성하고자 한다.</p>
<p>이제 자료를 분리하고 예측 모형을 적합시켜보자.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="chapter-regression.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> uschange_te <span class="ot">&lt;-</span> <span class="fu">tail</span>(uschange, <span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb214-2"><a href="chapter-regression.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> uschange_tr <span class="ot">&lt;-</span> <span class="fu">head</span>(uschange, <span class="at">n =</span> <span class="fu">nrow</span>(uschange)<span class="sc">-</span><span class="dv">8</span>)</span></code></pre></div>
<p>ARIMA 모형을 적합하고, 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="chapter-regression.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_arima <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(uschange_tr[,<span class="dv">1</span>], </span>
<span id="cb215-2"><a href="chapter-regression.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="chapter-regression.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_arima</span>
<span id="cb216-2"><a href="chapter-regression.html#cb216-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> uschange_tr[, <span class="dv">1</span>] </span>
<span id="cb216-3"><a href="chapter-regression.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ARIMA</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)[<span class="dv">4</span>] with non<span class="sc">-</span>zero mean </span>
<span id="cb216-4"><a href="chapter-regression.html#cb216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-5"><a href="chapter-regression.html#cb216-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb216-6"><a href="chapter-regression.html#cb216-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2     ar3     sar1     sar2    mean</span>
<span id="cb216-7"><a href="chapter-regression.html#cb216-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.2267</span>  <span class="fl">0.1771</span>  <span class="fl">0.2218</span>  <span class="sc">-</span><span class="fl">0.0351</span>  <span class="sc">-</span><span class="fl">0.1792</span>  <span class="fl">0.7482</span></span>
<span id="cb216-8"><a href="chapter-regression.html#cb216-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0739</span>  <span class="fl">0.0738</span>  <span class="fl">0.0726</span>   <span class="fl">0.0774</span>   <span class="fl">0.0745</span>  <span class="fl">0.0951</span></span>
<span id="cb216-9"><a href="chapter-regression.html#cb216-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-10"><a href="chapter-regression.html#cb216-10" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.3544</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="sc">-</span><span class="fl">158.39</span></span>
<span id="cb216-11"><a href="chapter-regression.html#cb216-11" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="fl">330.78</span>   AICc<span class="ot">=</span><span class="fl">331.44</span>   BIC<span class="ot">=</span><span class="fl">353.09</span></span></code></pre></div>
<p>ETS 모형을 적합하고, 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="chapter-regression.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(uschange_tr[,<span class="dv">1</span>])</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="chapter-regression.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_ets</span>
<span id="cb218-2"><a href="chapter-regression.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ETS</span>(A,N,N) </span>
<span id="cb218-3"><a href="chapter-regression.html#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="chapter-regression.html#cb218-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb218-5"><a href="chapter-regression.html#cb218-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">ets</span>(<span class="at">y =</span> uschange_tr[, <span class="dv">1</span>]) </span>
<span id="cb218-6"><a href="chapter-regression.html#cb218-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-7"><a href="chapter-regression.html#cb218-7" aria-hidden="true" tabindex="-1"></a>  Smoothing parameters<span class="sc">:</span></span>
<span id="cb218-8"><a href="chapter-regression.html#cb218-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">=</span> <span class="fl">0.3315</span> </span>
<span id="cb218-9"><a href="chapter-regression.html#cb218-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-10"><a href="chapter-regression.html#cb218-10" aria-hidden="true" tabindex="-1"></a>  Initial states<span class="sc">:</span></span>
<span id="cb218-11"><a href="chapter-regression.html#cb218-11" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">=</span> <span class="fl">0.6877</span> </span>
<span id="cb218-12"><a href="chapter-regression.html#cb218-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-13"><a href="chapter-regression.html#cb218-13" aria-hidden="true" tabindex="-1"></a>  sigma<span class="sc">:</span>  <span class="fl">0.633</span></span>
<span id="cb218-14"><a href="chapter-regression.html#cb218-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-15"><a href="chapter-regression.html#cb218-15" aria-hidden="true" tabindex="-1"></a>     AIC     AICc      BIC </span>
<span id="cb218-16"><a href="chapter-regression.html#cb218-16" aria-hidden="true" tabindex="-1"></a><span class="fl">768.8004</span> <span class="fl">768.9376</span> <span class="fl">778.3626</span> </span></code></pre></div>
<p><a href="chapter-regression.html#section-arma-reg">5.1</a>절에서 살펴본 관측 시점만을 설명변수로 사용하는 ARMA 오차 회귀모형을 적합해 보자.
추세 변수는 함수 <code>time()</code>으로 생성하고,
계절 성분은 dummy 변수로 표현해 보자.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="chapter-regression.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_reg <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(uschange_tr[,<span class="dv">1</span>],</span>
<span id="cb219-2"><a href="chapter-regression.html#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                       <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(uschange_tr[,<span class="dv">1</span>]),</span>
<span id="cb219-3"><a href="chapter-regression.html#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                                   <span class="at">Qtr =</span> <span class="fu">seasonaldummy</span>(uschange_tr[,<span class="dv">1</span>])),</span>
<span id="cb219-4"><a href="chapter-regression.html#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                       <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chapter-regression.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_reg</span>
<span id="cb220-2"><a href="chapter-regression.html#cb220-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> uschange_tr[, <span class="dv">1</span>] </span>
<span id="cb220-3"><a href="chapter-regression.html#cb220-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>)(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>)[<span class="dv">4</span>] errors </span>
<span id="cb220-4"><a href="chapter-regression.html#cb220-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-5"><a href="chapter-regression.html#cb220-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb220-6"><a href="chapter-regression.html#cb220-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2     ar3     sma1     sma2   Time  Qtr.Q1  Qtr.Q2  Qtr.Q3</span>
<span id="cb220-7"><a href="chapter-regression.html#cb220-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.2564</span>  <span class="fl">0.1608</span>  <span class="fl">0.2482</span>  <span class="sc">-</span><span class="fl">0.1066</span>  <span class="sc">-</span><span class="fl">0.1942</span>  <span class="fl">3e-04</span>  <span class="fl">0.0554</span>  <span class="fl">0.0122</span>   <span class="fl">0.172</span></span>
<span id="cb220-8"><a href="chapter-regression.html#cb220-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0742</span>  <span class="fl">0.0737</span>  <span class="fl">0.0729</span>   <span class="fl">0.0773</span>   <span class="fl">0.0707</span>  <span class="fl">1e-04</span>  <span class="fl">0.0700</span>  <span class="fl">0.0748</span>   <span class="fl">0.070</span></span>
<span id="cb220-9"><a href="chapter-regression.html#cb220-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-10"><a href="chapter-regression.html#cb220-10" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.349</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="sc">-</span><span class="fl">155.52</span></span>
<span id="cb220-11"><a href="chapter-regression.html#cb220-11" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="fl">331.03</span>   AICc<span class="ot">=</span><span class="fl">332.34</span>   BIC<span class="ot">=</span><span class="fl">362.91</span></span></code></pre></div>
<p>Dynamic 회귀모형도 적합해 보자.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="chapter-regression.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_dyn <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(uschange_tr[,<span class="dv">1</span>], <span class="at">d =</span> <span class="dv">0</span>,     </span>
<span id="cb221-2"><a href="chapter-regression.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">xreg =</span> uschange_tr[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)], </span>
<span id="cb221-3"><a href="chapter-regression.html#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chapter-regression.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit_dyn</span>
<span id="cb222-2"><a href="chapter-regression.html#cb222-2" aria-hidden="true" tabindex="-1"></a>Series<span class="sc">:</span> uschange_tr[, <span class="dv">1</span>] </span>
<span id="cb222-3"><a href="chapter-regression.html#cb222-3" aria-hidden="true" tabindex="-1"></a>Regression with <span class="fu">ARIMA</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>) errors </span>
<span id="cb222-4"><a href="chapter-regression.html#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="chapter-regression.html#cb222-5" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb222-6"><a href="chapter-regression.html#cb222-6" aria-hidden="true" tabindex="-1"></a>         ar1     ar2     ar3  intercept  Income  Production</span>
<span id="cb222-7"><a href="chapter-regression.html#cb222-7" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0060</span>  <span class="fl">0.1960</span>  <span class="fl">0.1890</span>     <span class="fl">0.5288</span>  <span class="fl">0.1741</span>      <span class="fl">0.1758</span></span>
<span id="cb222-8"><a href="chapter-regression.html#cb222-8" aria-hidden="true" tabindex="-1"></a>s.e.  <span class="fl">0.0813</span>  <span class="fl">0.0734</span>  <span class="fl">0.0735</span>     <span class="fl">0.0708</span>  <span class="fl">0.0457</span>      <span class="fl">0.0262</span></span>
<span id="cb222-9"><a href="chapter-regression.html#cb222-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-10"><a href="chapter-regression.html#cb222-10" aria-hidden="true" tabindex="-1"></a>sigma<span class="sc">^</span><span class="dv">2</span> <span class="ot">=</span> <span class="fl">0.2696</span><span class="sc">:</span>  log likelihood <span class="ot">=</span> <span class="sc">-</span><span class="fl">133.71</span></span>
<span id="cb222-11"><a href="chapter-regression.html#cb222-11" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">=</span><span class="fl">281.41</span>   AICc<span class="ot">=</span><span class="fl">282.07</span>   BIC<span class="ot">=</span><span class="fl">303.72</span></span></code></pre></div>
<p>적합시킨 네 모형에 대한 모형 검진도 실시해 보자.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chapter-regression.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_arima)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-168-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(3,0,0)(2,0,0)[4] with non-zero mean
Q* = 0.79783, df = 3, p-value = 0.85

Model df: 6.   Total lags used: 9</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chapter-regression.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_ets)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-169-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from ETS(A,N,N)
Q* = 15.865, df = 6, p-value = 0.0145

Model df: 2.   Total lags used: 8</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chapter-regression.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_reg)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-170-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(3,0,0)(0,0,2)[4] errors
Q* = 2.0948, df = 3, p-value = 0.553

Model df: 9.   Total lags used: 12</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="chapter-regression.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">checkresiduals</span>(fit_dyn)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-171-1.png" width="576" /></p>
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(3,0,0) errors
Q* = 1.6386, df = 3, p-value = 0.6507

Model df: 6.   Total lags used: 9</code></pre>
<p>ETS 모형이 독립성 가정을 위반하는 것으로 나타났다.
다른 모형에는 문제가 없는 것으로 보인다.</p>
<p>이제 test data에 대한 예측을 실시해 보자.
모형 <code>fit_dyn</code>의 경우에는 test data 시점에서 설명변수의 관측 문제가 있지만,
다른 모형과의 비교를 위해서 설명변수의 값이 알려져 있다고 가정하겠다.
이 가정으로 모형 <code>fit_dyn</code>의 예측은 결과가 더 좋게 나올 수 있다.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="chapter-regression.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_arima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_arima, <span class="at">h =</span> <span class="dv">8</span>)</span>
<span id="cb231-2"><a href="chapter-regression.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_ets, <span class="at">h =</span> <span class="dv">8</span>)</span>
<span id="cb231-3"><a href="chapter-regression.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_reg <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_reg, </span>
<span id="cb231-4"><a href="chapter-regression.html#cb231-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">Time =</span> <span class="fu">time</span>(uschange_te[,<span class="dv">1</span>]),</span>
<span id="cb231-5"><a href="chapter-regression.html#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                                          <span class="at">Qtr =</span> <span class="fu">seasonaldummy</span>(uschange_te[,<span class="dv">1</span>])))</span>
<span id="cb231-6"><a href="chapter-regression.html#cb231-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fc_dyn <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_dyn, </span>
<span id="cb231-7"><a href="chapter-regression.html#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">xreg =</span> uschange_te[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)])</span></code></pre></div>
<p>예측 결과를 test data와 비교해 보자.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="chapter-regression.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_arima, uschange_te[,<span class="dv">1</span>])</span>
<span id="cb232-2"><a href="chapter-regression.html#cb232-2" aria-hidden="true" tabindex="-1"></a>                        ME      RMSE       MAE       MPE      MAPE     MASE</span>
<span id="cb232-3"><a href="chapter-regression.html#cb232-3" aria-hidden="true" tabindex="-1"></a>Training set  <span class="fl">0.0002559072</span> <span class="fl">0.5852267</span> <span class="fl">0.4396851</span>  <span class="fl">65.90037</span> <span class="fl">189.15841</span> <span class="fl">0.670526</span></span>
<span id="cb232-4"><a href="chapter-regression.html#cb232-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">0.0475341277</span> <span class="fl">0.2500710</span> <span class="fl">0.2185770</span> <span class="sc">-</span><span class="fl">17.75795</span>  <span class="fl">33.64265</span> <span class="fl">0.333333</span></span>
<span id="cb232-5"><a href="chapter-regression.html#cb232-5" aria-hidden="true" tabindex="-1"></a>                    ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb232-6"><a href="chapter-regression.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set  0.00952753        NA</span></span>
<span id="cb232-7"><a href="chapter-regression.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     -0.21075717 0.6797118</span></span></code></pre></div>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="chapter-regression.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_ets, uschange_te[,<span class="dv">1</span>])</span>
<span id="cb233-2"><a href="chapter-regression.html#cb233-2" aria-hidden="true" tabindex="-1"></a>                        ME      RMSE       MAE       MPE      MAPE      MASE</span>
<span id="cb233-3"><a href="chapter-regression.html#cb233-3" aria-hidden="true" tabindex="-1"></a>Training set  <span class="fl">0.0008292707</span> <span class="fl">0.6294144</span> <span class="fl">0.4622752</span>  <span class="fl">15.94476</span> <span class="fl">163.66594</span> <span class="fl">0.7049764</span></span>
<span id="cb233-4"><a href="chapter-regression.html#cb233-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">0.0071405456</span> <span class="fl">0.2275948</span> <span class="fl">0.1819332</span> <span class="sc">-</span><span class="fl">11.07730</span>  <span class="fl">27.12135</span> <span class="fl">0.2774507</span></span>
<span id="cb233-5"><a href="chapter-regression.html#cb233-5" aria-hidden="true" tabindex="-1"></a>                     ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb233-6"><a href="chapter-regression.html#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set -0.004088847        NA</span></span>
<span id="cb233-7"><a href="chapter-regression.html#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     -0.208694082 0.5901059</span></span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="chapter-regression.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_reg, uschange_te[,<span class="dv">1</span>])</span>
<span id="cb234-2"><a href="chapter-regression.html#cb234-2" aria-hidden="true" tabindex="-1"></a>                        ME      RMSE       MAE       MPE      MAPE      MASE</span>
<span id="cb234-3"><a href="chapter-regression.html#cb234-3" aria-hidden="true" tabindex="-1"></a>Training set  <span class="fl">0.0008586772</span> <span class="fl">0.5757214</span> <span class="fl">0.4336545</span>  <span class="fl">62.73093</span> <span class="fl">184.11947</span> <span class="fl">0.6613293</span></span>
<span id="cb234-4"><a href="chapter-regression.html#cb234-4" aria-hidden="true" tabindex="-1"></a>Test set     <span class="sc">-</span><span class="fl">0.0460208936</span> <span class="fl">0.2877620</span> <span class="fl">0.2542229</span> <span class="sc">-</span><span class="fl">18.22233</span>  <span class="fl">37.33168</span> <span class="fl">0.3876936</span></span>
<span id="cb234-5"><a href="chapter-regression.html#cb234-5" aria-hidden="true" tabindex="-1"></a>                     ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb234-6"><a href="chapter-regression.html#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set  0.003604112        NA</span></span>
<span id="cb234-7"><a href="chapter-regression.html#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     -0.360236167 0.7215638</span></span></code></pre></div>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="chapter-regression.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">accuracy</span>(fc_dyn, uschange_te[,<span class="dv">1</span>])</span>
<span id="cb235-2"><a href="chapter-regression.html#cb235-2" aria-hidden="true" tabindex="-1"></a>                        ME      RMSE       MAE       MPE     MAPE      MASE</span>
<span id="cb235-3"><a href="chapter-regression.html#cb235-3" aria-hidden="true" tabindex="-1"></a>Training set <span class="sc">-</span><span class="fl">0.0006526438</span> <span class="fl">0.5104141</span> <span class="fl">0.3844923</span> <span class="fl">43.024517</span> <span class="fl">189.5903</span> <span class="fl">0.5863563</span></span>
<span id="cb235-4"><a href="chapter-regression.html#cb235-4" aria-hidden="true" tabindex="-1"></a>Test set      <span class="fl">0.1004867937</span> <span class="fl">0.2061923</span> <span class="fl">0.1498566</span>  <span class="fl">8.058113</span>  <span class="fl">18.8564</span> <span class="fl">0.2285334</span></span>
<span id="cb235-5"><a href="chapter-regression.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                     ACF1 Theil<span class="st">&#39;s U</span></span>
<span id="cb235-6"><a href="chapter-regression.html#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="st">Training set  0.002548898        NA</span></span>
<span id="cb235-7"><a href="chapter-regression.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="st">Test set     -0.413909940 0.6493148</span></span></code></pre></div>
<p>예측 결과를 그래프로 나타내서 비교해 보자.</p>
<div class="figure"><span style="display:block;" id="fig:uschange-4"></span>
<img src="_main_files/figure-html/uschange-4-1.png" alt="`uschange`의 `Consumption`에 대한 예측 결과 비교" width="576" />
<p class="caption">
Figure 5.18: <code>uschange</code>의 <code>Consumption</code>에 대한 예측 결과 비교
</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-arima.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="참고-문헌.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
