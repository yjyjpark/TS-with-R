<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 장 ARIMA 모형 | R로 알아가는 시계열분석</title>
  <meta name="description" content="4 장 ARIMA 모형 | R로 알아가는 시계열분석" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="4 장 ARIMA 모형 | R로 알아가는 시계열분석" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="yjyjpark/TS-with-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 장 ARIMA 모형 | R로 알아가는 시계열분석" />
  
  
  

<meta name="author" content="박동련" />


<meta name="date" content="2022-11-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-ets.html"/>
<link rel="next" href="chapter-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="1" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html"><i class="fa fa-check"></i><b>1</b> 시계열 그래프</a>
<ul>
<li class="chapter" data-level="" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#ts-객체-생성"><i class="fa fa-check"></i><code>ts</code> 객체 생성</a></li>
<li class="chapter" data-level="" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#시계열-그래프-작성"><i class="fa fa-check"></i>시계열 그래프 작성</a></li>
<li class="chapter" data-level="" data-path="chapter-ts-plot.html"><a href="chapter-ts-plot.html#seasonal-그래프-작성"><i class="fa fa-check"></i>Seasonal 그래프 작성</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html"><i class="fa fa-check"></i><b>2</b> 시계열 분해</a>
<ul>
<li class="chapter" data-level="" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#전통적-시계열-분해-기법"><i class="fa fa-check"></i>전통적 시계열 분해 기법</a></li>
<li class="chapter" data-level="" data-path="chapter-decomposition.html"><a href="chapter-decomposition.html#stl-분해-기법"><i class="fa fa-check"></i>STL 분해 기법</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-ets.html"><a href="chapter-ets.html"><i class="fa fa-check"></i><b>3</b> ETS 모형</a>
<ul>
<li class="chapter" data-level="" data-path="chapter-ets.html"><a href="chapter-ets.html#전통적-지수평활법"><i class="fa fa-check"></i>전통적 지수평활법</a></li>
<li class="chapter" data-level="" data-path="chapter-ets.html"><a href="chapter-ets.html#ets-모형"><i class="fa fa-check"></i>ETS 모형</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-arima.html"><a href="chapter-arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA 모형</a>
<ul>
<li class="chapter" data-level="" data-path="chapter-arima.html"><a href="chapter-arima.html#시계열자료의-정상성"><i class="fa fa-check"></i>시계열자료의 정상성</a></li>
<li class="chapter" data-level="" data-path="chapter-arima.html"><a href="chapter-arima.html#비계절형-arima-모형"><i class="fa fa-check"></i>비계절형 ARIMA 모형</a></li>
<li class="chapter" data-level="" data-path="chapter-arima.html"><a href="chapter-arima.html#계절형-arima-모형"><i class="fa fa-check"></i>계절형 ARIMA 모형</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-regression.html"><a href="chapter-regression.html"><i class="fa fa-check"></i><b>5</b> 회귀모형</a>
<ul>
<li class="chapter" data-level="" data-path="chapter-regression.html"><a href="chapter-regression.html#arma-오차-회귀모형"><i class="fa fa-check"></i>ARMA 오차 회귀모형</a></li>
<li class="chapter" data-level="" data-path="chapter-regression.html"><a href="chapter-regression.html#arma-오차-dynamic-회귀모형"><i class="fa fa-check"></i>ARMA 오차 Dynamic 회귀모형</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R로 알아가는 시계열분석</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-arima" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4 장</span> ARIMA 모형<a href="chapter-arima.html#chapter-arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="chapter-arima.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb96-2"><a href="chapter-arima.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="시계열자료의-정상성" class="section level2 unnumbered hasAnchor">
<h2>시계열자료의 정상성<a href="chapter-arima.html#시계열자료의-정상성" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>분산 안정화 변환 예제: 호주의 1956년 1월부터 1995년 8월까지 월별 전기 생산량 자료 (<code>fma::elec</code>)</li>
</ul>
<p>분산 안정화 변환이 필요한 자료의 예로써 1956년 1월부터 1995년 8월까지 호주의 월별 전기 생산량 자료인 <code>fma::elec</code>을 살펴보자.
시계열 그래프는 그림 <a href="chapter-arima.html#fig:elec-1">4.1</a>에서 볼 수 있다.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="chapter-arima.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elec) <span class="sc">+</span> </span>
<span id="cb97-2"><a href="chapter-arima.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-1"></span>
<img src="_main_files/figure-html/elec-1-1.png" alt="`elec` 자료의 시계열 그래프" width="576" />
<p class="caption">
그림 4.1: <code>elec</code> 자료의 시계열 그래프
</p>
</div>
<p>증가하는 추세가 있으며, 명확한 계절 성분이 있는 자료임을 알 수 있다.
또한 계절 성분의 변동 폭이 추세가 증가함에 따라 함께 증가하는 현상도 볼 수 있다.</p>
<p>Box-Cox 변환을 위한 함수에는 패키지 <code>forecast</code>의 함수 <code>BoxCox.lambda()</code>와 <code>BoxCox()</code>가 있다.
함수 <code>BoxCox.lambda()</code>는 주어진 자료에 대한 변환 모수 <span class="math inline">\(\lambda\)</span> 의 적정 값을 추정하고, 함수 <code>BoxCox()</code>는 입력된 <span class="math inline">\(\lambda\)</span> 값으로 자료의 변환을 실시한다.</p>
<p>이제 <code>elec</code> 자료에 대해 Box-Cox 변화을 실시해 보자.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="chapter-arima.html#cb98-1" aria-hidden="true" tabindex="-1"></a>(lambda <span class="ot">&lt;-</span> <span class="fu">BoxCox.lambda</span>(elec))</span></code></pre></div>
<pre><code>## [1] 0.2654076</code></pre>
<p>변환된 자료의 시계열 그래프를 그림 <a href="chapter-arima.html#fig:elec-2">4.2</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="chapter-arima.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">BoxCox</span>(elec, lambda)) <span class="sc">+</span> </span>
<span id="cb100-2"><a href="chapter-arima.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-2"></span>
<img src="_main_files/figure-html/elec-2-1.png" alt="`elec` 자료에 Box-Cox 변환 실시" width="576" />
<p class="caption">
그림 4.2: <code>elec</code> 자료에 Box-Cox 변환 실시
</p>
</div>
<p>그림 <a href="chapter-arima.html#fig:elec-2">4.2</a>에서 볼 수 있듯이 Box-Cox 변환된 자료는 전체적으로 일정한 변동 폭을 유지하고 있음을 알 수 있다.
그러나 변환된 자료인 <span class="math inline">\(y_{t}^{0.2654}\)</span> 에 대한 의미가 명확하지 않아서 해석에 문제가 있을 수 있다.
비교 차원에서 로그 변환을 실시해 보고, 결과를 비교해 보자.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="chapter-arima.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb101-2"><a href="chapter-arima.html#cb101-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(<span class="fu">BoxCox</span>(elec, <span class="fu">BoxCox.lambda</span>(elec))) <span class="sc">+</span> </span>
<span id="cb101-3"><a href="chapter-arima.html#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;Box-Cox transformation&quot;</span>)</span>
<span id="cb101-4"><a href="chapter-arima.html#cb101-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(<span class="fu">log</span>(elec)) <span class="sc">+</span> </span>
<span id="cb101-5"><a href="chapter-arima.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;log transformation&quot;</span>)</span>
<span id="cb101-6"><a href="chapter-arima.html#cb101-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-3"></span>
<img src="_main_files/figure-html/elec-3-1.png" alt="`elec` 자료에 대한 분산안정화 변환의 비교" width="768" />
<p class="caption">
그림 4.3: <code>elec</code> 자료에 대한 분산안정화 변환의 비교
</p>
</div>
<p>두 변환 결과에는 큰 차이가 없다는 것을 그림 <a href="chapter-arima.html#fig:elec-3">4.3</a>에서 확인 할 수 있다.
따라서 이 경우에는 승법 모형을 가법 모형으로 변환한다는 의미를 갖고 있어서 해석이 비교적 용이한 로그 변환을 사용하는 것이 더 좋을 것으로 보인다.</p>
<ul>
<li>차분 예제 : Google 주가 자료 (<code>fpp2::goog200</code>)</li>
</ul>
<p>Google 주가 자료인 <code>goog200</code>의 시계열 그래프와 표본 ACF를 작성해 보자.
대체적으로 증가하는 추세가 있으며, 표본 ACF가 매우 천천히 감소하고 있다.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="chapter-arima.html#cb102-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(goog200) <span class="sc">+</span> </span>
<span id="cb102-2"><a href="chapter-arima.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;Google stock price&quot;</span>)</span>
<span id="cb102-3"><a href="chapter-arima.html#cb102-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(goog200) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb102-4"><a href="chapter-arima.html#cb102-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:goog200-1"></span>
<img src="_main_files/figure-html/goog200-1-1.png" alt="`goog200` 자료의 시계열 그래프와 ACF" width="768" />
<p class="caption">
그림 4.4: <code>goog200</code> 자료의 시계열 그래프와 ACF
</p>
</div>
<p>이제 <code>goog200</code> 자료를 1차 차분하고 결과를 확인해 보자.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="chapter-arima.html#cb103-1" aria-hidden="true" tabindex="-1"></a>goog200_1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(goog200)</span>
<span id="cb103-2"><a href="chapter-arima.html#cb103-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(goog200_1) <span class="sc">+</span> </span>
<span id="cb103-3"><a href="chapter-arima.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;Google stock price&quot;</span>)</span>
<span id="cb103-4"><a href="chapter-arima.html#cb103-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(goog200_1) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb103-5"><a href="chapter-arima.html#cb103-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:goog200-2"></span>
<img src="_main_files/figure-html/goog200-2-1.png" alt="`goog200`의 1차 차분된 자료의 시계열 그래프와 ACF" width="768" />
<p class="caption">
그림 4.5: <code>goog200</code>의 1차 차분된 자료의 시계열 그래프와 ACF
</p>
</div>
<p>차분된 자료는 하나의 이상값을 제외하면 일정한 level을 유지하고 있으며, 표본 ACF의 모든 값들이 신뢰구간 안에 존재하고 있음을 알 수 있다.
따라서 차분된 자료는 백색잡음 자료로 보이며, 이것은 원자료가 확률보행 자료임을 나타내는 것이 된다.</p>
<p><code>goog200</code> 자료를 대상으로 단위근 검정을 실시해 보자.
단위근 검정은 <code>urca::ur.kpss()</code>로 실시할 수 있지만, 함수 <code>forecast::ndiffs()</code>를 사용하면 정상성을 만족시키기 위한 차분의 횟수를 단위근 검정에 근거를 두고 추정해 준다.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="chapter-arima.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(goog200)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>즉, 1차 차분을 실시하면 정상성을 만족시킬 수 있다고 제안하는 것이다.
물론 <code>urca::ur.kpss()</code>로 단위근 검정을 실시해서 주어진 자료의 정상성 여부를 확인할 수 있다.
<code>|&gt;</code> 기호는 base R의 pipe 연산자이며, 기본적인 사용법은 <code>%&gt;%</code>와 동일하다.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="chapter-arima.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb106-2"><a href="chapter-arima.html#cb106-2" aria-hidden="true" tabindex="-1"></a>goog200  <span class="sc">|&gt;</span> </span>
<span id="cb106-3"><a href="chapter-arima.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ur.kpss</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb106-4"><a href="chapter-arima.html#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## ####################### 
## # KPSS Unit Root Test # 
## ####################### 
## 
## Test is of type: mu with 4 lags. 
## 
## Value of test-statistic is: 2.7441 
## 
## Critical value for a significance level of: 
##                 10pct  5pct 2.5pct  1pct
## critical values 0.347 0.463  0.574 0.739</code></pre>
<p>계산된 검정 통계량 값이 1% 유의수준의 임계값보다 크기 때문에 정상이라는 귀무가설을 기각할 수 있다.
1차 차분을 실시한 자료를 대상으로 단위근 검정을 실시해 보면, 귀무가설을 기각할 수 없기 때문에 1차 차분으로 정상성을 확보했다고 볼 수 있다.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="chapter-arima.html#cb108-1" aria-hidden="true" tabindex="-1"></a>goog200 <span class="sc">|&gt;</span>  </span>
<span id="cb108-2"><a href="chapter-arima.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb108-3"><a href="chapter-arima.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ur.kpss</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb108-4"><a href="chapter-arima.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## ####################### 
## # KPSS Unit Root Test # 
## ####################### 
## 
## Test is of type: mu with 4 lags. 
## 
## Value of test-statistic is: 0.1163 
## 
## Critical value for a significance level of: 
##                 10pct  5pct 2.5pct  1pct
## critical values 0.347 0.463  0.574 0.739</code></pre>
<ul>
<li>예제 : 호주의 1956년 1월부터 1995년 8월까지 월별 전기 생산량 자료 (<code>fma::elec</code>)</li>
</ul>
<p>그림 <a href="chapter-arima.html#fig:elec-1">4.1</a>에서 살펴본 <code>elec</code>는 증가하는 추세와 뚜렷한 계절 성분이 있으며,
분산이 시간이 흐름에 따라 증가하는 자료이다.
정상성을 만족시키기 위한 변환 절차에서 분산 안정화는 항상 가장 먼저 시행해야 한다.
로그 변환을 시행해서 분산을 안정화 시킨 자료의 시계열 그래프와 ACF는 그림 <a href="chapter-arima.html#fig:elec-d1">4.6</a>에서 볼 수 있다.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="chapter-arima.html#cb110-1" aria-hidden="true" tabindex="-1"></a>ln_elec <span class="ot">&lt;-</span> <span class="fu">log</span>(elec)</span>
<span id="cb110-2"><a href="chapter-arima.html#cb110-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(ln_elec) <span class="sc">+</span> </span>
<span id="cb110-3"><a href="chapter-arima.html#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;log transformed data&quot;</span>)</span>
<span id="cb110-4"><a href="chapter-arima.html#cb110-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span>  <span class="fu">ggAcf</span>(ln_elec) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb110-5"><a href="chapter-arima.html#cb110-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-d1"></span>
<img src="_main_files/figure-html/elec-d1-1.png" alt="`elec`에 로그 변환한 자료의 시계열 그래프와 ACF" width="768" />
<p class="caption">
그림 4.6: <code>elec</code>에 로그 변환한 자료의 시계열 그래프와 ACF
</p>
</div>
<p>뚜렷하게 존재하는 계절 성분을 제거하기 위해 계절 차분을 실시할 필요가 있는 것으로 보인다.
계절 차분의 경우에는 함수 <code>forecast::nsdiffs()</code>를 사용하면 계절 단위근 검정을 근거로 하여 계절 차분 횟수를 추정할 수 있다.
함수 <code>nsdiffs()</code>는 seasonal strength를 측정하는 통계량을 근거로 하여 차분 횟수를 추정하는 것이 디폴트이다.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="chapter-arima.html#cb111-1" aria-hidden="true" tabindex="-1"></a>elec <span class="sc">|&gt;</span>  </span>
<span id="cb111-2"><a href="chapter-arima.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb111-3"><a href="chapter-arima.html#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nsdiffs</span>()</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>계절 차분을 실시한 자료를 대상으로 시계열 그래프와 ACF를 작성해 보자.
작성된 그래프는 그림 <a href="chapter-arima.html#fig:elec-d2">4.7</a>에서 확인할 수 있다.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="chapter-arima.html#cb113-1" aria-hidden="true" tabindex="-1"></a>ln_elec_m <span class="ot">&lt;-</span> <span class="fu">log</span>(elec) <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="chapter-arima.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>(<span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb113-3"><a href="chapter-arima.html#cb113-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(ln_elec_m) <span class="sc">+</span> </span>
<span id="cb113-4"><a href="chapter-arima.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;log transformed and seasonally differenced data&quot;</span>)</span>
<span id="cb113-5"><a href="chapter-arima.html#cb113-5" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span>  <span class="fu">ggAcf</span>(ln_elec_m) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb113-6"><a href="chapter-arima.html#cb113-6" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-d2"></span>
<img src="_main_files/figure-html/elec-d2-1.png" alt="로그 변환된`elec`에 계절차분을 실시한 자료의 시계열 그래프와 ACF" width="768" />
<p class="caption">
그림 4.7: 로그 변환된<code>elec</code>에 계절차분을 실시한 자료의 시계열 그래프와 ACF
</p>
</div>
<p>그림 <a href="chapter-arima.html#fig:elec-d2">4.7</a>에서 볼 수 있듯이 추세 성분이 아직 남아 있는 것으로 보인다.
이제 계절 차분된 자료에 1차 차분을 더 실시한 결과를 살펴보자.
그림 <a href="chapter-arima.html#fig:elec-d3">4.8</a>에 나타난 패턴을 보면, 비정상 요소가 모두 제거되었음을 알 수 있다.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="chapter-arima.html#cb114-1" aria-hidden="true" tabindex="-1"></a>ln_elec_m_1 <span class="ot">&lt;-</span> <span class="fu">log</span>(elec) <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="chapter-arima.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>(<span class="at">lag =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-3"><a href="chapter-arima.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>()</span>
<span id="cb114-4"><a href="chapter-arima.html#cb114-4" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(ln_elec_m_1) <span class="sc">+</span> </span>
<span id="cb114-5"><a href="chapter-arima.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">&quot;log transformed and doubly differenced data&quot;</span>)</span>
<span id="cb114-6"><a href="chapter-arima.html#cb114-6" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span>  <span class="fu">ggAcf</span>(ln_elec_m_1) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb114-7"><a href="chapter-arima.html#cb114-7" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> p6</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elec-d3"></span>
<img src="_main_files/figure-html/elec-d3-1.png" alt="로그 변환된 `elec`에 계절차분과 1차 차분을 실시한 자료의 시계열 그래프와 ACF" width="768" />
<p class="caption">
그림 4.8: 로그 변환된 <code>elec</code>에 계절차분과 1차 차분을 실시한 자료의 시계열 그래프와 ACF
</p>
</div>
</div>
<div id="비계절형-arima-모형" class="section level2 unnumbered hasAnchor">
<h2>비계절형 ARIMA 모형<a href="chapter-arima.html#비계절형-arima-모형" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>예제 1: gas 자료</li>
</ul>
<p>자료 파일 <code>gas.csv</code>에는 9초 간격으로 측정된 입력 가스 비율 (<code>rate</code>)에 따른 이산화탄소 배출 농도 (<code>co2</code>)가 입력되어 있다.
먼저 자료를 입력해 보자.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="chapter-arima.html#cb115-1" aria-hidden="true" tabindex="-1"></a>gas <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/yjyjpark/TS-with-R/main/Data/gas.csv&quot;</span>)</span>
<span id="cb115-2"><a href="chapter-arima.html#cb115-2" aria-hidden="true" tabindex="-1"></a>gas <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="chapter-arima.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 296 × 2
##     rate   co2
##    &lt;dbl&gt; &lt;dbl&gt;
## 1 -0.109  53.8
## 2  0      53.6
## 3  0.178  53.5
## 4  0.339  53.5
## 5  0.373  53.4
## # … with 291 more rows</code></pre>
<p>데이터 프레임 <code>gas</code>에는 변수 <code>rate</code>와 <code>co2</code>가 있는 것을 알 수 있다.
변수 <code>rate</code>를 <code>ts</code> 객체로 변환해야 하는데 시작 시점과 종료 시점에 대한 정보가 없는 상태이어서,
시점을 <span class="math inline">\(t=1, 2, 3, \ldots\)</span> 로 지정하고 주기도 1로 지정하도록 하자.
이런 작업은 함수 <code>as.ts()</code>를 사용하면 간편하게 할 수 있다.
이어서 시계열 그래프도 그림 <a href="chapter-arima.html#fig:gas-plot">4.9</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="chapter-arima.html#cb117-1" aria-hidden="true" tabindex="-1"></a>rate.ts <span class="ot">&lt;-</span> <span class="fu">as.ts</span>(gas<span class="sc">$</span>rate)</span>
<span id="cb117-2"><a href="chapter-arima.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(rate.ts) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:gas-plot"></span>
<img src="_main_files/figure-html/gas-plot-1.png" alt="`gas` 자료의 시계열 그래프" width="576" />
<p class="caption">
그림 4.9: <code>gas</code> 자료의 시계열 그래프
</p>
</div>
<p><code>rate.ts</code>에 대한 ARIMA 모형을 적합해 보자.
먼저 전체 자료를 training data와 test data로 분리하자.
Test data는 마지막 10개 자료로 한다.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="chapter-arima.html#cb118-1" aria-hidden="true" tabindex="-1"></a>train_r <span class="ot">&lt;-</span> <span class="fu">window</span>(rate.ts, <span class="at">end =</span> <span class="fu">length</span>(rate.ts) <span class="sc">-</span> <span class="dv">10</span>)</span>
<span id="cb118-2"><a href="chapter-arima.html#cb118-2" aria-hidden="true" tabindex="-1"></a>test_r <span class="ot">&lt;-</span> <span class="fu">window</span>(rate.ts, <span class="at">start =</span> <span class="fu">length</span>(rate.ts) <span class="sc">-</span> <span class="dv">9</span>)</span></code></pre></div>
<p>Training data를 대상으로 최적의 모형을 적합해 보자.
먼저 자료의 정상성 여부를 시계열 그래프와 ACF로 확인해 보자.
필요한 그래프는 그림 <a href="chapter-arima.html#fig:train-r-1">4.10</a>에서 볼 수 있다.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="chapter-arima.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(train_r)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:train-r-1"></span>
<img src="_main_files/figure-html/train-r-1-1.png" alt="자료 `train_r`의 정상성 여부 확인을 위한 그래프" width="576" />
<p class="caption">
그림 4.10: 자료 <code>train_r</code>의 정상성 여부 확인을 위한 그래프
</p>
</div>
<p>그림 <a href="chapter-arima.html#fig:train-r-1">4.10</a>의 시계열 그래프에는 명확한 추세가 없는 것으로 보이지만, 표본 ACF가 비교적 천천히 모습이 보인다.
단위근 검정 결과는 차분이 필요한 것으로 나온다.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="chapter-arima.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(train_r)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>단위근 검정 결과에 따라 정상성이 만족되지 않는 것으로 보고 차분을 실시할 수 있지만, 시계열 그래프와 ACF를 근거로 정상성이 만족된 것으로 볼 수도 있기 때문에, 차분을 실시하는 것과 실시하지 않는 두 가지 상황을 모두 고려해서 모형 식별을 진행하는 것이 좋을 것으로 보인다.</p>
<p>먼저 차분을 실시하지 않는 경우에 대해서 모형 적합을 진행해 보자.
차분을 실시하지 않기 위해서 <code>d = 0</code>을 입력하고, 이어서 <code>stepwise</code>, <code>approximation</code>, <code>seasonal</code>을 모두 <code>FALSE</code>로 지정하자.
<code>trace = TRUE</code>를 추가하면 비교 대상 모형의 AICc 값이 출력된다.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="chapter-arima.html#cb122-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_r, <span class="at">d =</span> <span class="dv">0</span>, <span class="at">stepwise =</span> <span class="cn">FALSE</span>, </span>
<span id="cb122-2"><a href="chapter-arima.html#cb122-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">approximation =</span> <span class="cn">FALSE</span>, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, </span>
<span id="cb122-3"><a href="chapter-arima.html#cb122-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  ARIMA(0,0,0) with zero mean     : 862.9984
##  ARIMA(0,0,0) with non-zero mean : 864.2264
##  ARIMA(0,0,1) with zero mean     : 502.5603
##  ARIMA(0,0,1) with non-zero mean : 503.849
##  ARIMA(0,0,2) with zero mean     : 245.7837
##  ARIMA(0,0,2) with non-zero mean : 247.1783
##  ARIMA(0,0,3) with zero mean     : 81.487
##  ARIMA(0,0,3) with non-zero mean : 83.02667
##  ARIMA(0,0,4) with zero mean     : -20.65077
##  ARIMA(0,0,4) with non-zero mean : -19.01766
##  ARIMA(0,0,5) with zero mean     : -84.62715
##  ARIMA(0,0,5) with non-zero mean : -82.85418
##  ARIMA(1,0,0) with zero mean     : 184.3482
##  ARIMA(1,0,0) with non-zero mean : 186.3166
##  ARIMA(1,0,1) with zero mean     : -16.72114
##  ARIMA(1,0,1) with non-zero mean : -14.73886
##  ARIMA(1,0,2) with zero mean     : -74.34891
##  ARIMA(1,0,2) with non-zero mean : -72.35703
##  ARIMA(1,0,3) with zero mean     : -115.7122
##  ARIMA(1,0,3) with non-zero mean : -113.7137
##  ARIMA(1,0,4) with zero mean     : -133.8983
##  ARIMA(1,0,4) with non-zero mean : -131.9025
##  ARIMA(2,0,0) with zero mean     : -89.86221
##  ARIMA(2,0,0) with non-zero mean : -88.00051
##  ARIMA(2,0,1) with zero mean     : -113.8044
##  ARIMA(2,0,1) with non-zero mean : -111.8785
##  ARIMA(2,0,2) with zero mean     : -116.6196
##  ARIMA(2,0,2) with non-zero mean : -114.6669
##  ARIMA(2,0,3) with zero mean     : -130.7106
##  ARIMA(2,0,3) with non-zero mean : -128.7274
##  ARIMA(3,0,0) with zero mean     : -123.114
##  ARIMA(3,0,0) with non-zero mean : -121.1507
##  ARIMA(3,0,1) with zero mean     : -125.3355
##  ARIMA(3,0,1) with non-zero mean : -123.3294
##  ARIMA(3,0,2) with zero mean     : -123.8663
##  ARIMA(3,0,2) with non-zero mean : -121.8527
##  ARIMA(4,0,0) with zero mean     : -125.2705
##  ARIMA(4,0,0) with non-zero mean : -123.2711
##  ARIMA(4,0,1) with zero mean     : -123.4833
##  ARIMA(4,0,1) with non-zero mean : -121.4641
##  ARIMA(5,0,0) with zero mean     : -124.0066
##  ARIMA(5,0,0) with non-zero mean : -121.9828
## 
## 
## 
##  Best model: ARIMA(1,0,4) with zero mean</code></pre>
<p>적합 결과를 확인해 보자.
ARMA(1,4) 모형이 선택되었다.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="chapter-arima.html#cb124-1" aria-hidden="true" tabindex="-1"></a>fit1</span></code></pre></div>
<pre><code>## Series: train_r 
## ARIMA(1,0,4) with zero mean 
## 
## Coefficients:
##          ar1     ma1     ma2     ma3     ma4
##       0.7769  1.1456  1.0384  0.7892  0.3022
## s.e.  0.0450  0.0657  0.0922  0.0880  0.0627
## 
## sigma^2 = 0.03511:  log likelihood = 73.1
## AIC=-134.2   AICc=-133.9   BIC=-112.26</code></pre>
<p>이번에는 차분을 실시하는 경우에 대한 모형 적합을 진행해 보자.
ARIMA(3,1,1) 모형이 선택된 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="chapter-arima.html#cb126-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_r, <span class="at">stepwise =</span> <span class="cn">FALSE</span>, </span>
<span id="cb126-2"><a href="chapter-arima.html#cb126-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">approximation =</span> <span class="cn">FALSE</span>, <span class="at">seasonal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb126-3"><a href="chapter-arima.html#cb126-3" aria-hidden="true" tabindex="-1"></a>fit2</span></code></pre></div>
<pre><code>## Series: train_r 
## ARIMA(3,1,1) 
## 
## Coefficients:
##          ar1      ar2     ar3      ma1
##       1.9589  -1.3503  0.3304  -0.9855
## s.e.  0.0580   0.1032  0.0576   0.0148
## 
## sigma^2 = 0.03717:  log likelihood = 65.4
## AIC=-120.81   AICc=-120.59   BIC=-102.55</code></pre>
<p>차분을 실시하지 않은 모형 <code>fit1</code>의 모형 진단을 실시해 보자.
모든 가정을 만족하는 것으로 보인다.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="chapter-arima.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-50-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(1,0,4) with zero mean
## Q* = 1.5628, df = 5, p-value = 0.9057
## 
## Model df: 5.   Total lags used: 10</code></pre>
<p>차분을 실시한 모형 <code>fit2</code>의 모형 진단을 실시해 보자.
가정 만족에는 문제가 없는 것으로 보인다.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="chapter-arima.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-51-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(3,1,1)
## Q* = 11.352, df = 6, p-value = 0.07809
## 
## Model df: 4.   Total lags used: 10</code></pre>
<p>두 모형 모두 예측모형으로 사용이 가능한 모형으로 보인다.
이제 두 모형 중 한 모형을 최종 예측모형으로 선택하는 것이 필요한데,
모형 <code>fit1</code>은 차분을 하지 않은 자료를 사용한 것이고, 모형 <code>fit2</code>는 차분을 실시한 자료를 사용한 것이다.
즉, 서로 다른 자료를 사용하여 적합한 모형이기 때문에, 두 모형의 AICc 등의 값을 비교하는 것은 의미가 없다.
이런 경우, 최종 예측모형 선택에 사용할 수 있는 방법은 test data에 대한 예측 결과를 근거로 하는 것이다.
두 모형을 사용하여 예측을 실시하고 test data와 비교해 보자.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="chapter-arima.html#cb132-1" aria-hidden="true" tabindex="-1"></a>fc1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit1)</span>
<span id="cb132-2"><a href="chapter-arima.html#cb132-2" aria-hidden="true" tabindex="-1"></a>fc2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit2)</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="chapter-arima.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc1, test_r)</span></code></pre></div>
<pre><code>##                        ME      RMSE       MAE      MPE
## Training set -0.003485182 0.1857419 0.1308396      NaN
## Test set      0.197714969 0.2984918 0.2589217 261.7854
##                  MAPE      MASE       ACF1 Theil&#39;s U
## Training set      Inf 0.5071232 0.01278907        NA
## Test set     282.7786 1.0035587 0.63693511  1.231509</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="chapter-arima.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc2, test_r)</span></code></pre></div>
<pre><code>##                        ME      RMSE       MAE      MPE
## Training set -0.008064075 0.1911149 0.1333927      NaN
## Test set      0.325580419 0.3713446 0.3255804 390.3076
##                  MAPE      MASE        ACF1 Theil&#39;s U
## Training set      Inf 0.5170188 -0.03694615        NA
## Test set     437.7347 1.2619224  0.57275035  1.400976</code></pre>
<p>함수 <code>accuracy()</code>의 결과를 보면, ARMA(1,4) 모형인 <code>fit1</code>의 예측 오차가 조금 더 작은 것으로 보인다.
따라서 이 모형을 최종 예측모형으로 선택하기로 하자.
최종 예측모형의 모형식은 다음과 같다.</p>
<p><span class="math display">\[
(1-0.7769B)~y_{t} = (1+1.145B+1.038B^{2}+0.789B^{3}+0.302B^{4})~\varepsilon_{t}
\]</span></p>
<p>예측 결과를 그래프로 나타내 보자.
Test data와 함께 표시하는 것이 비교하기 좋을 것이며, 작성된 그래프는 그림 <a href="chapter-arima.html#fig:test-r-1">4.11</a>에서 확인할 수 있다.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="chapter-arima.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc1, <span class="at">include =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb137-2"><a href="chapter-arima.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(test_r, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb137-3"><a href="chapter-arima.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;rate&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:test-r-1"></span>
<img src="_main_files/figure-html/test-r-1-1.png" alt="`rate` 자료에 대한 예측 결과 그래프" width="576" />
<p class="caption">
그림 4.11: <code>rate</code> 자료에 대한 예측 결과 그래프
</p>
</div>
<ul>
<li>예제 2 : 1996년 1월부터 2012년 3월까지 Euro 지역에서의 월별 전자 제품 생산량 자료 (<code>fpp2::elecequip</code>)</li>
</ul>
<p>자료 <code>elecequip</code>은 계절 요인이 존재하는 월별 자료이다.
비계절형 ARIMA 모형을 적합하기 위해서는 계절 요소를 자료에서 제거해야 한다.
함수 <code>stl()</code>로 자료를 분해하고, 이어서 함수 <code>forecast::seasadj()</code>를 적용해서 계절 요소를 제거해 보자.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="chapter-arima.html#cb138-1" aria-hidden="true" tabindex="-1"></a>elecequip_desea <span class="ot">&lt;-</span> <span class="fu">stl</span>(elecequip, <span class="at">s.window=</span><span class="st">&quot;periodic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-2"><a href="chapter-arima.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seasadj</span>()</span></code></pre></div>
<p>원자료와 계절 조정된 자료의 시계열 그래프를 그림 <a href="chapter-arima.html#fig:equip-1">4.12</a>에서 비교해 보자.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="chapter-arima.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecequip, <span class="at">series =</span> <span class="st">&quot;Monthly data&quot;</span>) <span class="sc">+</span> </span>
<span id="cb139-2"><a href="chapter-arima.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(elecequip_desea, </span>
<span id="cb139-3"><a href="chapter-arima.html#cb139-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">series =</span> <span class="st">&quot;Seasonally adjusted&quot;</span>, <span class="at">size =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb139-4"><a href="chapter-arima.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Monthly data&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb139-5"><a href="chapter-arima.html#cb139-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;Seasonally adjusted&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb139-6"><a href="chapter-arima.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-7"><a href="chapter-arima.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:equip-1"></span>
<img src="_main_files/figure-html/equip-1-1.png" alt="`elecequip` 원자료와 계절 조정된 자료의 비교" width="576" />
<p class="caption">
그림 4.12: <code>elecequip</code> 원자료와 계절 조정된 자료의 비교
</p>
</div>
<p>계절 조정된 자료를 대상으로 자료 분리를 실시해 보자.
Test data는 마지막 2년 자료로 한다.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="chapter-arima.html#cb140-1" aria-hidden="true" tabindex="-1"></a>train_eq <span class="ot">&lt;-</span> <span class="fu">window</span>(elecequip_desea, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2010</span>,<span class="dv">3</span>))</span>
<span id="cb140-2"><a href="chapter-arima.html#cb140-2" aria-hidden="true" tabindex="-1"></a>test_eq <span class="ot">&lt;-</span> <span class="fu">window</span>(elecequip_desea, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2010</span>,<span class="dv">4</span>))</span></code></pre></div>
<p>정상성 판단을 위한 그래프를 그림 <a href="chapter-arima.html#fig:equip-acf-1">4.13</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="chapter-arima.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(train_eq)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:equip-acf-1"></span>
<img src="_main_files/figure-html/equip-acf-1-1.png" alt="`train_eq`의 정상성 여부 확인을 위한 그래프" width="576" />
<p class="caption">
그림 4.13: <code>train_eq</code>의 정상성 여부 확인을 위한 그래프
</p>
</div>
<p>시간에 따른 level의 변화가 보이고, 표본 ACF가 매우 천천히 감소하는 것도 알 수 있다.
단위근 검정에서도 차분이 필요한 것으로 나타난다.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="chapter-arima.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(train_eq)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>차분된 자료를 대상으로 시계열 그래프와 ACF를 그림 <a href="chapter-arima.html#fig:equip-acf-2">4.14</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="chapter-arima.html#cb144-1" aria-hidden="true" tabindex="-1"></a>train_eq <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="chapter-arima.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="chapter-arima.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtsdisplay</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:equip-acf-2"></span>
<img src="_main_files/figure-html/equip-acf-2-1.png" alt="`train_eq`의 차분한 자료의 정상성 여부 확인을 위한 그래프" width="576" />
<p class="caption">
그림 4.14: <code>train_eq</code>의 차분한 자료의 정상성 여부 확인을 위한 그래프
</p>
</div>
<p>차분된 자료는 정상성을 만족하는 것으로 보인다.
또한 ACF는 지수적 감소, PACF는 3시차 이후 절단으로 볼 수 있기 때문에 차분된 자료는 AR(3) 모형으로 식별할 수 있고, 따라서 원자료는 ARIMA(3,1,0) 모형으로 식별할 수 있다.</p>
<p>함수 <code>auto.arima()</code>에 의한 모형 선택을 실시해 보자.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="chapter-arima.html#cb145-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_eq, <span class="at">stepwise =</span> <span class="cn">FALSE</span>, </span>
<span id="cb145-2"><a href="chapter-arima.html#cb145-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">approximation =</span> <span class="cn">FALSE</span>, <span class="at">seasonal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb145-3"><a href="chapter-arima.html#cb145-3" aria-hidden="true" tabindex="-1"></a>fit1</span></code></pre></div>
<pre><code>## Series: train_eq 
## ARIMA(3,1,0) 
## 
## Coefficients:
##           ar1      ar2     ar3
##       -0.2922  -0.0635  0.3710
## s.e.   0.0713   0.0748  0.0718
## 
## sigma^2 = 9.169:  log likelihood = -428.36
## AIC=864.73   AICc=864.97   BIC=877.27</code></pre>
<p>ACF와 PACF에 의해 선택한 결과와 동일하게 ARIMA(3,1,0) 모형이 선택되었다.
모형식은 다음과 같다.</p>
<p><span class="math display">\[
(1+0.292B+0.064B^{2}-0.371B^{3})(1-B)~y_{t}=\varepsilon_{t}
\]</span></p>
<p>적합된 모형의 검진을 실시해 보자.
잔차는 백색잡음 자료라고 할 수 있으며, 정규분포 가정에도 문제가 없는 것으로 보인다.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="chapter-arima.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(3,1,0)
## Q* = 20.702, df = 21, p-value = 0.4772
## 
## Model df: 3.   Total lags used: 24</code></pre>
<p>예측을 실시하고, 예측 오차를 확인해 보자.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="chapter-arima.html#cb149-1" aria-hidden="true" tabindex="-1"></a>fc1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit1)</span>
<span id="cb149-2"><a href="chapter-arima.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc1, test_eq)</span></code></pre></div>
<pre><code>##                        ME     RMSE      MAE         MPE
## Training set -0.002219982 2.992424 2.301026 -0.05081691
## Test set      8.727507127 9.330976 8.727507  9.28015517
##                  MAPE      MASE        ACF1 Theil&#39;s U
## Training set 2.411491 0.2786977 -0.03178277        NA
## Test set     9.280155 1.0570657  0.38874430  2.481532</code></pre>
<p>예측 결과를 그림 <a href="chapter-arima.html#fig:equip-2">4.15</a>에 그래프로 나타내 보자.
예측 결과가 test data와는 차이가 있음을 알 수 있다.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="chapter-arima.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc1, <span class="at">include =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb151-2"><a href="chapter-arima.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(test_eq, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb151-3"><a href="chapter-arima.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Electrical equipment manufactured&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:equip-2"></span>
<img src="_main_files/figure-html/equip-2-1.png" alt="`elecequip` 자료에 대한 예측 결과" width="576" />
<p class="caption">
그림 4.15: <code>elecequip</code> 자료에 대한 예측 결과
</p>
</div>
</div>
<div id="계절형-arima-모형" class="section level2 unnumbered hasAnchor">
<h2>계절형 ARIMA 모형<a href="chapter-arima.html#계절형-arima-모형" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>예제 1 : 1984년 1월부터 1988년 12월 국내 백화점 매출액</li>
</ul>
<p>1984년 1월부터 1988년 12월까지 국내 어떤 백화점의 매출액 자료를 계절형 ARIMA 모형으로 적합하고 예측을 실시해 보자.
비교적 소규모 자료이기 때문에 자료를 training data와 test data로 분리하지 않고 전체 자료를 모두 사용하여 모형 적합을 진행하기로 하자.
먼저 자료를 불러오고 <code>ts</code> 객체로 변환시키자.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="chapter-arima.html#cb152-1" aria-hidden="true" tabindex="-1"></a>depart <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;https://raw.githubusercontent.com/yjyjpark/TS-with-R/main/Data/depart.txt&quot;</span>)</span>
<span id="cb152-2"><a href="chapter-arima.html#cb152-2" aria-hidden="true" tabindex="-1"></a>depart.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(depart, <span class="at">start =</span> <span class="dv">1984</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span></code></pre></div>
<p>시계열 객체 <code>depart.ts</code>의 시계열 그래프를 작성해 보자.
그림 <a href="chapter-arima.html#fig:depart-1">4.16</a>의 시계열 그래프에서 뚜렷한 증가 추세와 계절 요소가 있음을 확인할 수 있다.
또한 계절 요소의 변동 폭이 증가 추세에 따라 함께 증가하고 있는 것도 볼 수 있다.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="chapter-arima.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(depart.ts) <span class="sc">+</span> </span>
<span id="cb153-2"><a href="chapter-arima.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-1"></span>
<img src="_main_files/figure-html/depart-1-1.png" alt="국내 백화점 매출액 자료" width="576" />
<p class="caption">
그림 4.16: 국내 백화점 매출액 자료
</p>
</div>
<p>따라서 백화점 매출액 자료는 분산이 동일하지 않고, 추세와 계절 요소가 모두 있는 비정상 시계열자료임을 알 수 있다.
우선 로그변환을 실시한 자료의 시계열 그래프를 그림 <a href="chapter-arima.html#fig:depart-2">4.17</a>에 작성해서 분산이 일정하게 되었는지 확인해 보자.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="chapter-arima.html#cb154-1" aria-hidden="true" tabindex="-1"></a>lndepart <span class="ot">&lt;-</span> <span class="fu">log</span>(depart.ts)</span>
<span id="cb154-2"><a href="chapter-arima.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lndepart) <span class="sc">+</span> </span>
<span id="cb154-3"><a href="chapter-arima.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;log(depart.ts)&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-2"></span>
<img src="_main_files/figure-html/depart-2-1.png" alt="로그 변환된 백화점 매출액 자료" width="576" />
<p class="caption">
그림 4.17: 로그 변환된 백화점 매출액 자료
</p>
</div>
<p>계절 요소의 변동 폭이 일정하게 유지되고 있음을 알 수 있다.
이제 추세와 계절 요소를 제거하기 위한 차분 차수를 결정해 보자.
차분 차수는 시계열 그래프와 표본 ACF, 그리고 단위근 검정 결과를 모두 반영해서 결정하는 것이 좋다.
먼저 단위근 검정 결과를 확인해 보자.
1차 차분과 계절 차분이 모두 필요한 것으로 나타났다.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="chapter-arima.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(lndepart)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="chapter-arima.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(lndepart)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>이제 시계열 그래프와 표본 ACF의 형태를 그림 <a href="chapter-arima.html#fig:depart-2">4.17</a>에서 확인해 보자.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="chapter-arima.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lndepart, <span class="at">lag.max =</span> <span class="dv">36</span>, </span>
<span id="cb159-2"><a href="chapter-arima.html#cb159-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;lndepart: log transformed data&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-3"></span>
<img src="_main_files/figure-html/depart-3-1.png" alt="`lndepart`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.18: <code>lndepart</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>차분과 계절 차분이 모두 필요한 것으로 보이는 경우에는 계절 차분을 먼저 실시하는 것이 좋다.
계절차분을 실시한 자료를 대상으로 시계열 그래프와 ACF를 작성해 보자.
그림 <a href="chapter-arima.html#fig:depart-4">4.19</a>에서 표본 ACF가 1시차에서 6시차까지 매우 천천히 감소하는 것을 볼 수 있고,
따라서 일반 차분도 필요한 것으로 보인다.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="chapter-arima.html#cb160-1" aria-hidden="true" tabindex="-1"></a>lndepart_12 <span class="ot">&lt;-</span> <span class="fu">diff</span>(lndepart, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb160-2"><a href="chapter-arima.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lndepart_12, <span class="at">lag.max =</span> <span class="dv">36</span>, </span>
<span id="cb160-3"><a href="chapter-arima.html#cb160-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Seasonally differenced lndepart&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-4"></span>
<img src="_main_files/figure-html/depart-4-1.png" alt="계절 차분을 실시한 `lndepart`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.19: 계절 차분을 실시한 <code>lndepart</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>1차 차분과 계절 차분을 모두 실시한 자료의 시계열 그래프와 ACF를 작성해 보자.
더 이상 비정상성 요소가 남아 있지 않다는 것을 그림 <a href="chapter-arima.html#fig:depart-5">4.20</a>에서 확인할 수 있다.
즉, 단위근 검정과 시계열 그래프, 그리고 표본 ACF를 근거로 계절 차분과 1차 차분이 모두 필요한 것으로 결정할 수 있다.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="chapter-arima.html#cb161-1" aria-hidden="true" tabindex="-1"></a>lndepart_12_1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(lndepart_12)</span>
<span id="cb161-2"><a href="chapter-arima.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lndepart_12_1, <span class="at">lag.max =</span> <span class="dv">36</span>, </span>
<span id="cb161-3"><a href="chapter-arima.html#cb161-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Doubly differenced lndepart&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-5"></span>
<img src="_main_files/figure-html/depart-5-1.png" alt="계절 차분과 1차 차분을 실시한 `lndepart`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.20: 계절 차분과 1차 차분을 실시한 <code>lndepart</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>로그 변환과 계절 차분 및 1차 차분으로 비장상성을 모두 제거한 후에는 변환된 자료에 가장 적합한 모형을 식별해야 한다. 그림 <a href="chapter-arima.html#fig:depart-5">4.20</a>에서 볼 수 있는 표본 ACF와 PACF를 근거로 모형을 식별해 보자.
비계절형 AR 차수와 MA 차수는 시차 1에서 시차 6까지의 패턴을 보고 결정해야 하는데,
표본 ACF는 1 시차만 유의한 값이고, 이후 시차는 모두 파란 점선 안으로 들어와 있음을 알 수 있고,
표본 PACF는 1, 2 시차가 비교적 큰 값이고, 이후 시차는 모두 점선 안으로 확실하게 들어와 있는 작은 값이다.
따라서 ACF는 1시차 이후 절단, PACF는 감소 형태로 판단할 수 있어서,
비계절형은 <code>p=0, q=1</code>인 MA(1)으로 식별할 수 있다.</p>
<p>계절형 요소는 시차 12, 24, 36의 패턴으로 판단해야 하는데,
ACF와 PACF가 12, 24, 36 시차에서 모두 작은 값을 보이고 있는 것을 볼 수 있다.
이러한 경우에는 <code>P=0, Q=0</code>으로 식별할 수도 있지만, <code>P=1, Q=0</code> 또는 <code>P=0, Q=1</code>으로 식별하는 것도 가능하다.</p>
<p>따라서 표본 ACF와 PACF를 근거로 식별을 시도한다면,
ARIMA(0,1,1)(0,1,0)<sub>12</sub> 모형과 ARIMA(0,1,1)(1,1,0)<sub>12</sub> 모형, 그리고
ARIMA(0,1,1)(0,1,1)<sub>12</sub> 모형으로 식별할 수 있다.</p>
<p>이제 함수 <code>auto.arima()</code>를 사용하여 최적 모형을 식별해 보자.
함수 <code>auto.arima()</code>에서는 차분 차수를 단위근 검정에 의해 결정하는 것이 디폴트이며,
백화점 자료의 경우에는 가장 적절한 차분 차수가 단위근 검정 결과와 일치하기 때문에,
<code>d</code>와 <code>D</code>에 다른 값을 지정할 필요는 없다.
또한 분산 안정화를 위해 로그 변환을 시행해야 하기 때문에 <code>lambda</code>에 로그변환에 해당하는 값인 0을 지정해야 한다.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="chapter-arima.html#cb162-1" aria-hidden="true" tabindex="-1"></a>fit_d <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(depart.ts, <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb162-2"><a href="chapter-arima.html#cb162-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-3"><a href="chapter-arima.html#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_d)</span></code></pre></div>
<pre><code>## Series: depart.ts 
## ARIMA(0,1,1)(0,1,1)[12] 
## Box Cox transformation: lambda= 0 
## 
## Coefficients:
##           ma1     sma1
##       -0.5840  -0.4159
## s.e.   0.1093   0.1946
## 
## sigma^2 = 0.0005401:  log likelihood = 110.29
## AIC=-214.59   AICc=-214.03   BIC=-209.04
## 
## Training set error measures:
##                     ME    RMSE      MAE       MPE    MAPE
## Training set -1.937472 16.9307 11.60509 -0.200563 1.36766
##                   MASE       ACF1
## Training set 0.1084166 0.04358066</code></pre>
<p>ACF와 PACF를 근거로 식별한 후보 모형 중 하나인 ARIMA(0,1,1)(0,1,1)<sub>12</sub>가 선택되었음을 알 수 있다.</p>
<p>추정된 모형식은 다음과 같다.</p>
<p><span class="math display">\[
(1-B^{12})(1-B)~\log y_{t} = (1-0.584B)(1-0.4159B^{12})~\varepsilon_{t}
\]</span>
적합된 모형 <code>fit_d</code>의 모형의 진단을 실시해 보자.
잔차가 정규분포 백색잡음을 하는 것으로 보여서, 가정이 만족된다고 할 수 있다.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="chapter-arima.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_d)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,1,1)(0,1,1)[12]
## Q* = 12.817, df = 10, p-value = 0.2341
## 
## Model df: 2.   Total lags used: 12</code></pre>
<p>예측 결과를 그림 <a href="chapter-arima.html#fig:depart-6">4.21</a>에 그래프로 나타내보자.
예측 결과는 정상성 확보 과정에서 이루어진 변환의 역변환을 실시해서 얻어진 것이다.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="chapter-arima.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(fit_d) <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="chapter-arima.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:depart-6"></span>
<img src="_main_files/figure-html/depart-6-1.png" alt="백화점 자료 예측 결과" width="576" />
<p class="caption">
그림 4.21: 백화점 자료 예측 결과
</p>
</div>
<ul>
<li>예제 2 : 1981년 1월부터 1992년 12월까지 국내에 입국한 월별 관광객 수</li>
</ul>
<p>1981년 1월부터 1992년 12월까지 12년 동안 국내에 입국한 월별 관광객 수 자료를 대상으로 ARIMA 모형과 ETS 모형으로 예측 모형을 각각 적합하고, 예측 결과를 비교해 보자.
예측 결과의 비교를 위해 마지막 2년 자료를 test data로 남겨두고,
이전 10년 동안의 자료를 이용하여 모형 적합을 실시해 보자.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="chapter-arima.html#cb167-1" aria-hidden="true" tabindex="-1"></a>tour <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;https://raw.githubusercontent.com/yjyjpark/TS-with-R/main/Data/Ktour.txt&quot;</span>)</span>
<span id="cb167-2"><a href="chapter-arima.html#cb167-2" aria-hidden="true" tabindex="-1"></a>tour.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(tour, <span class="at">start =</span> <span class="dv">1981</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb167-3"><a href="chapter-arima.html#cb167-3" aria-hidden="true" tabindex="-1"></a>train_K <span class="ot">&lt;-</span> <span class="fu">window</span>(tour.ts, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">12</span>))</span>
<span id="cb167-4"><a href="chapter-arima.html#cb167-4" aria-hidden="true" tabindex="-1"></a>test_K <span class="ot">&lt;-</span> <span class="fu">window</span>(tour.ts, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Training data에 대한 시계열 그래프를 그림 <a href="chapter-arima.html#fig:tour-1">4.22</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="chapter-arima.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(train_K) <span class="sc">+</span></span>
<span id="cb168-2"><a href="chapter-arima.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:tour-1"></span>
<img src="_main_files/figure-html/tour-1-1.png" alt="국내 입국 관광객 수 자료" width="576" />
<p class="caption">
그림 4.22: 국내 입국 관광객 수 자료
</p>
</div>
<p>계절형 ARIMA 모형을 먼저 적합시켜 보자.
시계열자료가 증가하는 추세가 있고, 뚜렷한 계절 요소가 있으며, 계절 변동 폭이 점차 증가하는 모습을 보이는 비정상 시계열자료이다.
분산 안정화 변화가 필요한 것으로 보이며, 적절한 변환 형태를 결정하기 위해 Box-Cox 변환 모수 <span class="math inline">\(\lambda\)</span> 의 값을 추정해 보자.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="chapter-arima.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BoxCox.lambda</span>(train_K) </span></code></pre></div>
<pre><code>## [1] 0.09573094</code></pre>
<p><span class="math inline">\(\hat{\lambda}=0.09\)</span> 로 추정되었는데, 이 결과를 그대로 적용해서 <span class="math inline">\(y_{t}^{0.09}\)</span> 로 변환시키는 것보다는 변환의 해석이 가능하면서 추정된 <span class="math inline">\(\lambda\)</span> 값과 큰 차이가 없는 <span class="math inline">\(\hat{\lambda}=0\)</span> 에 해당하는 로그 변환을 선택하는 것이 더 좋을 듯 하다.</p>
<p>로그 변환된 자료에 대한 차분 차수를 결정해 보자.
먼저 로그 변환된 시계열자료의 시계열 그래프와 ACF를 그림 <a href="chapter-arima.html#fig:tour-2">4.23</a>에 작성해 보자.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="chapter-arima.html#cb171-1" aria-hidden="true" tabindex="-1"></a>lntrain_K <span class="ot">&lt;-</span> <span class="fu">log</span>(train_K)</span>
<span id="cb171-2"><a href="chapter-arima.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lntrain_K, </span>
<span id="cb171-3"><a href="chapter-arima.html#cb171-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;log transformed:lntrain_K&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:tour-2"></span>
<img src="_main_files/figure-html/tour-2-1.png" alt="`lntrain_K`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.23: <code>lntrain_K</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>계절 차분을 먼저 실시해 보고, 그 결과를 살펴보자.
그림 <a href="chapter-arima.html#fig:tour-3">4.24</a>의 시계열 그래프에서 추세 성분이 남아 있는 것을 볼 수 있고,
ACF의 1~6시차에서 상당히 큰 값을 볼 수 있다.
1차 차분이 필요한 것으로 보인다.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="chapter-arima.html#cb172-1" aria-hidden="true" tabindex="-1"></a>lntrain_K_12 <span class="ot">&lt;-</span> <span class="fu">diff</span>(lntrain_K, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb172-2"><a href="chapter-arima.html#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lntrain_K_12, </span>
<span id="cb172-3"><a href="chapter-arima.html#cb172-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Seasonally differenced&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:tour-3"></span>
<img src="_main_files/figure-html/tour-3-1.png" alt="계절 차분된 `lntrain_K`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.24: 계절 차분된 <code>lntrain_K</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>계절 차분된 자료에 다시 1차 차분을 실시하고, 그 결과를 살펴보자.
그림 <a href="chapter-arima.html#fig:tour-4">4.25</a>의 그래프에서 비정상 요소가 모두 사라진 것을 알 수 있다.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="chapter-arima.html#cb173-1" aria-hidden="true" tabindex="-1"></a>lntrain_K_12_1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(lntrain_K_12)</span>
<span id="cb173-2"><a href="chapter-arima.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(lntrain_K_12_1, </span>
<span id="cb173-3"><a href="chapter-arima.html#cb173-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Doubly differenced&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:tour-4"></span>
<img src="_main_files/figure-html/tour-4-1.png" alt="계절 차분과 1차 차분된 `lntrain_K`의 시계열 그래프, ACF와 PACF" width="576" />
<p class="caption">
그림 4.25: 계절 차분과 1차 차분된 <code>lntrain_K</code>의 시계열 그래프, ACF와 PACF
</p>
</div>
<p>단위근 검정에서도 일치된 결과를 볼 수 있다.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="chapter-arima.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(lntrain_K)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="chapter-arima.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(lntrain_K)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>로그변환과 차분을 통해 정산성을 만족한 자료의 ACF와 PACF인 그림 <a href="chapter-arima.html#fig:tour-4">4.25</a>를 이용하여 모형 식별을 시도해 보자.
1시차에서 6시차까지의 패턴으로 비계절 ARIMA 성분을 파악해 보자.
ACF는 2시차까지 유의한 값을 보이고 있고,
PACF는 1시차는 유의하고, 2시차의 값은 기준이 되는 파란 점선보다 약간 작은 값으로 보인다.
이런 경우에는 둘 중 하나를 절단으로 보든지, 아니면 둘 다 감소로 보는 것이 가능하기 떄문에
AR(1), AR(2), MA(2), 또는 ARMA(1,1) 등이 가능한 것으로 보인다.</p>
<p>계절형 ARIMA 성분은 ACF와 PACF 모두 12시차에서 유의한 값을 보이지만,
24시차와 36시차에서는 매우 작은 값을 보이고 있기 때문에
ACF와 PACF 중 하나를 절단으로 보든지, 둘 다 감소로 보는 것이 가능하며,
AR(1)<sub>12</sub>, MA(1)<sub>12</sub>, 또는 ARMA(1,1)<sub>12</sub> 등이 가능한 것으로 보인다.</p>
<p>식별된 비계절형과 계절형을 조합해서 보면, 많은 모형이 가능한 것으로 보인다.
ARIMA(1,1,0)(1,1,0)<sub>12</sub>모형, ARIMA(1,1,0)(0,1,1)<sub>12</sub>모형, ARIMA(1,1,0)(1,1,1)<sub>12</sub>모형과
ARIMA(2,1,0)(1,1,0)<sub>12</sub>모형, ARIMA(2,1,0)(0,1,1)<sub>12</sub>모형, ARIMA(2,1,0)(1,1,1)<sub>12</sub>모형, 그리고
ARIMA(1,1,1)(1,1,0)<sub>12</sub>모형, ARIMA(1,1,1)(0,1,1)<sub>12</sub>모형, ARIMA(1,1,1)(1,1,1)<sub>12</sub>모형 등이 가능한 모형으로 보인다.</p>
<p>ACF와 PACF를 근거로 직접 모형 식별하는 것은 이렇듯 명확한 결과가 나오는 것이 아니어서,
많은 후보 모형을 식별하고 이어서 그 모형들을 비교하는 과정을 거쳐서 최종 모형을 선택해야 하는 어렵고 긴 작업 절차가 필요한 방법임을 알 수 있다.
따라서 이 과정이 모든 분석에서 반드시 필요하다고 생각하지는 않지만,
함수 <code>auto.arima()</code>로 선택된 모형이 ACF와 PACF를 근거로 식별된 후보 모형 중에 포함되는지 여부는 확인하는 것이 필요하다고 본다.</p>
<p>이제 함수 <code>auto.arima()</code>로 모형을 선택해 보자.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="chapter-arima.html#cb178-1" aria-hidden="true" tabindex="-1"></a>fit_K <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train_K, <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb178-2"><a href="chapter-arima.html#cb178-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-3"><a href="chapter-arima.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_K)</span></code></pre></div>
<pre><code>## Series: train_K 
## ARIMA(2,1,0)(1,1,1)[12] 
## Box Cox transformation: lambda= 0 
## 
## Coefficients:
##           ar1      ar2     sar1     sma1
##       -0.6995  -0.2496  -0.2892  -0.3817
## s.e.   0.0956   0.0947   0.1695   0.1736
## 
## sigma^2 = 0.002917:  log likelihood = 159.82
## AIC=-309.63   AICc=-309.04   BIC=-296.27
## 
## Training set error measures:
##                     ME     RMSE      MAE        MPE
## Training set -117.8446 8079.833 5752.686 -0.1325567
##                  MAPE      MASE      ACF1
## Training set 3.815935 0.3223641 0.1387895</code></pre>
<p>ARIMA(2,1,0)(1,1,1)<sub>12</sub>모형이 선택되었고, 이 모형은 ACF와 PACF를 근거로 선택한 후보 모형 중에 하나이다.
적합된 모형식은 다음과 같다.</p>
<p><span class="math display">\[
(1+0.69B+0.25B^{2})(1+0.29B^{12})(1-B)(1-B^{12})~\log y_{t} = (1-0.382^{12})~\varepsilon_{t}
\]</span></p>
<p>이제는 ETS 모형을 적합해 보자.
ETS 모형에서는 승법모형이 가능하기 때문에 분산안정화를 위한 변환이 반드시 필요한 것은 아니다.
따라서 원자료에 의한 ETS 모형과 로그 변환된 자료의 ETS 모형을 모두 적합시켜 보자.</p>
<p>먼저 로그 변환된 자료를 대상으로 모형을 적합해 보자.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="chapter-arima.html#cb180-1" aria-hidden="true" tabindex="-1"></a>fit_K_ets1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_K, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb180-2"><a href="chapter-arima.html#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_K_ets1)</span></code></pre></div>
<pre><code>## ETS(A,Ad,A) 
## 
## Call:
##  ets(y = train_K, lambda = 0) 
## 
##   Box-Cox transformation: lambda= 0 
## 
##   Smoothing parameters:
##     alpha = 0.3998 
##     beta  = 0.0242 
##     gamma = 1e-04 
##     phi   = 0.978 
## 
##   Initial states:
##     l = 11.3617 
##     b = 0.0098 
##     s = -0.2089 -0.0012 0.1585 0.0577 0.1123 0.035
##            0.0516 0.1154 0.0989 0.0121 -0.2092 -0.2221
## 
##   sigma:  0.0548
## 
##        AIC       AICc        BIC 
## -104.72171  -97.94943  -54.54685 
## 
## Training set error measures:
##                    ME     RMSE      MAE       MPE     MAPE
## Training set 1116.089 8322.678 5764.589 0.4909287 3.788076
##                   MASE       ACF1
## Training set 0.3230311 0.09314822</code></pre>
<p>ETS(A,Ad,A) 모형이 선택되었다.</p>
<p>이제 원자료를 대상으로 모형을 적합해 보자.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="chapter-arima.html#cb182-1" aria-hidden="true" tabindex="-1"></a>fit_K_ets2 <span class="ot">&lt;-</span> <span class="fu">ets</span>(train_K)</span>
<span id="cb182-2"><a href="chapter-arima.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_K_ets2)</span></code></pre></div>
<pre><code>## ETS(M,Ad,M) 
## 
## Call:
##  ets(y = train_K) 
## 
##   Smoothing parameters:
##     alpha = 0.4275 
##     beta  = 0.0306 
##     gamma = 1e-04 
##     phi   = 0.9799 
## 
##   Initial states:
##     l = 89459.3204 
##     b = 291.8495 
##     s = 0.808 0.9953 1.172 1.0557 1.1073 1.0353
##            1.0453 1.1046 1.0949 0.9939 0.7992 0.7886
## 
##   sigma:  0.0562
## 
##      AIC     AICc      BIC 
## 2738.255 2745.028 2788.430 
## 
## Training set error measures:
##                    ME     RMSE      MAE       MPE     MAPE
## Training set 1147.204 8155.819 5774.677 0.5763675 3.839131
##                   MASE       ACF1
## Training set 0.3235964 0.02357097</code></pre>
<p>ETS(M,Ad,M) 모형이 선택되었다.
두 ETS 모형 모두 추세는 ’damped additive’가 선택되었지만,
로그 변환된 자료에 대해서는 계절 요소와 오차항이 모두 ’additive’이고,
원자료에 대해서는 계절 요소와 오차항이 모두 ’multiplicative’임을 알 수 있다.</p>
<p>이제 적합된 ARIMA 모형과 ETS 모형의 모형 진단을 각각 실시해 보자.
먼저 ARIMA 모형의 경우에는 오차에 대한 가정이 모두 만족되는 것으로 보인다.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="chapter-arima.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_K)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(2,1,0)(1,1,1)[12]
## Q* = 27.495, df = 20, p-value = 0.1219
## 
## Model df: 4.   Total lags used: 24</code></pre>
<p>ETS 모형의 경우에는 Ljung-Box 검정의 p-value가 매우 작은 값으로 계산되었고,
따라서 오차의 독립성은 만족되지 않았다.
이런 경우에는 ETS 모형으로 예측된 결과에 대한 신빙성이 떨어진다고 볼 수 있는데,
점 예측값보다는 예측 구간에 대한 신뢰도에 더 큰 손상이 있었다고 할 수 있다.</p>
<p>구제적인 검진 결과를 살펴보자.
우선 ETS(A,Ad,A) 모형인 <code>fit_K_ets1</code> 모형의 검진 결과이다.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="chapter-arima.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_K_ets1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-71-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ETS(A,Ad,A)
## Q* = 36.158, df = 7, p-value = 6.769e-06
## 
## Model df: 17.   Total lags used: 24</code></pre>
<p>ETS(M,Ad,M) 모형인 <code>fit_K_ets2</code> 모형의 검진 결과도 살펴보자.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="chapter-arima.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_K_ets2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="576" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ETS(M,Ad,M)
## Q* = 34.451, df = 7, p-value = 1.418e-05
## 
## Model df: 17.   Total lags used: 24</code></pre>
<p>이제 test data에 대한 예측을 실시하고 예측 오차를 비교해 보자.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="chapter-arima.html#cb190-1" aria-hidden="true" tabindex="-1"></a>fc_K <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_K)</span>
<span id="cb190-2"><a href="chapter-arima.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc_K, test_K)</span></code></pre></div>
<pre><code>##                       ME      RMSE       MAE         MPE
## Training set   -117.8446  8079.833  5752.686  -0.1325567
## Test set     -33473.2740 45118.350 37348.980 -12.4581745
##                   MAPE      MASE      ACF1 Theil&#39;s U
## Training set  3.815935 0.3223641 0.1387895        NA
## Test set     13.967241 2.0929303 0.6467465   1.67741</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="chapter-arima.html#cb192-1" aria-hidden="true" tabindex="-1"></a>fc_K_ets1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_K_ets1)</span>
<span id="cb192-2"><a href="chapter-arima.html#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc_K_ets1, test_K)</span></code></pre></div>
<pre><code>##                      ME      RMSE       MAE        MPE
## Training set   1116.089  8322.678  5764.589  0.4909287
## Test set     -26763.496 38813.714 33571.599 -9.9007782
##                   MAPE      MASE       ACF1 Theil&#39;s U
## Training set  3.788076 0.3230311 0.09314822        NA
## Test set     12.507782 1.8812566 0.55156580  1.469369</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="chapter-arima.html#cb194-1" aria-hidden="true" tabindex="-1"></a>fc_K_ets2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_K_ets2)</span>
<span id="cb194-2"><a href="chapter-arima.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(fc_K_ets2, test_K)</span></code></pre></div>
<pre><code>##                      ME      RMSE       MAE        MPE
## Training set   1147.204  8155.819  5774.677  0.5763675
## Test set     -25539.311 37954.952 32640.675 -9.4299420
##                   MAPE      MASE       ACF1 Theil&#39;s U
## Training set  3.839131 0.3235964 0.02357097        NA
## Test set     12.153867 1.8290903 0.54315176  1.439223</code></pre>
<p>큰 차이는 없지만 ETS(M,Ad,M) 모형인 <code>fit_K_ets2</code> 모형의 예측 오차가 조금 더 작은 것으로 나타났다.
ARIMA 모형과 ETS(M,Ad,M) 모형의 예측 결과를 그림 <a href="chapter-arima.html#fig:tour-5">4.26</a>의 그래프로 비교해 보자.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chapter-arima.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb196-2"><a href="chapter-arima.html#cb196-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fc_K, <span class="at">include =</span> <span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb196-3"><a href="chapter-arima.html#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(test_K, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb196-4"><a href="chapter-arima.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb196-5"><a href="chapter-arima.html#cb196-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-6"><a href="chapter-arima.html#cb196-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fc_K_ets2, <span class="at">include =</span> <span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb196-7"><a href="chapter-arima.html#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(test_K, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb196-8"><a href="chapter-arima.html#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb196-9"><a href="chapter-arima.html#cb196-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:tour-5"></span>
<img src="_main_files/figure-html/tour-5-1.png" alt="국내 입국 관광객 수 자료에 대한 예측 결과" width="768" />
<p class="caption">
그림 4.26: 국내 입국 관광객 수 자료에 대한 예측 결과
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-ets.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
