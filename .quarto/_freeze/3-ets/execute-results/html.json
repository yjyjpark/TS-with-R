{
  "hash": "80ec80370972621229dffe7d14145347",
  "result": {
    "engine": "knitr",
    "markdown": "# ETS 모형 {#sec-ets}\n\n\n::: {.cell}\n\n:::\n\n\n\n## 전통적 지수평활법 {-}\n\n-   Simple exponential smoothing 예제: `fpp2::oil`\n\n`fpp2::oil`은 1965년부터 2013년까지 Saudi Arabia의 연간 원유 생산량 자료이다. 1996년 이후 자료에 대해 simple exponential smoothing을 적용해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noil_1996 <- window(oil, start = 1996)\n```\n:::\n\n\n1996년 이후 연간 원유 생산량 자료의 시계열 그래프를 @fig-oil-1996 에 작성해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(oil_1996) + \n  labs(title = \"Annual oil production in Saudi Arabia\", \n       y = NULL)\n```\n\n::: {.cell-output-display}\n![1996년 이후 Saudi Arabia 연간 원유 생산량](3-ets_files/figure-html/fig-oil-1996-1.png){#fig-oil-1996 width=672}\n:::\n:::\n\n\n함수 `ses()`를 사용하여 2014년 \\~ 2016년의 원유 생산량을 예측해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nses(oil_1996, h = 3) %>% \n  summary()\n## \n## Forecast method: Simple exponential smoothing\n## \n## Model Information:\n## Simple exponential smoothing \n## \n## Call:\n##  ses(y = oil_1996, h = 3) \n## \n##   Smoothing parameters:\n##     alpha = 0.8339 \n## \n##   Initial states:\n##     l = 446.5868 \n## \n##   sigma:  29.8282\n## \n##      AIC     AICc      BIC \n## 178.1430 179.8573 180.8141 \n## \n## Error measures:\n##                    ME     RMSE     MAE      MPE     MAPE      MASE        ACF1\n## Training set 6.401975 28.12234 22.2587 1.097574 4.610635 0.9256774 -0.03377748\n## \n## Forecasts:\n##      Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95\n## 2014       542.6806 504.4541 580.9070 484.2183 601.1429\n## 2015       542.6806 492.9073 592.4539 466.5589 618.8023\n## 2016       542.6806 483.5747 601.7864 452.2860 633.0752\n```\n:::\n\n\nLevel에 대한 평활상수가 $\\alpha =$ 0.8339으로 추정되었다는 것은 level에 큰 변화가 있는 자료를 의미한다. 이제 예측 결과를 @fig-oil-1996-fore 의 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nses(oil_1996, h = 3) %>% \n  autoplot() + \n  labs(y = NULL)\n```\n\n::: {.cell-output-display}\n![1996년 이후 Saudi Arabia 연간 원유 생산량 및 2014년 이후 예측 결과](3-ets_files/figure-html/fig-oil-1996-fore-1.png){#fig-oil-1996-fore width=672}\n:::\n:::\n\n\n파란 실선으로 표시된 예측값은 마지막 level 추정값으로써, 모든 `h`에 대하여 동일하다는 것을 알 수 있다. 예측값을 표시한 실선을 포함하고 있는 짙은 파란 색 영역은 80% 예측 구간을 표시한 것이고, 옅은 파란 색 영역은 95% 예측 구간을 표시한 것이다. 예측 시차가 증가함에 따라 예측 구간의 폭은 계속 넓어지고 있음을 알 수 있다.\n\n-   Trend method 예제: `fpp2::ausair`\n\n`fpp2::ausair`는 1970년부터 2016년까지 호주의 연간 항공기 승객 수 자료이다. Holt's linear trend와 damped Holt's trend 모형을 이용해서 예측을 실시해 보자.\n\n먼저 시계열 그래프를 @fig-aus-air 에 작성해 보자.\n상승 추세가 있는 것을 확인할 수 있다. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(ausair) +\n  labs(title = \"Air Transport Passengers Australia\", \n       y = NULL)\n```\n\n::: {.cell-output-display}\n![1970년부터 2016년까지 호주의 연간 항공기 승객 수](3-ets_files/figure-html/fig-aus-air-1.png){#fig-aus-air width=672}\n:::\n:::\n\n\nHolt's linear trend 모형을 함수 `holt()`를 사용해서 적합시키고, 15 시차에 대한 예측 결과를 @fig-aus-air-fore1 에 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholt(ausair, h = 15) %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![`ausair` 자료에 대한 Holt's linear trend method의 예측 결과](3-ets_files/figure-html/fig-aus-air-fore1-1.png){#fig-aus-air-fore1 width=672}\n:::\n:::\n\n\nDamped Holt's trend 모형에 의한 예측 결과도 그래프로 나타내 보자. 결과는 @fig-aus-air-fore2 에서 볼 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholt(ausair, h = 15, damped = TRUE) %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![`ausair` 자료에 대한 damped Holt's trend method의 예측 결과](3-ets_files/figure-html/fig-aus-air-fore2-1.png){#fig-aus-air-fore2 width=672}\n:::\n:::\n\n\n@fig-aus-air-fore1 에서 볼 수 있듯이 Holt's linear trend method에 의한 예측 결과는 지속적으로 증가하고 있으며, 반면에 damped Holt's trend method에 의한 예측 결과는 상승 기울기가 점점 줄어들고 있다는 것을 @fig-aus-air-fore2 에서 볼 수 있다.\n\n-  Holt-Winters' seasonal method 예제: `fpp2::austourists`\n\n`austourists`는 199년부터 2015년까지 분기별 호주에 입국한 외국인 관광객 수 자료이다. 시계열 그래프는 @fig-austour-1 에서 볼 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(austourists) +\n  labs(y = NULL, title = \"International Tourists to Australia\")\n```\n\n::: {.cell-output-display}\n![199년부터 2015년까지 분기별 호주에 입국한 외국인 관광객 수](3-ets_files/figure-html/fig-austour-1-1.png){#fig-austour-1 width=672}\n:::\n:::\n\n\nHolt-Winters' seasonal 모형을 이용해서 예측을 실시해 보자. 먼저 가법 모형으로 예측을 실시하고 결과를 @fig-austour-2 에 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhw(austourists) %>% \n  autoplot() + labs(y = NULL)\n```\n\n::: {.cell-output-display}\n![`austourists` 자료에 대한 Holt-Winters' additive seasonal method의 예측 결과](3-ets_files/figure-html/fig-austour-2-1.png){#fig-austour-2 width=672}\n:::\n:::\n\n\n이번에는 승법 모형으로 예측을 실시하고 결과를 @fig-austour-3 에 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhw(austourists, seasonal = \"multiplicative\") %>% \n  autoplot() + labs(y = NULL)\n```\n\n::: {.cell-output-display}\n![`austourists` 자료에 대한 Holt-Winters' multiplicative seasonal method의 예측 결과](3-ets_files/figure-html/fig-austour-3-1.png){#fig-austour-3 width=672}\n:::\n:::\n\n\n## ETS 모형 {-}\n\n-   예제 1: 1970년부터 2016년까지 연간 항공기 이용객 수 (`fpp2::ausair`)\n\n`fpp2::ausair`는 1970년부터 2016년까지 호주의 연간 항공기 승객 수 자료이다. 먼저 전체 자료 중 1970년부터 2011년까지의 자료를 training data로 하고, 2012년 이후 자료를 test data로 분리하자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_air <- window(ausair, end = 2011)\ntest_air <- window(ausair, start = 2012)\n```\n:::\n\n\n`train_air`와 `test_air`의 시계열 그래프는 @fig-ausair-plot 과 같다. `test_air`는 빨간 선으로 나타냈다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(window(ausair, end = 2012)) +\n  autolayer(window(ausair, start = 2012), size = .8) +\n  labs(y = NULL, x = NULL) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![`ausair` 자료의 시계열그래프](3-ets_files/figure-html/fig-ausair-plot-1.png){#fig-ausair-plot width=672}\n:::\n:::\n\n\n함수 `ets()`로 ETS 모형을 적합하고, 그 결과를 확인해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_air <- ets(train_air)\nfit_air\n## ETS(M,A,N) \n## \n## Call:\n##  ets(y = train_air) \n## \n##   Smoothing parameters:\n##     alpha = 0.9999 \n##     beta  = 0.024 \n## \n##   Initial states:\n##     l = 6.5399 \n##     b = 0.7358 \n## \n##   sigma:  0.08\n## \n##      AIC     AICc      BIC \n## 206.1828 207.8495 214.8712\n```\n:::\n\n\n최적 모형은 ETS(M,A,N)으로 선정되었다. 즉, 추세는 additive이고 오차는 multiplicative이며, 계절요소가 없는 모형이 적합되었다. 평활모수는 $\\alpha=$ 0.9999 , $\\beta=$ 0.024 로 추정되었다. 따라서 시계열자료의 level에는 큰 변화가 있으나, 추세의 기울기에는 큰 변화 없이 일정하다는 것을 알 수 있다.\n\nETS 모형의 각 요소에 대한 추정 결과를 @fig-fit-air-comp 의 그래프로 나타내 보자.\n관측된 자료의 시계열 그래프, 그리고 level의 추정 결과와 추세 기울기의 추정 결과의 시계열 그래프가 함께 작성되어 있다. 그래프 오른쪽 끝에 있는 동일한 높이의 막대가 표시되어 있어서 각 요소의 스케일을 비교할 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(fit_air)  \n```\n\n::: {.cell-output-display}\n![ETS 모형의 각 요소에 대한 추정 결과 그래프](3-ets_files/figure-html/fig-fit-air-comp-1.png){#fig-fit-air-comp width=672}\n:::\n:::\n\n\n모형의 가정 만족 여부를 함수 `checkresiduals()`로 확인해 보자.\n특별히 문제가 되는 가정 사항은 없는 것으로 보인다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheckresiduals(fit_air)\n```\n\n::: {.cell-output-display}\n![](3-ets_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```\n## \n## \tLjung-Box test\n## \n## data:  Residuals from ETS(M,A,N)\n## Q* = 3.5236, df = 8, p-value = 0.8973\n## \n## Model df: 0.   Total lags used: 8\n```\n:::\n\n\n이제 예측을 실시하고 예측 오차에 대한 평가를 실시해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_air <- forecast(fit_air, h = length(test_air))\naccuracy(fc_air, test_air)\n##                     ME     RMSE     MAE       MPE     MAPE      MASE\n## Training set 0.5550369 2.138179 1.31460 0.7893247 5.399428 0.7649321\n## Test set     1.7629504 1.888573 1.76295 2.5419343 2.541934 1.0258159\n##                     ACF1 Theil's U\n## Training set -0.09163575        NA\n## Test set     -0.22513230  1.034042\n```\n:::\n\n\n예측 결과를 그래프로 나타내 보자. 함수 `autoplot()`에 함수 `forecast()`의 결과인 객체 `fc_air`를 입력하면 training data와 예측 결과를 함께 나타낸다. 옵션 `include`는 그래프에 포함시킬 training data의 개수를 지정하는 것이다. 따라서 `include = 0`을 입력하면 예측 부분만을 확대한 효과를 볼 수 있다.\n작성 결과는 @fig-aus-ETS-fore 에서 볼 수 있다. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 <- autoplot(fc_air) + \n  autolayer(test_air, color = \"red\", size = .8) +\n  labs(y = NULL, x = NULL) \np2 <- autoplot(fc_air, include = 0) + \n  autolayer(test_air, color = \"red\", size=.8) +\n  labs(y = NULL, x = NULL) \np1 + p2\n```\n\n::: {.cell-output-display}\n![`fpp2::ausair` 자료에 대한 ETS 모형의 예측 결과](3-ets_files/figure-html/fig-aus-ETS-fore-1.png){#fig-aus-ETS-fore width=768}\n:::\n:::\n\n\n-   예제 2: 1999년부터 2015년까지 분기별 호주 입국 외국인 관광객 수 (`fpp2::austourists`)\n\n`austourists`는 1999년부터 2015년까지 분기별로 호주에 입국한 외국인 관광객 수 자료이다. 2013년 4분기까지를 training data로 분리하고 2014년 1분기부터를 test data로 분리하자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_tour <- window(austourists, end = c(2013, 4))\ntest_tour <- window(austourists, start = c(2014, 1))\n```\n:::\n\n\n두 자료의 시계열 그래프는 @fig-austour-plot 과 같다.\nTest data는 빨간 선으로 표시했다. 상승 추세가 있으며, 명확한 계절요소가 있는 것을 알 수 있다. \n또한 계절요소의 진폭이 추세가 상승함에 따라 다소 증가하고 있는 것을 볼 수 있다.   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(window(austourists, end = c(2014,1))) +\n  autolayer(window(austourists, start = c(2014,1)), size = .8) +\n  labs(y = NULL) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![`austourists` 자료의 시계열 그래프](3-ets_files/figure-html/fig-austour-plot-1.png){#fig-austour-plot width=672}\n:::\n:::\n\n\n함수 `ets()`로 최적 모형을 적합해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_tour <- ets(train_tour)\nfit_tour\n## ETS(M,A,M) \n## \n## Call:\n##  ets(y = train_tour) \n## \n##   Smoothing parameters:\n##     alpha = 0.4189 \n##     beta  = 1e-04 \n##     gamma = 1e-04 \n## \n##   Initial states:\n##     l = 24.2672 \n##     b = 0.5179 \n##     s = 1.0367 0.9578 0.7697 1.2358\n## \n##   sigma:  0.0612\n## \n##      AIC     AICc      BIC \n## 353.3882 356.9882 372.2373\n```\n:::\n\n\nETS(M,A,M) 모형이 선택되었다. 승법 계절 성분이 선택되었다는 것은 계절 요소의 변동 폭이 증가한다는 의미가 된다. 이런 경우에 시계열자료를 로그변환 시킨 후 다시 ETS 모형을 적합시키면 가법 계절 모형이 선택될 것이다. 함수 `ets()`의 Box_Cox 변환 모수인 옵션 `lambda`에 0을 입력하면 로그변환된 자료를 대상으로 모형 적합이 이루어진다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_lntour <- ets(train_tour, lambda = 0)\nfit_lntour\n## ETS(A,A,A) \n## \n## Call:\n##  ets(y = train_tour, lambda = 0) \n## \n##   Box-Cox transformation: lambda= 0 \n## \n##   Smoothing parameters:\n##     alpha = 0.337 \n##     beta  = 1e-04 \n##     gamma = 0.0137 \n## \n##   Initial states:\n##     l = 3.2161 \n##     b = 0.0122 \n##     s = 0.055 -0.0254 -0.2477 0.2181\n## \n##   sigma:  0.0639\n## \n##       AIC      AICc       BIC \n## -75.06808 -71.46808 -56.21898\n```\n:::\n\n\n모형 `fit_tour`의 가정 만족 여부를 확인해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheckresiduals(fit_tour)\n```\n\n::: {.cell-output-display}\n![](3-ets_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n\n```\n## \n## \tLjung-Box test\n## \n## data:  Residuals from ETS(M,A,M)\n## Q* = 4.2317, df = 8, p-value = 0.8356\n## \n## Model df: 0.   Total lags used: 8\n```\n:::\n\n\n모형 `fit_lntour`의 가정 만족 여부도 확인해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheckresiduals(fit_lntour)\n```\n\n::: {.cell-output-display}\n![](3-ets_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```\n## \n## \tLjung-Box test\n## \n## data:  Residuals from ETS(A,A,A)\n## Q* = 5.355, df = 8, p-value = 0.719\n## \n## Model df: 0.   Total lags used: 8\n```\n:::\n\n\n두 모형 모두 가정은 만족시키는 것으로 보인다. 이제 두 모형의 예측을 실시하고, 그 결과를 비교해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_tour <- forecast(fit_tour, h = length(test_tour)) \nfc_lntour <- forecast(fit_lntour, h = length(test_tour))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naccuracy(fc_tour, test_tour)\n##                       ME     RMSE      MAE        MPE     MAPE      MASE\n## Training set 0.004642325 1.966538 1.474615 -0.4054666 4.196005 0.5206241\n## Test set     1.541295202 2.989673 2.414226  2.6022154 3.958845 0.8523613\n##                    ACF1 Theil's U\n## Training set -0.0243205        NA\n## Test set      0.5001355 0.2077632\naccuracy(fc_lntour, test_tour)\n##                     ME     RMSE      MAE        MPE     MAPE      MASE\n## Training set 0.1640202 2.014686 1.562901 0.04389638 4.399828 0.5517943\n## Test set     0.6115065 2.128486 1.722829 1.03590923 2.853023 0.6082580\n##                    ACF1 Theil's U\n## Training set 0.01619145        NA\n## Test set     0.47705974 0.1348746\n```\n:::\n\n\n모형 ETS(A,A,A)인 `fit_lntour`의 test data에 대한 예측 오차가 조금 더 작은 것을 볼 수 있다.\n두 모형의 예측 결과를 @fig-tour-ets-fore1 의 그래프로 비교해 보자.\n함수 `autolayer()`에 `PI = FALSE`를 입력하면 예측 구간이 생략된다. 이것은 두 모형의 예측 구간이 함께 표시되면 서로 겹쳐지는 현상이 발생하기 때문에 생략한 것이다.\n두 모형의 예측에는 큰 차이가 없음을 알 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 <- autoplot(train_tour) +\n  autolayer(test_tour, series = \"Test data\") +\n  autolayer(fc_tour, PI = FALSE, series = \"ETS(M,A,M)\") +\n  autolayer(fc_lntour, PI = FALSE, series = \"ETS(A,A,A)\") +\n  labs(y = NULL, x = NULL, color = NULL) +\n  theme(legend.position = \"top\")\n\np2 <- autoplot(test_tour, series = \"Test data\", size = .8) +\n  autolayer(fc_tour, PI = FALSE, series = \"ETS(M,A,M)\", \n            size = .8) +\n  autolayer(fc_lntour, PI = FALSE, series = \"ETS(A,A,A)\", \n            size = .8) +\n  labs(y = NULL, x = NULL, color = NULL) +\n  theme(legend.position = \"top\")\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![`austourists` 자료에 대한 예측 결과 비교](3-ets_files/figure-html/fig-tour-ets-fore1-1.png){#fig-tour-ets-fore1 width=768}\n:::\n:::\n\n\n\n모형 ETS(A,A,A)인 `fit_lntour`의 test data에 대한 예측 결과를 예측 구간과 함께 @fig-tour-ets-fore3 의 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 <- autoplot(fc_lntour) +\n  autolayer(test_tour, color = \"red\", size = .8) +\n  labs(x = NULL, y = NULL) \np2 <- autoplot(fc_lntour, include = 0) +\n  autolayer(test_tour, color = \"red\", size = .8) +\n  labs(y = NULL, x = NULL) +\n  scale_x_continuous(breaks = c(2014.0, 2014.5, 2015.0, 2015.5),\n                     labels = c(\"2014.Q1\", \"2014.Q3\", \"2015.Q1\",\n                                \"2015.Q3\"))\np1 + p2\n```\n\n::: {.cell-output-display}\n![`austourists` 자료에 대한 예측 결과](3-ets_files/figure-html/fig-tour-ets-fore3-1.png){#fig-tour-ets-fore3 width=768}\n:::\n:::\n\n\n-   예제 3: 1965년 1월부터 1992년 7월까지 월별 실업 급여 수급 인원 수 (`fma::dole`)\n\n`fma::dole`은 1965년 1월부터 1992년 7월까지 월별로 실업 급여를 받아간 인원 수 자료이다. 마지막 2년 자료를 test data로 분리해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_d <- window(dole, end = c(1990, 7))\ntest_d <- window(dole, start = c(1990, 8))\n```\n:::\n\n\n두 자료에 대한 시계열 그래프는 @fig-dole-plot 과 같다.\nTest data는 빨간 선으로 표시했다.\n1990년부터 갑작스런 증가세를 보이고 있으며, test data가 대부분 그 시기에 관측된 것이다. 따라서 예측이 상당히 어려운 것으로 보이는 상황이다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(train_d) + \n  autolayer(test_d, show.legend=FALSE, size = .8) +\n  labs(y = NULL, x = NULL)\n```\n\n::: {.cell-output-display}\n![`dole` 자료의 시계열그래프](3-ets_files/figure-html/fig-dole-plot-1.png){#fig-dole-plot width=672}\n:::\n:::\n\n\nETS 모형을 적합해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_d <- ets(train_d)\nfit_d\n## ETS(M,Ad,M) \n## \n## Call:\n##  ets(y = train_d) \n## \n##   Smoothing parameters:\n##     alpha = 0.7057 \n##     beta  = 0.1262 \n##     gamma = 0.2942 \n##     phi   = 0.8701 \n## \n##   Initial states:\n##     l = 2693.6084 \n##     b = 838.4198 \n##     s = 1.0776 0.9108 0.9286 0.9993 1.0254 1.0275\n##            1.0028 0.9466 1.0225 0.9982 1.0038 1.0568\n## \n##   sigma:  0.0965\n## \n##       AIC      AICc       BIC \n##  9930.864  9932.591 10003.373\n```\n:::\n\n\n가정 만족 여부를 확인해 보니, 독립성 가정에 문제가 있는 것을 볼 수 있다. 이런 경우, 점 예측값 (point forecast)에는 별다른 문제가 없겠지만, 예측 구간을 신뢰하기 어렵다고 할 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheckresiduals(fit_d)\n```\n\n::: {.cell-output-display}\n![](3-ets_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n\n```\n## \n## \tLjung-Box test\n## \n## data:  Residuals from ETS(M,Ad,M)\n## Q* = 270.13, df = 24, p-value < 2.2e-16\n## \n## Model df: 0.   Total lags used: 24\n```\n:::\n\n\n예측을 실시하고 평가해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_d <- forecast(fit_d, h = length(test_d))\naccuracy(fc_d, test_d)\n##                      ME      RMSE        MAE        MPE      MAPE      MASE\n## Training set    307.438  16094.96   9474.828  0.5940649  6.112239 0.2965093\n## Test set     208048.806 234353.38 208048.806 28.7917875 28.791788 6.5107678\n##                   ACF1 Theil's U\n## Training set 0.5103798        NA\n## Test set     0.8895083  8.715368\n```\n:::\n\n\nMASE 값이 지나치게 큰 값이라는 것을 알 수 있다. 예측 결과를 @fig-dole-fore1 의 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(fc_d) +\n  autolayer(test_d, color = \"red\", size = .8) +\n  labs(y = NULL, x = NULL) \n```\n\n::: {.cell-output-display}\n![`dole` 자료에 대한 예측 결과](3-ets_files/figure-html/fig-dole-fore1-1.png){#fig-dole-fore1 width=672}\n:::\n:::\n\n\n예측이 완벽하게 벗어난 것을 볼 수 있다. 이와 같이 실업자 수가 갑작스럽게 증가하는 상황에서는 과거 자료만을 이용하는 시계열 모형으로는 효율적인 예측이 불가능하다고 하겠다. \n\nTest data에서 발생한 갑작스런 변화의 충격을 완화시키는 방법으로 test data의 기간 축소를 생각할 수 있다.\n이렇게 되면, 증가 추세가 training data에도 어느 정도 반영될 수 있을 것이다. \n하지만 이 방법은 자료의 추세를 먼저 확인하고 test data의 기간을 변경하는 것이어서 정당한 자료 분리 방법은 아니라고 할 수 있다.\n마지막 1년만을 test data로 남겨 놓고 모형 적합을 시도해 보자. 자료분리는 함수 `subset()`으로도 진행할 수 있다. 옵션 `end`와 `start`에 벡터에서 적용되는 방식의 인덱스를 지정할 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_d_1 <- subset(dole, end = length(dole) - 12)\ntest_d_1 <- subset(dole, start = length(dole) - 11)\n```\n:::\n\n\n변경된 training data를 사용해서 적합된 모형으로 마지막 1년 자료에 대한 예측을 실시해 보자.\n훨씬 개선된 결과를 볼 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_d_1 <- train_d_1 %>% \n  ets() %>% \n  forecast(h = length(test_d_1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naccuracy(fc_d_1, test_d_1)\n##                     ME     RMSE      MAE       MPE     MAPE      MASE      ACF1\n## Training set  419.4624 18184.20 10856.63 0.5111136 6.268750 0.3014767 0.5191139\n## Test set     5143.1303 46330.29 40948.53 1.0361996 5.319935 1.1370959 0.8678915\n##              Theil's U\n## Training set        NA\n## Test set      2.792915\n```\n:::\n\n\n이제 예측 결과를 그림 @fig-dole-fore-2)의 그래프로 나타내 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 <- autoplot(fc_d_1) + \n  autolayer(test_d_1, color = \"red\", size = .8) +\n  labs(y = NULL, x = NULL) \np2 <- autoplot(fc_d_1, include = 0) +\n  autolayer(test_d_1, color = \"red\", size = .8) +\n  labs(y = NULL, x = NULL) \np1 + p2\n```\n\n::: {.cell-output-display}\n![`dole` 자료에 대한 예측 결과](3-ets_files/figure-html/fig-dole-fore-2-1.png){#fig-dole-fore-2 width=768}\n:::\n:::\n\n\n-   예제 4: 2014년 4월 30일부터 1년간 Hyndsight 블로그 일일 방문자 수 (`fpp2::hyndsight`)\n\n`hyndsight`는 2014년 4월 30일부터 1년간 Hyndman이 운영하는 블로그에 방문한 일일 방문자 수 자료이다.\n자료의 시계열그래프는 @fig-hynd-plot 에서 볼 수 있다. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(hyndsight) + labs(x = NULL, y = NULL)\n```\n\n::: {.cell-output-display}\n![`hyndsight` 자료의 시계열그래프](3-ets_files/figure-html/fig-hynd-plot-1.png){#fig-hynd-plot width=672}\n:::\n:::\n\n\n일일 자료의 경우에 요일의 영향을 받는 자료라면 $m=7$의 계절 주기를 갖게 된다. 자료 분리를 위해 2014년 4월 30일이 무슨 요일인지 확인해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlubridate::wday(as.Date(\"2014-4-30\"), label = TRUE)\n## [1] 수\n## Levels: 일 < 월 < 화 < 수 < 목 < 금 < 토\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstart(hyndsight); end(hyndsight)\n## [1] 1 4\n## [1] 53  4\n```\n:::\n\n\n2014년 4월 30일은 수요일이며, 자료의 시작 시점은 1주 4일 (수)이고 종료 시점은 53주 4일 (수)이 된다. Training data는 1주 4일부터 48주 4일까지로 하고, test data는 48주 5일부터 53주 4일까지 5주간으로 설정하자.\n\n자료 분리는 함수 `window()`로 보통 진행하지만, 이렇게 자료의 개수로 분리하는 것이 더 편리한 경우에는 함수 `subset()`으로 진행 할 수 있다. 즉, 마지막 35일 자료를 test data로 분리해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_hyn <- subset(hyndsight, end = length(hyndsight)-35)\ntest_hyn <- subset(hyndsight, start = length(hyndsight)-34)\n```\n:::\n\n\nETS 모형을 적합해 보자. 추세는 없고, 오차와 계절 성분이 모두 가법 형태인 모형이 선택되었다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_hyn <- ets(train_hyn)\nfit_hyn\n## ETS(A,N,A) \n## \n## Call:\n##  ets(y = train_hyn) \n## \n##   Smoothing parameters:\n##     alpha = 0.4426 \n##     gamma = 1e-04 \n## \n##   Initial states:\n##     l = 1173.6676 \n##     s = 296.9907 -34.3415 -457.6839 -271.7606 63.9589 172.9509\n##            229.8854\n## \n##   sigma:  232.0085\n## \n##      AIC     AICc      BIC \n## 5519.446 5520.136 5557.437\n```\n:::\n\n\n이제 예측을 진행해 보자.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_hyn <- forecast(fit_hyn, h = length(test_hyn))\naccuracy(fc_hyn, test_hyn)\n##                      ME     RMSE      MAE       MPE     MAPE      MASE\n## Training set   3.727848 228.8229 164.1102 -2.026679 13.86475 0.7404020\n## Test set     -73.167844 231.3494 180.9392 -8.044075 13.09378 0.8163279\n##                   ACF1 Theil's U\n## Training set 0.1874059        NA\n## Test set     0.3712518 0.5878683\n```\n:::\n\n\n예측 결과를 @fig-hyn-fore 의 그래프와 같이 작성해 보자.\n빨간 실선은 test data이고, 파란 실선이 예측 결과이다. \n예측 구간은 80%와 95% 수준에서 각각 계산되는 것이 디폴트이며,\n80% 예측 구간은 짙은 색으로 표시되고, 95% 예측 구간은 옅은 색으로 표시된다. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(fc_hyn, include = 0) +\n  autolayer(test_hyn, color = \"red\", size = .8) +\n  labs(x = NULL, y = NULL) \n```\n\n::: {.cell-output-display}\n![`hynsight` 자료에 대한 예측 결과](3-ets_files/figure-html/fig-hyn-fore-1.png){#fig-hyn-fore width=672}\n:::\n:::\n\n\n\n\n## 연습문제 {-}\n\n**1.** 다음의 자료에 대하여 ETS 모형을 적합하고, 적합 결과를 설명해 보자. \n\n- `fma::chicken`\n\n- `fma::ibmclose`\n\n**2.** 다음 자료에 대하여 ETS 모형을 적합하고 예측을 실시해 보자. \nTest data는 마지막 2년으로 하며, 적합 및 예측 결과에 대해 설명해 보자. \n자료는 웹 서버 `https://raw.githubusercontent.com/yjyjpark/TS-with-R/main/Data/` 에서 불러올 수 있다.\n\n- 서울시 월별 평균 기온 자료 : `Seoul_temp.csv`\n\n- 수원시 월별 평균 기온 자료 : `Suwon_temp.csv`\n\n- 백령도에서 측정된 월별 미세먼지 농도 자료 : `Baek_pm10.csv`\n\n- 서울시에서 측정된 월별 미세먼지 농도 자료 : `Seoul_pm10.csv`\n\n- 수원시에서 측정된 월별 미세먼지 농도 자료 : `Suwon_pm10.csv`\n\n\n**3.** 미국 달러에 대한 한국 원화 환율 자료 `Won_USD.csv`에 대한 다음의 작업을 진행해 보자. Test data는 마지막 2년으로 한다. \n\n- ETS 모형을 적합하고 분해법 모형의 적합 결과와 비교해서 차이를 설명하라.\n\n- ETS 모형에 의한 예측을 실시해 보자.   \n\n\n\n",
    "supporting": [
      "3-ets_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}